<%# app/views/search/index.html.erb -%>
<%-
  # EMMA Unified Search results page.

  view_debug(__FILE__)

  list  ||= paginator.page_items
  dec     = SearchesDecorator.new(list, **context)

  help    ||= dec.help_topic
  title   ||= nil
  title     = dec.page_heading(title)

  total   ||= @page.total_items
  records ||= @page.page_records
  terms   ||= search_terms
  row     ||= 1

  page_opt  = SearchTermsHelper::NON_SEARCH_KEYS
  page_terms, search = partition_hash(terms, *page_opt)
  page      = positive(page_terms[:page]&.values&.first) || 1
  search    = search.presence

  unless modal?
    label = dec.page_meta_title
    terms = (page > 1) ? search&.merge(page: page_terms[:page]) : search
    terms = list_search_terms(terms) if terms
    label = "#{label} - #{terms}"    if terms
    set_page_meta_title(label)
    set_page_description(title)
  end

  append_page_classes(*dec.result_classes, *dec.style_classes)

  list_classes = %w(search-list)
  list_classes << 'scores' if dec.relevancy_scores?

  opt = { total: total, records: records, page: page, size: @page.page_size }

  opt[:row]    = row if file_results?
  top, bottom  = dec.index_controls(**opt)
  bottom       = nil if list.blank?

  list_ctrls   = [top, dec.list_styles, dec.list_results]
  list_heading = page_heading(title, *list_ctrls, help: help)
  list_footing = (bottom if title_results?)

  bottom = top = nil if title_results?
  opt[:row]   += 1   if top && opt[:row].is_a?(Integer)

  opt.merge!(dec: dec, skip: :title)

-%>

<%= list_heading %>
<%= page_description_section %>

<%= page_directions_section %>
<div class="<%= css_classes(list_classes) -%>">
  <%= top %>
  <%= render 'search/list', opt %>
  <%= bottom %>
</div>

<%= list_footing %>
<%= page_notes_section %>
