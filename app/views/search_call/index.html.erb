<%# app/views/search_call/index.html.erb -%>
<%-
  # Listing of searches.

  view_debug(__FILE__)

  list   ||= @page.page_items
  dec      = SearchCallsDecorator.new(list, **context)

  title  ||= dec.page_heading
  help   ||= nil # dec.help_topic
  total  ||= @page.total_items
  terms  ||= search_terms
# row    ||= 1

  page_opt = Record::Searchable::SEARCH_RECORDS_OPTIONS.dup << :group
  page_terms, search = partition_hash(terms, *page_opt)
  page     = positive(page_terms[:page]&.values&.first) || 1
  search   = search.presence

  unless modal?
    label = dec.page_meta_title(default: title)
    terms = (page > 1) ? search&.merge(page: page_terms[:page]) : search
    set_page_meta_title(label)
    append_page_meta_title('-', list_search_terms(terms)) if terms
    set_page_description(title)
    set_page_robots(:nofollow)
  end

  title += " (#{total} %s)" % (search ? 'matches' : 'total')

-%>

<%= page_heading(title, help: help) %>
<%= page_description_section %>

<%= page_directions_section %>
<%= dec.table(extended: @extended) %>

<%= page_notes_section %>
<%= dec.action_list unless modal? %>
