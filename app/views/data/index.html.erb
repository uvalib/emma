<%# app/views/data/index.html.erb -%>
<%-
  # EMMA database tables.

  title ||= t('emma.data.index.title')
  list  ||= @list || {}
  help  ||= nil # help_popup(:data) # TODO: ???

  unless modal?
    label = t('emma.data.index.label', default: title)
    set_page_title(label)
    set_page_description(title)
    set_page_robots(:noindex, :nofollow)
  end

  suffix = hex_rand
  list   = list.stringify_keys
  anchor = list.keys.map { |k| [k, url_escape("#{k}_#{suffix}")] }.to_h

-%>

<h1 class="heading"><%= title -%><%= help -%></h1>

<%= page_description_section %>
<ul class="database-table-links">
  <%- anchor.each_pair do |name, id| -%>
    <li><%= link_to(name, "##{id}") -%></li>
  <%- end -%>
</ul>

<%= page_directions_section %>
<div class="database-tables">
  <%- list.each_pair do |name, records| -%>
    <%= render 'data/heading', records: records, name: name, id: anchor[name]%>
    <%= render 'data/details', records: records %>
  <%- end -%>
</div>

<%= page_notes_section %>
