<%# app/views/devise/shared/_links.html.erb -%>
<%-
  # Link(s) displayed at the bottom of many Devise-controller-related page.

  c = controller_name
  m = devise_mapping

  registerable = m.registerable? && (c != 'registrations')
  recoverable  = m.recoverable?  && !%w(passwords registrations).include?(c)
  confirmable  = m.confirmable?  && (c != 'confirmations')
  lockable     = m.lockable?     && (c != 'unlocks')
  lockable   &&= resource_class.unlock_strategy_enabled?(:email)

  mods = []
  mods << :sessions      unless c == 'sessions'
  mods << :registrations if registerable
  mods << :passwords     if recoverable
  mods << :confirmations if confirmable
  mods << :unlocks       if lockable

  links =
    mods.map { |devise_module|
      label = t("emma.user.#{devise_module}.new.label")
      path  = send("new_#{devise_module}_path", resource_name)
      [label, path]
    }

  # noinspection RubyResolve
  if devise_mapping.omniauthable?
    links +=
      resource_class.omniauth_providers.map { |provider|
        label = get_sessions_label(:new, provider)
        path  = omniauth_authorize_path(resource_name, provider)
        [label, path]
      }
  end

  unless application_deployed?
    links +=
      OmniAuth::Strategies::Bookshare.stored_auth.keys.map { |id|
        user  = html_tag(:strong, id)
        label = get_sessions_label(:sign_in_as, user: user).html_safe
        path  = sign_in_as_path(id: id)
        [label, path]
      }.compact
  end

-%>

<%- links.each do |label, path| -%>
  <p>
    <%= link_to(label, path, 'data-turbolinks': false) %>
  </p>
<%- end -%>
