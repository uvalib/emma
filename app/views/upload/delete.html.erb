<%# app/views/upload/delete.html.erb -%>
<%-
  # Prompt to remove an existing file entry.

  title  ||= t('emma.upload.delete.title')
  list   ||= @list
  list     = Array.wrap(list)
  records  = list.select { |e| e.is_a?(Upload) }
  repo   ||= records.first&.repository
  logo   ||= repository_source_logo(repo)
  force  ||= force_delete

  unless modal?
    set_page_title(title)
    set_page_description(title)
    set_page_robots(:noindex, :nofollow)
  end

  if force
    rids    = list.select { |e| e.is_a?(String) && e.match?(/^[^\d]/) }
    recs, _ = find_in_index(*rids)
    # noinspection RubyResolve
    lookup  = recs.map { |r| [r.emma_repositoryRecordId,r.emma_recordId] }.to_h
    list    = list.map { |item| lookup[item] || item }
    records = list.select { |item| item.is_a?(Upload) || item.include?('-') }
  end

-%>

<div class="heading container">
  <h1 class="heading"><%= title -%></h1>
  <%= logo %>
</div>
<%= upload_description %>

<%- if list.blank? -%>

  <%= render 'upload/select_entry' %>
  <%= upload_notes %>

<%- else -%>

  <%- list.each_with_index do |item, idx| -%>
    <%= render 'upload/selected', item: item, row: idx, force: force %>
  <%- end -%>

  <%= upload_directions %>
  <%= upload_delete_form(*records, force: force) %>
  <%= upload_preview %>

<%- end -%>

<%= upload_action_list unless modal? %>
