<%# app/views/upload/_table.html.erb -%>
<%-
  # Display a table of uploaded entries.

  view_debug(__FILE__)

  list   ||= nil
  dec    ||= UploadsDecorator.new(list, **context)
  list     = dec.object

  count  ||= list.size
  level  ||= 1
  skip   ||= nil

  skip     = [*skip, :thumbnail]
  heading  =
    unless skip.include?(:title)
      title ||= nil
      title   = dec.page_title(title)
      title  += " (#{count})" unless skip.include?(:count)
      classes = 'list-heading'
      classes = css_classes(classes, 'empty') if list.blank?
      html_tag(level, title, class: classes)
    end

  process_fields = %i[phase edit_state]
  edit_fields    = Upload::EDIT_COLUMNS
  review_fields  = Upload::REVIEW_COLUMNS

  filter  ||= nil

  opt   = { filter: [*filter, *process_fields, *edit_fields, *review_fields] }
  table = dec.render_table(**opt)

-%>

<%- if heading %>
  <%= toggle_panel(table, label: heading, class: 'upload-table') %>
<%- else -%>
  <%= table %>
<%- end -%>
