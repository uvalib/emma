<%# app/views/category/index.html.erb -%>
<%-
  # Category index.
  title ||= t('emma.category.index.title')

  item_list = page_items.presence

  if item_list
    all_count     = nil
    search_count  = "#{total_items} categories found." # TODO: I18n
    search_count  = content_tag(:div, search_count, class: 'search-count')
    controls      = pagination_controls
    term_list     = search_terms.presence
    terms_control = term_list && applied_search_terms(term_list)
  else
    all_count     = " (#{total_items})"
    search_count  = controls = term_list = terms_control = nil
  end

  @page_title = t('emma.category.index.label', default: title)
  if term_list.present?
    @page_title += ' - ' + term_list.map { |k, v| "#{k}: #{v}" }.join(', ')
  end
-%>

<h1 class="heading"><%= title -%><%= all_count -%></h1>

<div class="category-list">

  <%# === Applied search terms (when applicable) === -%>
  <%= terms_control %>

  <%# === Top pagination controls === -%>
  <%- if controls -%>
    <div class="pagination-top"><%= controls -%><%= search_count -%></div>
  <%- end -%>

  <%# === Items === -%>
  <%- if item_list -%>
    <%- item_list.each_with_index do |item, idx| -%>
      <%= render 'category/entry', index: idx, item: item %>
    <%- end -%>
  <%- else -%>
    <%= render 'category/entry', index: -1 %>
  <%- end -%>

  <%# === Bottom pagination controls === -%>
  <%- if controls -%>
    <div class="pagination-bottom"><%= controls -%></div>
  <%- end -%>

</div>
