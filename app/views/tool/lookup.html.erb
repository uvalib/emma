<%# app/views/tool/lookup.html.erb -%>
<%-
  # Testing ActionCable

  view_debug(__FILE__)

  title ||= t('emma.tool.lookup.title')
  help  ||= %i[lookup_tool]

  unless modal?
    label = t('emma.tool.lookup.label', default: title)
    set_page_meta_title(label)
    set_page_description(title)
  end

  heading   = 'results-heading'
  terms     = 'item-terms'
  separator = 'item-separator'
  results   = 'item-results'
  errors    = 'item-errors'
  diag      = 'item-diagnostics'
  unique    = hex_rand

  heading_id    = "#{heading}-#{unique}"
  terms_id      = "#{terms}-#{unique}"
  separator_id  = "#{separator}-#{unique}"
  results_id    = "#{results}-#{unique}"
  errors_id     = "#{errors}-#{unique}"
  diag_id       = "#{diag}-#{unique}"

  heading_css   = heading
  terms_css     = terms
  separator_css = separator
  results_css   = "#{results} value"
  errors_css    = "#{errors} value"
  diag_css      = "#{diag} value"

  separators = {
    space: 'Space, tab, and <strong>|</strong> (pipe)'.html_safe,
    pipe:  'Only <strong>|</strong> (pipe)'.html_safe
  }
  selected = :space

-%>

<%= page_heading(title, help: help) %>
<%= page_description_section %>

<%= page_directions_section %>
<div class="lookup-prompt">
  <div class="<%= terms_css -%>">
    <label for="<%= terms_id -%>">Query:</label>
    <input id="<%= terms_id -%>" name="terms" type="text"/>
    <button name="button" type="submit">Lookup</button>
  </div>
  <fieldset id="<%= separator_id -%>" class="<%= separator_css -%>">
    <legend>Term Separators</legend>
    <%- separators.each_with_index do |(value, text), index| -%>
      <%- radio_id = "#{separator_id}-#{index}" -%>
      <%- default  = selected ? (value == selected) : index.zero? -%>
      <%- checked  = ('checked' if default) -%>
      <input id="<%= radio_id -%>" name="separator" type="radio" value="<%= value -%>" <%= checked -%>/>
      <label for="<%= radio_id -%>"><%= text -%></label>
    <%- end -%>
  </fieldset>
</div>

<h2 id="<%= heading_id -%>" class="<%= heading_css -%>">
  Results
</h2>

<div class="lookup-results">
  <!--suppress HtmlFormInputWithoutLabel -->
  <textarea id="<%= results_id -%>" class="<%= results_css -%>" aria-labelledby="<%= heading_id -%>"></textarea>
  <div class="pair">
    <label for="<%= errors_id -%>" class="label">Errors</label>
    <textarea id="<%= errors_id -%>" class="<%= errors_css -%>"></textarea>
  </div>
  <div class="pair">
    <label for="<%= diag_id -%>" class="label">Diagnostics</label>
    <textarea id="<%= diag_id -%>" class="<%= diag_css -%>"></textarea>
  </div>
</div>

<%= page_notes_section %>
