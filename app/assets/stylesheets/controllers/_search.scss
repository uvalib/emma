// app/assets/stylesheets/controllers/_search.scss

@use 'sass:map';
@use 'sass:math';

@use 'shared/variables'        as *;
@use 'shared/functions'        as *;
@use 'shared/mixins'           as *;
@use 'shared/controls/buttons' as button;
@use 'shared/controls/grids'   as grid;
@use 'shared/feature/model'    as model;

@use 'feature/model'           as model-classes;

//=============================================================================
// EMMA Unified Search pages
//=============================================================================

$row-separation:         0.75rem;
$row-line-height:        1.5;

$narrow-left-pad:        0.25rem;
$narrow-logo-height:     2rem;
$narrow-item-separation: 1.5rem;

$wide-open-pad:          1rem;
$medium-open-pad:        0.875rem;
$narrow-open-pad:        0.75rem;

$print-section-gap:      3rem;
$print-column-gap:       1rem;

$h-shift:                0.125rem;
$v-shift:                0.25rem;
$v-shift-half:           $v-shift * 0.5;

$value-right-margin:     calc(2 * $flex-gap-x);
$list-item-gap-y:        model.$list-item-gap-y;

// The "top" values for sticky positioning -- the "narrow" version is much
// larger because it is actually applied only to the .field-Title element,
// which needs to stick lower in order to keep from scrolling over the already-
// stuck item number.  Also, this isn't using "vh" units because this seemed to
// be inconsistent between emulations of, e.g., iPhone 5 and Galaxy Note 9.

$sticky-top-wide:   2vh;
$sticky-top-medium: 1.5vh;
$sticky-top-narrow: 3.125rem;

// Background color for the title (the fixed portion) of collapsible entries.

$title-bg:    lighter($uva-accent-teal, 92.5%);
$title-focus: darker( $uva-accent-teal, 27.5%);

//=============================================================================
// Internal mixins
//=============================================================================

@mixin search-item-columns($label: 0.25fr, $value: 1fr) {
    grid-template-columns: [label] minmax(auto, $label) [value] $value;
}

//=============================================================================
// Base definitions
//=============================================================================

/**
 * To have the page title, pagination controls, and data analysis controls all
 * together, `h1.heading` and `div.pagination-top` are contained within this
 * element.
 */
.heading-bar {

    display: grid;

    @media #{$not-narrow-screen} {
        grid-template-columns: auto 1fr;
    }

    @media #{$wide-screen} {
        margin:  $list-item-gap-y auto;
    }

    @media #{$medium-width} {
        margin:  calc(2 * $list-item-gap-y) auto;
        row-gap: 1rem;
    }

    @media #{$narrow-screen} {
        grid-template-columns: 1fr;
    }

    @media print {
        display:         flex;
        justify-content: space-between;
        margin:          2rem;
    }

    //=========================================================================
    // Components
    //=========================================================================

    .heading {
        @media #{$medium-width} {
            margin:      auto 0;
            grid-row:    1;
            grid-column: 1;
        }
    }

    // Search result type selection.
    .results.menu-control {

        display:           grid;
        grid-auto-rows:    2rem;
        grid-auto-columns: max-content;
        justify-content:   end;
        flex:              1 1 auto;

        > * {
            font-size: large;
        }
    }

    // Button tray for (dev only) list styles.
    .button-tray {

        display:        flex;
        flex-direction: row-reverse;
        flex-wrap:      wrap-reverse;
        gap:            0.5rem;

        @media #{$wide-screen} {
            column-gap: 1rem;
        }

        @media print {
            display:    none;
        }
    }

    // Moved from top of .search-list
    .pagination-top {

        margin:          auto 0;
        flex-direction:  row-reverse;
        justify-content: end;
        row-gap:         0.5rem;
        grid-column:     unset;

        @media #{$not-narrow-screen} {
            column-gap:  1.5rem;
        }

        @media #{$medium-width} {
            grid-row:    1/3;
        }

        @media #{$narrow-screen} {
            column-gap:  1rem;
        }

        //=====================================================================
        // Components
        //=====================================================================

        .counts,
        .results.menu-control,
        .button-tray {
            @media #{$narrow-screen} {
                justify-content: center;
                flex:            1 1 100%;
            }
        }

        .counts {

            display: inline-flex;

            @media #{$not-narrow-screen} {
                flex-direction:  row-reverse;
                column-gap:      1rem;
            }

            @media #{$medium-width} {
                flex-basis:      100%;
            }

            @media #{$narrow-screen} {
                flex-direction:  row;
                column-gap:      0.5rem;
                align-items:     baseline;
                margin:          0;
            }
        }

        // Search result type selection.
        .results.menu-control {
        }

        // Button tray enabled for the desktop and handheld form factors.
        .button-tray {

            @media #{$wide-screen} {
                position:   absolute;
                top:        0;
            }

            @media #{$medium-width} {
                display:    none;
            }

            @media #{$narrow-screen} {
                margin-top: 0.5rem;
                column-gap: 0.5rem;
                row-gap:    0.25rem;
            }
        }
    }

    // Search result type selection.
    > .results.menu-control {
        display: none;
    }

    // Button tray enabled for the tablet form factor.
    > .button-tray {

        @media #{$wide-screen} {
            display:    none;
        }

        @media #{$medium-width} {
            max-width:  50vw;
        }

        @media #{$narrow-screen} {
            display:    none;
        }
    }
}

// @see LogoHelper#repository_source_logo
.repository {

    &.name {

        display:         flex;
        flex-direction:  column;
        justify-content: center;

        // Use to display text as a substitute for a logo.
        div {
            padding:       1px 0.5rem;
            font-size:     medium;
            font-weight:   normal;
            color:         $rev-fg-color;
            background:    $panel-accent;
            border:        1px solid transparent;
            border-radius: 0.5rem;
        }
    }

    img {

        max-width:      100%;
        background:     white;

        @media #{$wide-screen} {
            height:     4.5rem;
            max-height: 4.5rem;
        }

        @media #{$not-wide-screen} {
            height:     3rem;
            max-height: 3rem;
        }
    }
}

// Label/value pairs appropriate for either .search-list-item or .file-info.
.search-label-value-pairs {

    @include model.label-value-pairs;

    @media #{$not-narrow-screen} {
        row-gap: $row-separation;
    }

    @media #{$narrow-screen} {
        row-gap: 1rem;
    }

    //=========================================================================
    // Components
    //=========================================================================

    .label,
    .value {
        margin-bottom: 0;
    }

    .label {

        line-height:        $row-line-height;

        @media #{$narrow-screen} {
            margin-bottom:  -0.75rem;
        }

        &.field-Title {
            margin: 0.67rem 0 auto;
        }
    }

    .value {

        &.textbox {
            box-shadow:
                0 0 0 0.25rem  $bg-color,
                0 0 0 0.375rem lightgray;
        }

        &.array {

            display:       grid;
            align-items:   center;
            align-content: center;
            row-gap:       $row-separation;

            @media #{$wide-screen} {
                grid-template-columns: repeat(6, minmax(16.67%, 0.1667fr));
            }

            @media #{$medium-width} {
                grid-template-columns: repeat(3, minmax(33%, 1fr));
            }

            @media #{$narrow-screen} {
                margin-left:           0;
                grid-template-columns: 1fr;
            }

            // Array element properties
            $element-border:    1px;
            $element-x-padding: 5px;
            $element-y-padding: 1px;
            $element-x-margin:  -$element-x-padding - $element-border;
            $element-y-margin:  -$element-y-padding - $element-border;

            > * {

                @include control-shadow;

                display:             block;
                height:              100%;
                padding:             $element-y-padding $element-x-padding;
                background:          ghostwhite;
                border:              $element-border solid gray;
                border-right-color:  black;
                border-bottom-color: black;
                border-radius:       $element-x-padding * 0.5;
                cursor:              text;

                // noinspection CssReplaceWithShorthandSafely
                @media #{$not-narrow-screen} {
                    margin:          $element-y-margin $element-x-margin;
                    margin-right:    1rem;
                }

                @media #{$wide-screen} {
                    word-break:      keep-all;
                    word-wrap:       break-word;
                }

                @media #{$narrow-screen} {
                    margin:          $element-y-margin 0;
                }
            }
        }

        &.field-Title {

            display:         flex;
            flex-direction:  row;
            justify-content: space-between;
            gap:             $flex-gap-y $flex-gap-x;
            margin:          0 0 auto;
            font-size:       x-large;
            font-weight:     bold;

            @media #{$narrow-screen} {

                @include grid.column-span;

                flex-wrap: wrap-reverse;
            }

            //=================================================================
            // Elements
            //=================================================================

            a:not(:hover) {
                text-decoration: none;
            }

            // @see SearchDecorator#title_and_source
            .title {
                flex:   0.33 1 auto;
                margin: 0.5rem 0 auto;
            }

            // @see SearchDecorator#title_and_source_logo
            .repository {

                flex: 0 0 auto;

                img {
                    max-height: 3rem;
                }
            }
        }
    }
}

// File format information section.
.file-info {

    @extend .model-list-item;
    @extend .search-label-value-pairs;

    display:    grid;
    margin-top: 1rem;
    gap:        1rem;

    @media #{$wide-screen} {
        grid-template-columns: max-content 1fr;
    }

    @media #{$not-wide-screen} {
        grid-template-columns: 1fr;
    }

    //=========================================================================
    // Components
    //=========================================================================

    .label {

        grid-column-start: 1;

        &.logo {

            @media #{$wide-screen} {
                @include invisible;
            }

            @media #{$not-wide-screen} {
                display: none;
            }
        }

        &.field-Title {
            max-width: unset;
            font-size: unset;
        }
    }

    .value {

        &.logo {
            img {
                max-height: 7rem;
                border:     1px solid lightgray;
            }
        }

        &.array {

            max-width: unset;

            @media #{$medium-width} {
                grid-template-columns: minmax(max-content, 50%);
            }

            > * {

                word-break: normal;

                @media #{$medium-width} {
                    margin-left: 0;
                }
            }
        }

        //=====================================================================
        // Elements
        //=====================================================================

        ul {

            margin:     0;
            padding:    0;
            list-style: square;
            list-style: disclosure-closed; // NOTE: Firefox only

            @media #{$not-wide-screen} {
                list-style-position: inside;
            }
        }
    }
}

//=============================================================================
// Metadata record search index page
//=============================================================================

/**
 * During transitional times, the index may be supplying the same metadata
 * field via two (or more) field names, this mixin supports "turning off"
 * label/value pairs of an older field if a label/value pair of the newer
 * field is present.
 *
 * For the mixin to operate, ordering of pairs in "en.emma.search.record"
 * must be maintained so that older name(s) for a given field follow the
 * newest name for the field.
 */
@mixin prioritize($new-name, $old-name) {
    .value.field-#{$new-name} + .label.field-#{$old-name} {
        &, & + * { display: none; }
    }
    .pair.field-#{$new-name} + .pair.field-#{$old-name} {
        display: none;
    }
}

// Metadata record label/value pairs for index listings.
.search-list-item {

    @extend .model-list-item;
    @extend .search-label-value-pairs;

    // If this item is *false* then the label for the title field is displayed
    // like other metadata labels.  If it is *true* then the label is not
    // visible and the title expands across all columns.

    $title-spans-entry: true;

    $textbox-vspace: 0.25rem;

    $narrow-indent:  0.375rem;

    //=========================================================================
    // Components
    //=========================================================================

    > .label,
    > .pair > .label {

        &.text,
        &.date,
        &.url {
            display:        flex;
            flex-direction: row;
            align-items:    center;
            height:         100%;
        }

        &.textbox {
            margin-top: $textbox-vspace;
        }

        &.field-Title {

            @if $title-spans-entry {

                @include sr-only;

                position:       unset !important;

            } @else {

                position:	    sticky;
                top:		    2vh;
                z-index:        $z-raised;
                display:	    flex;
                flex-direction: row;
                align-items:	flex-start;
                margin:		    0;
                padding-top:    1.25rem;
                background:	    $bg-color;
                box-shadow:
                    0.5rem  -0.5rem  0       0.5rem $bg-color,
                    0.25rem -0.25rem 0.75rem 0.5rem $bg-color;
            }

            @media print {
                margin:         0;
                padding-bottom: 0.125rem;
                align-self:     end;
            }
        }

        // Field labels with help icons:
        &.field-RetrievalLink {
            display:        flex;
            flex-direction: row;
            align-items:    center;
        }

        // Field labels with help icons that are only for the submission form:
        &.field-Repository {
            .help-popup {
                display: none;
            }
        }

        //=====================================================================
        // Elements
        //=====================================================================

        .text {
            @media #{$medium-width} {
                line-height:    1.25;
                letter-spacing: -0.5px;
            }
        }

        .help-popup .popup-toggle.icon {
            margin-left: 0.375rem;
            padding:     0.25rem 0.3125rem;
            font-size:   small;
        }
    }

    > .value,
    > .pair > .value {

        height:      100%;
        line-height: $row-line-height;

        &.text,
        &.date,
        &.url {

            display:            flex;
            flex-direction:     column;
            justify-content:    center;

            @media #{$narrow-screen} {
                padding-left:   $narrow-indent;
            }

            // If conditions cause the URL to wrap, keep the lines together.
            a {
                line-height:    1.25;
                word-break:     break-all;

                @media #{$narrow-screen} {
                    height:     100%;
                }
            }
        }

        &.array {
            @media print {

                grid-template-columns: repeat(4, minmax(max-content, 0.25fr));
                column-gap:            $print-column-gap * 0.5;

                > * {
                    margin:       -0.25rem;
                    margin-right: 0.5rem;
                }
            }
        }

        &.list,
        &.textbox {

            width:          max-content;
            min-width:      15vw;
            max-width:      75vw;
            max-height:     20vh;
            overflow-y:     auto;

            @media #{$medium-width} {
                max-width:  62.5vw;
            }

            @media #{$narrow-screen} {
                width:      auto;
                max-width:  calc(100vw - 2.5rem);
            }
        }

        &.list {
            // Firefox handling of max-content sometimes allows the longest
            // lines to wrap.  This makes the wrapping more evident by showing
            // that portion indented.
            > * {

                $indent: 1rem;

                margin-left:        $indent;
                text-indent:        -$indent;

                @media #{$narrow-screen} {
                    padding-left:   $narrow-indent;
                }
            }
        }

        &.textbox {

            margin-top:         $textbox-vspace;
            margin-bottom:      $textbox-vspace;
            height:             calc(100% - #{$textbox-vspace * 2});
            line-height:        1.25;

            @media #{$narrow-screen} {
                margin-left:    $flex-gap-x;
                padding-left:   calc($narrow-indent - $flex-gap-x);
            }
        }

        &.field-Title {

            position:      sticky;
            z-index:       $z-raised;
            align-items:   flex-start;
            margin:        0;
            height:        unset;
            line-height:   unset;
            font-size:     x-large;
            font-weight:   bold;
            background:	   $bg-color;
            border-bottom: 1px solid darkgray;

            @if $title-spans-entry {
                @include grid.column-span;
            }

            @media #{$wide-screen} {
                top:            $sticky-top-wide;
                box-shadow:
                     0.50rem -2.00rem  1.00rem  2.00rem  $bg-color,
                     0        0        0.25rem  0.50rem  $bg-color;
            }

            @media #{$medium-width} {
                top:            $sticky-top-medium;
                column-gap:     calc(3 * $flex-gap-x);
                box-shadow:
                     0       -1.00rem  0        0.50rem  $bg-color,
                     0        0        0.25rem  0.25rem  $bg-color;
            }

            @media #{$narrow-screen} {

                @include hyphenation;

                top:            $sticky-top-narrow;
                padding-bottom: 0.5rem;
                border-color:   $fg-color;
                box-shadow:
                     0       -0.50rem  0        0.25rem  $bg-color,
                     0        0.25rem  0.25rem  0        $bg-color;
            }

            @media print {
                height:          1.875rem;
                justify-content: start;
            }

            // @see SearchDecorator#title_and_source
            .title {

                margin:             0;
                flex:               1 1 100%;

                @media #{$wide-screen} {
                    height:         100%;
                    padding-bottom: 1rem;
                    font-size:      larger;
                }

                @media #{$medium-width} {
                    height:         100%;
                    padding-bottom: 0.75rem;
                    margin-right:   $value-right-margin;
                }

                // NOTE: Height is limited to avoid edge-case titles taking up
                //  a large portion of the screen -- using "em" units in order
                //  to relate to the element's own font.
                //
                // Most titles can be shown in 3 lines or less; a little extra
                // height is given so that if the title needs to be scrolled,
                // the fourth line is partially displayed but clipped.

                @media #{$narrow-screen} {
                    max-height:     4em;
                    margin-top:     0.5rem;
                    padding-right:  $scroll-easement-x;
                    overflow-y:     auto;
                }

                @media print {
                    margin-top:     0;
                }

                &:focus {
                    outline-offset: 1px;
                }
            }

            // @see SearchDecorator#title_and_source_logo
            .repository {

                display:                flex;
                justify-content:        flex-end;

                @media #{$wide-screen} {
                    padding-bottom:     1rem;
                }

                @media #{$medium-width} {
                    margin-left:        $value-right-margin;
                    padding-bottom:     0.75rem;
                }

                @media #{$narrow-screen} {
                    justify-content:    flex-start;
                    margin-top:         -0.5rem;
                }

                img {

                    height:         auto;
                    padding:        0.5rem 0.75rem;
                    border:         1px solid lightgray;
                    box-shadow:     2px 2px 6px 0 lightgray;

                    @media #{$not-wide-screen} {
                        max-height: 2.5rem;
                    }

                    @media print {
                        max-height: 2rem;
                    }
                }
            }

            // Controls for moving up and down through the list.
            // @see SearchDecorator#prev_next_controls
            .prev-next {

                display:            flex;
                flex-direction:     column;
                align-items:        center;
                margin:             0;
                flex:               0 0 auto;

                @media #{$not-narrow-screen} {
                    margin-left:    $flex-gap-x;
                    padding-top:    0.5rem;
                }

                @media #{$narrow-screen} {
                    flex-direction: row;
                    margin-top:     -0.5rem;
                    margin-bottom:  auto;
                    line-height:    1.5;
                }

                .prev,
                .next {

                    @include hover-highlight;

                    min-width:     unset;
                    margin:        0;
                    color:         $fg-color;
                    border-radius: 50%;

                    &:focus {
                        text-decoration: none;
                        outline-offset:  0;
                    }

                    &:hover {
                        text-decoration: none;
                    }

                    &.forbidden {

                        color:  blue;
                        cursor: default;

                        &:focus {
                            @include focus;
                        }
                    }

                    .symbol {

                        display:    block;
                        text-align: center;

                        @media #{$not-narrow-screen} {
                            width:  1.25em; // em not rem
                        }

                        @media #{$narrow-screen} {
                            width:  1.5em; // em not rem
                        }
                    }
                }

                .prev {
                    @media #{$not-narrow-screen} {
                        margin-top: -0.5rem;
                    }
                }

                .next {
                    @media #{$not-narrow-screen} {
                        margin-top: 0.25rem;
                    }
                    @media #{$narrow-screen} {
                        margin-left: 0.25rem;
                    }
                }
            }
        }

        &.field-Format {
            font-weight: bold;
        }

        &.field-Identifier {
            font-weight: bold;
        }

        &.field-Subject {
            padding-right: 0.5rem;
        }

        &.field-RetrievalLink {
            @media #{$narrow-screen} {
                margin-bottom: 1rem;
            }
        }
    }

    //=========================================================================
    // Other
    //=========================================================================

    .invalid {
        color:  $error-fg;
        cursor: help;
    }

    // File format information section label.
    .file-info-label {
        display:       block;
        margin-top:    1.5rem;
        margin-left:   0.75rem;
        margin-bottom: -0.5rem;
        font-weight:   bold;
    }

    // File format information section.
    .file-info {
        padding:       0.75rem;
        border:        2px solid gray;
        border-radius: 1rem;
        box-shadow:    inset 0 0 0.75rem -0.25rem gray;
    }

    //=========================================================================
    // Hide neighboring field pairs with the same meaning.
    //=========================================================================

    @include prioritize(Version,              Version);         // NOTE [1]
    @include prioritize(DateCopyright,        PublicationDate); // NOTE [2]
    @include prioritize(RepositoryUpdateDate, RepositoryMetadataUpdateDate);
    @include prioritize(RemediationDate,      LastRemediationDate);
    @include prioritize(Comments,             RemediationComments);
    @include prioritize(Comments,             LastRemediationNote);
    @include prioritize(RemediationComments,  LastRemediationNote);
    @include prioritize(RemediatedAspects,    Remediation);
    @include prioritize(TextQuality,          Quality);

    // NOTE [1] Prioritize 'emma_version' over 'bib_version'.
    // NOTE [2] If both are present then 'emma_PublicationDate' will just be
    //  derived from 'dcterms_dateCopyright', so the former is redundant.
}

// Zero or more .search-list-item elements.
.search-list {

    @extend .model-list;

    @media #{$narrow-screen} {
        grid-template-columns: 1fr;
    }

    // noinspection CssReplaceWithShorthandSafely
    @media print {
        margin:     0;
        margin-top: $print-section-gap * 0.5;
        padding:    0;
        column-gap: $print-column-gap;
        row-gap:    1rem;
    }

    //=========================================================================
    // Components
    //=========================================================================

    $item-number-bg:     lighter($uva-accent-blue, 97.5%);
    $item-number-border: $uva-accent-blue;

    // Replaced by .heading-bar .pagination-top.
    .pagination-top {
        display: none;
    }

    .pagination-bottom {
        @media print {
            display: none;
        }
    }

    .number {

        font-size:          large;
        font-weight:        bold;

        @media #{$not-narrow-screen} {
            margin-bottom:  calc(2 * $list-item-gap-y);
            padding-left:   0.25rem;
            padding-right:  0.5rem;
            text-align:     right;
            background:     $item-number-bg;
            border:         1px solid $item-number-border;
        }

        @media #{$wide-screen} {
            margin-top:     0;
            padding-bottom: 1.75rem;
        }

        @media #{$medium-width} {
            margin-top:     calc(2 * $list-item-gap-y);
            padding-bottom: calc(2 * $list-item-gap-y);
        }

        @media #{$narrow-screen} {

            @include grid.column-span;

            position:       sticky;
            top:            0;
            margin-top:     0;
            margin-bottom:  0;
            padding:        0;
            text-align:     center;
            background:     $bg-color;
            box-shadow:     0 0 0 0.75rem $bg-color;
        }

        @media print {
            margin:         0;
            padding:        0;
            text-align:     unset;
        }

        //=====================================================================
        // Components
        //=====================================================================

        .container {

            @media #{$wide-screen} {
                top:            $sticky-top-wide;
                margin-top:     0.625rem;
            }

            @media #{$medium-width} {
                top:            $sticky-top-medium;
                margin-top:     0.75rem;
            }

            @media #{$narrow-screen} {
                top:            0;
                flex-direction: row;
            }

            @media print {
                display:        block;
                position:       unset;
            }

            //=================================================================
            // Elements
            //=================================================================

            .value {

                margin:            0;

                @media #{$wide-screen} {
                    padding-top:   0.25rem;
                }

                @media #{$medium-width} {
                    padding-top:   0.125rem;
                }

                @media #{$narrow-screen} {
                    height:        1.75rem;
                    padding-top:   0.125rem;
                    margin-bottom: $gap-y;
                    background:    $item-number-bg;
                    border-bottom: 1px solid $item-number-border;
                    flex:          1 0 auto;
                }
            }

            .icon-tray {

                $icon-pad:      model.$icon-pad;
                $icon-pad-half: $icon-pad * 0.5;

                @media #{$not-narrow-screen} {
                    margin-top:     1rem;
                    margin-left:    0;
                    margin-right:   -($icon-pad);
                    padding-top:    $icon-pad-half;
                    padding-bottom: $icon-pad-half;
                    box-shadow:     2px 2px 1px 1px lightgray;
                }

                @media #{$narrow-screen} {
                    position:       absolute;
                    top:            0.125rem;
                    right:          0;
                    flex-direction: row;
                    margin:         0;
                    padding:        0 $icon-pad-half;
                }
            }

            .icon {
                @media #{$narrow-screen} {

                    margin: 0;

                    & + .icon {
                        margin-left: 0.25rem;
                    }
                }
            }
        }
    }

    // NOTE: This is tuned to account for the varying types of fields across
    //  the records displayed in search.  Without some adjustment, the grid of
    //  each record aligns only to the widest label that it happens to be
    //  displaying.

    .search-list-item {

        @media #{$not-narrow-screen} {
            margin-bottom:  calc(2 * $list-item-gap-y);
            padding-bottom: 0.5rem;
        }

        @media #{$wide-screen} {
            @include search-item-columns(0.1375fr);
        }

        @media #{$medium-width} {

            @include search-item-columns(0.25fr);

            margin-top:     calc(2 * $list-item-gap-y);
        }

        @media #{$narrow-screen} {
            @include grid.column-span;
        }

        @media print {
            display:               grid;
            grid-template-columns: auto 1fr;
            column-gap:            $print-column-gap;
            row-gap:               0.25rem;
            margin-bottom:         $print-section-gap;
        }

        //=====================================================================
        // Elements
        //=====================================================================

        // Superfluous because BaseDecorator::Fields#field_property_pairs folds
        // the information from :rem_complete into :rem_coverage.
        .field-Complete {
            display: none;
        }
    }
}

//=============================================================================
// Metadata record show page
//=============================================================================

// Metadata record values.
.search-details {
    @extend .model-details;
}

// Container for a .search-details.
.search-container {

    @extend .model-container;

    //=========================================================================
    // Sections
    //=========================================================================

    .search-details {}
}

//=============================================================================
// Hierarchical results
//=============================================================================

// Box shadow sections preventing scrolled text from appearing above the title.
$title-scroll-mask:
    0.25rem  -0.25rem  0         0.5rem  $bg-color,
    0.125rem  0        0.125rem  0.5rem  $bg-color;

@mixin collapsible-search-list {

    @media #{$not-narrow-screen} {
        column-gap: 1%;
    }

    @media #{$narrow-screen} {
        margin:     calc(2 * $list-item-gap-y) 0;
        column-gap: 0.5rem;
        grid-template-columns: auto 1fr;
    }

    //=========================================================================
    // Components
    //=========================================================================

    $title-height: 3.25rem;

    $narrow-title-shadow:      0       0       0.5rem  0.25rem  ghostwhite;
    $not-narrow-title-shadow: -0.5rem  0       0       0        $title-bg;
    $title-bottom-shadow:      0       2px     0       0        darkgray;

    .toggle {

        aspect-ratio:    1;
        padding:         0;
        line-height:     0;
        text-decoration: none;
        border-radius:   50%;
        border-color:    darkgray;

        @media #{$not-narrow-screen} {
            width:       1.65rem;
        }

        @media #{$narrow-screen} {
            width:       1.875rem;
        }

        @media print {
            display:     none;
        }

        // This may just be a Firefox thing, but the right triangle icon seems
        // shifted with respect to the down triangle icon.
        &:not(.open) {
            text-indent: 2px;
        }

        &:hover {
            box-shadow: none;
        }

        &.for-item {
            // NOTE: open/close at the title level
        }

        &.for-part {
            // NOTE: open/close a bibliographic part under a title
        }

        &.for-format {
            // NOTE: open/close a format within a part section
        }

        &.for-file {
            // NOTE: open/close a file within a format sub-section

        }
    }

    // noinspection CssReplaceWithShorthandSafely
    .number {

        position:            relative;
        margin:              auto 0;
        padding:             0;
        padding-top:         0.5rem;
        border:              none;
        box-shadow:          none;
        background:          none;

        @media #{$medium-width} {
            margin-right:    0.375rem;
            padding-bottom:  0.5rem;
        }

        @media #{$narrow-screen} {
            margin-top:      0;
            grid-column-end: 1;
            z-index:         $z-controls;
        }

        //=====================================================================
        // Components - special handling for the item toggle
        //=====================================================================

        .container {

            height:      $title-height;

            @media #{$not-narrow-screen} {
                display: none;
            }

            @media print {
                height:  auto;
            }

            //=================================================================
            // Elements
            //=================================================================

            .value {
                @media not print {
                    @include sr-only;
                }
            }

            .toggle.for-item {

                align-self:        flex-end;

                @media #{$not-narrow-screen} {
                    margin-bottom: 0;
                }

                @media #{$narrow-screen} {
                    margin-bottom: 0.5rem;
                    margin-left:   0.875rem;
                    margin-right:  -1.125rem;
                    transform:     scale(1.25);
                }
            }
        }

        > .toggle.for-item {

            margin-top:  0.125rem;

            @media #{$narrow-screen} {
                display: none;
            }
        }

        //=====================================================================
        // Variation - when the associated list item is open
        //=====================================================================

        &.open {

            @media #{$wide-screen} {
                $excess:     3.5rem;
                height:      calc(100% - $excess);
                margin-top:  1.75rem;
                padding-top: 0.125rem;
            }

            @media #{$medium-width} {
                $excess:     2.5rem;
                height:      calc(100% - $excess);
                margin-top:  1.375rem;
                padding-top: 0.3125rem;
            }

            @media #{$narrow-screen} {
                $excess:     $narrow-logo-height + $narrow-item-separation;
                height:      calc(100% - $excess);

                // Constrain the width so that the higher z-index .number
                // doesn't prevent sub-section toggles from being clicked.
                // The `overflow: visible` _shouldn't_ be needed -- it's the
                // specifying of the width for .container that should keep the
                // item toggle from being clipped/deformed.

                width:       0;
                overflow:    visible;
            }

            //=================================================================
            // Components
            //=================================================================

            .container {
                width: min-content;
            }

            .toggle.for-item {
                position: sticky;
                top:      3vh;
            }
        }
    }

    // Item "closed" by default; click to toggle "open".
    .search-list-item {

        min-width:             100%;
        margin:                0;

        @media #{$narrow-screen} {
            width:             92.5vw;
            margin-left:       -(1.25rem + $narrow-left-pad);
            margin-right:      (1.25rem + $narrow-left-pad);
            margin-bottom:     $narrow-item-separation;
            grid-column-start: 2;
        }

        > .value,
        > .pair > .value {

            &.field-Title {

                max-width:  100%;
                background: $title-bg;
                align-self: baseline;

                @media #{$not-narrow-screen} {
                    border: none;
                }

                @media #{$narrow-screen} {
                    justify-content: flex-end;
                }

                @media print {
                    position:   unset;
                    min-height: $title-height;
                }

                > * {
                    margin:     auto 0;
                    padding:    0;
                    align-self: center;
                }

                .title {

                    padding-left:       0.25rem;
                    letter-spacing:     -0.125px; // NOTE: needed for Firefox
                    cursor:             default;

                    @media #{$not-narrow-screen} {
                        flex-basis:     100%;
                        margin-left:    -0.25rem;
                    }

                    @media #{$wide-screen} {
                        border-top:     $wide-open-pad solid transparent;
                        border-bottom:  $wide-open-pad solid transparent;
                    }

                    @media #{$medium-width} {
                        border-top:     $medium-open-pad solid transparent;
                        border-bottom:  $medium-open-pad solid transparent;
                    }

                    @media #{$narrow-screen} {
                        position:       relative;
                        z-index:        1;
                    }

                    &:focus {

                        outline-color:      $title-focus;

                        @media #{$narrow-screen} {
                            outline-offset: -1px;
                        }
                    }
                }

                .repository {

                    @media #{$medium-width} {
                        margin-top: 0;
                    }

                    @media #{$narrow-screen} {
                        position:   relative;
                        z-index:    0;
                    }

                    img {

                        box-shadow:     2px 2px 4px 0 lightgray;

                        @media #{$narrow-screen} {
                            max-height: $narrow-logo-height;
                        }
                    }
                }

                .prev-next {
                    display: none;
                }
            }
        }
    }

    .search-list-item.colorized {

        > .value,
        > .pair > .value {

            &.field-Title {

                .identity-number {

                    // noinspection CssReplaceWithShorthandSafely
                    @media #{$narrow-screen} {
                        margin-top:    auto;
                        margin-bottom: auto;
                        margin-left:   0.25rem;
                        margin-right:  0.5rem;
                    }

                    &.error,
                    &.exile {
                        @media #{$narrow-screen} {
                            margin-right: 0.25rem;
                        }
                    }
                }
            }
        }
    }

    //=========================================================================
    // Components - when the list item is open
    //=========================================================================

    .search-list-item.open {

        > .value,
        > .pair > .value {

            &.field-Title {

                top: 1vh;

                @media #{$not-narrow-screen} {
                    box-shadow: $not-narrow-title-shadow, $title-scroll-mask;
                }

                @media #{$narrow-screen} {
                    box-shadow: $narrow-title-shadow,     $title-scroll-mask;
                }

                @media print {
                    break-after: avoid;
                }

                > * {
                    @media #{$not-narrow-screen} {
                        align-self: flex-start;
                    }
                }

                .title:not(:focus) {
                    @media #{$not-narrow-screen} {
                        box-shadow: $title-bottom-shadow;
                    }
                }

                .repository {
                    @media #{$not-narrow-screen} {
                        margin-top: 0;
                    }
                    @media #{$narrow-screen} {
                        position:   sticky;
                        top:        0;
                    }
                }
            }
        }
    }

    //=========================================================================
    // Components - when the list item is closed
    //=========================================================================

    .search-list-item:not(.open) {

        @media #{$not-narrow-screen} {
            max-height:     4rem;
            padding-bottom: 1rem;
        }

        > .value,
        > .pair > .value {

            &.field-Title {

                @media #{$not-narrow-screen} {
                    box-shadow: $not-narrow-title-shadow;
                }

                @media #{$narrow-screen} {
                    box-shadow: $narrow-title-shadow;
                }

                .title {
                    overflow:      hidden;
                    white-space:   nowrap;
                    text-overflow: ellipsis;
                }
            }
        }

        > :not(.row-1) {
            display: none !important;
        }
    }
}

body.search.title_results {

    .search-list {
        @include collapsible-search-list;
    }
}

//=============================================================================
// Single-file results
//=============================================================================

body.search.file_results {

    .search-list-item {

        > .value,
        > .pair > .value {

            &.field-Title {
                // Adjust to keep from overshadowing the page heading.
                @media #{$wide-screen} {
                    box-shadow:
                        0.50rem -1.25rem  0.00rem  1.00rem  $bg-color,
                        0        0        0.25rem  0.50rem  $bg-color;
                }
            }
        }
    }
}

//=============================================================================
// Style - title colorization
//=============================================================================

body.search.dev-style {

    .heading-bar {

        // @see SearchDecorator#list_styles
        .style-button {

            @include button.basic;

            &.active {
                background-color: $input-disabled-bg;
                border-color:     $input-disabled-fg;
            }
        }
    }

    //=========================================================================
    // Sections - title colorization
    //=========================================================================

    .search-list {

        //=====================================================================
        // Components
        //=====================================================================

        .search-list-item.colorized {

            > .value,
            > .pair > .value {

                &.field-Title {

                    border:             none;

                    @media #{$not-narrow-screen} {
                        margin-left:    -0.25rem;
                        padding-left:   0.25rem;
                    }

                    @media #{$narrow-screen} {
                        margin-left:    -$narrow-left-pad;
                    }

                    .title {

                        @media #{$not-narrow-screen} {
                            padding-bottom: 0;
                        }

                        @media #{$narrow-screen} {
                            margin-left:    $narrow-left-pad;
                        }

                        &:focus {
                            outline-offset: 2px;
                        }
                    }

                    .identity-number {

                        word-break:         keep-all;
                        flex:               1 0 auto;

                        @media #{$wide-screen} {
                            margin-top:     $wide-open-pad;
                            font-size:      larger;
                        }

                        @media #{$medium-width} {
                            margin-top:     $medium-open-pad;
                        }

                        // noinspection CssReplaceWithShorthandSafely
                        @media #{$narrow-screen} {
                            margin-top:     auto;
                            margin-bottom:  auto;
                            margin-left:    0.25rem;
                            margin-right:   0.5rem;
                            flex:           0 1 auto;
                        }

                        // Highlight out-of-sequence title index numbers.
                        &.error,
                        &.exile {

                            $fg-color: red;
                            $bg-color: white;

                            color:            $fg-color;
                            background:       $bg-color;
                            border-bottom:    $v-shift solid $bg-color;
                            border-left:      $h-shift solid $bg-color;
                            border-right:     $h-shift solid $bg-color;
                            border-radius:    0.375rem;
                            box-shadow:       0 0 0 0.25rem $fg-color;

                            @media #{$wide-screen} {
                                margin-top:   $wide-open-pad   - $v-shift-half;
                                margin-right: -$h-shift;
                            }
                            @media #{$medium-width} {
                                margin-top:   $medium-open-pad - $v-shift-half;
                                margin-right: -$h-shift;
                            }
                            @media #{$narrow-screen} {
                                margin-right: 0.25rem;
                            }
                        }

                        &.exile:not(.error) {
                            color: $uva-text-gray;
                        }

                        &:not(.error) {
                            cursor: default;
                        }
                    }

                    .repository {
                        @media #{$wide-screen} {
                            padding-bottom: 0;
                        }
                        @media #{$narrow-screen} {
                            margin-top:     0;
                        }
                    }

                    .prev-next {

                        @media #{$narrow-screen} {
                            margin-top:   0;
                            margin-left:  0.25rem;
                            margin-right: 0.25rem;
                        }

                        .prev,
                        .next {

                            &:focus:not(:hover) {
                                box-shadow: 0 0 0.25rem 0.25rem white;
                            }

                            .symbol {
                                border-radius: 50%;
                                background:    ghostwhite;
                                box-shadow:    inset -1px 0 0 0 darkgray;
                            }
                        }
                    }
                }

                &.identity-highlight {
                    font-weight: bold;
                    background:  ghostwhite;
                }
            }
        }

        //=====================================================================
        // Components - when the list item is open
        //=====================================================================

        .search-list-item.colorized.open {

            > .value,
            > .pair > .value {

                &.field-Title {

                    @media #{$narrow-screen} {
                        box-shadow: $title-scroll-mask;
                    }

                    .title {
                        box-shadow: none;
                    }

                    .repository {
                        img {
                            box-shadow: none;
                        }
                    }
                }
            }
        }

        //=====================================================================
        // Components - when the list item is closed
        //=====================================================================

        .search-list-item.colorized:not(.open) {

            > .value,
            > .pair > .value {

                &.field-Title {

                    @media #{$narrow-screen} {
                        box-shadow: none;
                    }

                    .repository {
                        img {
                            @media #{$narrow-screen} {
                                box-shadow: none;
                            }
                        }
                    }
                }
            }
        }
    }
}

body.search:not(.dev-style) {
    .heading-bar {
        .button-tray {
            display: none;
        }
    }
}

//=============================================================================
// Style - field highlighting
//=============================================================================

body.search.dev-style {

    @mixin primary($bg) {
        background-color: $bg;
    }

    @mixin secondary($fg) {

        $gap:    2px;
        $box:    2px + $gap;
        $mask:   white;
        $shift:  5px;
        $exdent: 0.25rem;

        box-shadow:
            0 0 0 $gap $mask, // inner gap
            0 0 0 $box $fg;   // outer boundary

        @media #{$not-narrow-screen} {

            &.value.array {
                box-shadow:
                          0 0 0 $gap $mask, // inner gap
                      -$gap 0 0 $gap $mask, // mask left side inner boundary
                          0 0 0 $box $fg,   // inner boundary
                    -$shift 0 0 $gap $mask, // outer gap
                    -$shift 0 0 $box $fg;   // outer boundary
            }

            &.value:not(.array) {
                margin-left:   -$exdent;
                padding-left:  $exdent;
                padding-right: 2 * $exdent;
            }
        }

        @media #{$narrow-screen} {

            &.value:not(.array) {
                margin-left:   0;
                padding-right: 3 * $exdent;
            }

            &.value:not(.array):not(.list) {
                padding-left:  $exdent;
            }

        }
    }

    @mixin type-marker($term, $color: red, $inner-color: black) {
        &::before {
            content:        '[#{$term}]';
            position:       absolute;
            left:           -2rem;
            padding:        0 0.25rem;
            color:          white;
            background:     $color;
            font-weight:    bold;
            text-transform: uppercase;
            text-shadow:
                -1px -1px  0  $inner-color,
                -1px  1px  0  $inner-color,
                 1px -1px  0  $inner-color,
                 1px  1px  0  $inner-color;
        }
    }

    //=========================================================================
    // Sections - field highlighting
    //=========================================================================

    .search-list.field_groups {

        //=====================================================================
        // Indicate primary field scope
        //=====================================================================

        .scope-title:not(.field-Title) {
            @include primary(beige);
        }

        .scope-parts {
            // TODO: ???
        }

        .scope-formats {
            // TODO: ???
        }

        .scope-files {
            @include primary(lightcyan);
        }

        //=====================================================================
        // Indicate secondary field scope
        //=====================================================================

        .scope-bibliographic:not(.field-Title) {
            @include secondary(black);
        }

        .scope-remediation {
            @include secondary(red);
        }

        .scope-accessibility {
            @include secondary(limegreen);
        }

        .scope-repository {
            @include secondary(dodgerblue);
        }

        .scope-index {
            @include secondary(hotpink);
        }
    }

    .search-list.mark-types {

        > .value,
        > .pair > .value {

            &.text {
                @include type-marker('text', gray);
            }

            &.textbox {
                @include type-marker('textbox', dodgerblue);
            }

            &.date {
                @include type-marker('date', green);
            }

            &.url {
                @include type-marker('url', blue);
            }

            &.enum {
                @include type-marker('enum', lime);
            }

            &.list {
                @include type-marker('list', red);
            }

            &.array {
                @include type-marker('array', violet);
            }
        }
    }
}

//=============================================================================
// Style - relevancy scores
//=============================================================================

body.search.dev-style {

    $score-fields-bg: lightgray;

    @mixin score-fields {
        &.field-CreatorScore,
        &.field-IdentifierScore,
        &.field-KeywordScore,
        &.field-PubDate,
        &.field-PublisherScore,
        &.field-RemDate,
        &.field-SortDate,
        &.field-TitleScore {
            font-weight: bold;
            background:  $score-fields-bg;
            @content;
        }
    }

    //=========================================================================
    // Sections - relevancy scores
    //=========================================================================

    .search-list.scores {

        //=====================================================================
        // Components
        //=====================================================================

        .search-list-item {

            > .label,
            > .pair > .label {

                @media #{$not-narrow-screen} {
                    @include score-fields {
                        box-shadow:  0.375rem 0 0 0.625rem $score-fields-bg;
                    }
                }

                @media #{$narrow-screen} {
                    @include score-fields {
                        box-shadow:  0.5rem   0 0 0.5rem   $score-fields-bg;
                    }
                }
            }

            > .value,
            > .pair > .value {

                @media #{$not-narrow-screen} {
                    @include score-fields {
                        box-shadow: -0.625rem 0 0 0.625rem $score-fields-bg;
                    }
                }

                @media #{$narrow-screen} {
                    @include score-fields {
                        box-shadow:  0.5rem   0 0 0.5rem   $score-fields-bg;
                    }
                }

                &.field-Title {

                    .item-score {

                        min-width:          1.75rem;
                        margin:             auto 0;
                        padding:            0.25rem;
                        font-family:        monospace;
                        font-size:          smaller;
                        text-align:         center;
                        word-break:         keep-all;
                        color:              green;
                        background:         white;
                        border:             2px solid green;
                        border-radius:      0.25rem;

                        @media #{$wide-screen} {
                            margin-left:    1rem;
                        }

                        @media #{$medium-width} {
                            margin-left:    0.5rem;
                            margin-top:     $medium-open-pad - $v-shift-half;
                        }

                        @media #{$narrow-screen} {
                            margin-left:    1rem;
                        }

                        &.error {
                            color:          red;
                            border-color:   red;
                        }

                        &.disabled {
                            color:          darkgray;
                            border-color:   darkgray;
                        }
                    }
                }
            }
        }

        //=====================================================================
        // Components - when the list item is open
        //=====================================================================

        .search-list-item.open {

            > .value,
            > .pair > .value {

                &.field-Title {

                    .item-score {
                        @media #{$wide-screen} {
                            margin-top: $wide-open-pad + $v-shift-half;
                        }
                    }
                }
            }
        }

        //=====================================================================
        // Components - when the list item is colorized
        //=====================================================================

        .search-list-item.colorized {

            > .value,
            > .pair > .value {

                &.field-Title {

                    .item-score {

                        border-radius: 0;

                        @media #{$wide-screen} {
                            box-shadow: -0.875rem  0 0 1.125rem  $bg-color;
                        }
                        @media #{$medium-width} {
                            box-shadow: -0.3125rem 0 0 0.9375rem $bg-color;
                        }
                        @media #{$narrow-screen} {
                            box-shadow: -0.625rem  0 0 0.625rem  $bg-color;
                        }
                    }
                }
            }
        }
    }
}

//=============================================================================
// Results type - grid
//=============================================================================

body.search.grid-style {

    $column-count: 0;
    $next-column:  1;

    @function show-($columns: 1) {
        $start-col: $next-column;
        $end-col:   $start-col;
        $columns:   if((not $columns or ($columns == 0)), 1, $columns);
        @if $columns > 1 {
            $end-col: $end-col + $columns;
        }
        $next-column:  $next-column  + $columns;
        $column-count: $column-count + $columns;
        @return math.div($start-col, $end-col);
    }

    @function -hide() {
        @return false;
    }

    @mixin clean() {
        font-weight: revert;
        background:  revert;
        border:      revert;
        box-shadow:  revert;
    }

    // Each column is either hidden or given a distinct column slot so that
    // there is a consistent display of columns regardless of whether the item
    // has that given type of metadata or not.
    $field-columns: (
        Format:                 show-(),
        Creator:                show-(),
        Language:               show-(),
        Description:            -hide(),
        Publisher:              show-(),
        Subject:                -hide(),
        Rights:                 -hide(),
        PublicationDate:        show-(),
        CopyrightDate:          -hide(),
        Identifier:             show-(2),
        Related:                -hide(),
        //PublicationDate:      show-(), // moved before Identifier
        //CopyrightDate:        -hide(), // moved before Identifier
        EntryCreated:           -hide(),
        EntryUpdated:           -hide(),
        RecordId:               show-(),
        TitleId:                show-(),
        Repository:             -hide(),
        Collection:             -hide(),
        FormatVersion:          -hide(),
        FormatFeature:          -hide(),
        AccessibilityFeature:   -hide(),
        AccessibilityControl:   -hide(),
        AccessibilityHazard:    -hide(),
        AccessMode:             -hide(),
        SufficientMode:         -hide(),
        AccessibilitySummary:   -hide(),
        RepositoryRecordId:     show-(),
        RetrievalLink:          show-(),
    );

    //=========================================================================
    // Sections
    //=========================================================================

    .search-list {

        grid-template-columns: 1fr;

        .number {
            display: none !important;
        }

        .search-list-item {

            max-height:            unset !important;
            grid-template-columns: repeat($column-count, minmax(5vw,1fr));
            column-gap:            0.5rem;

            //=================================================================
            // Components
            //=================================================================

            > .label,
            > .pair > .label {
                display: none !important;
            }

            > .value:not(.row-1),
            > .pair > .value:not(.row-1),
            > .pair:not(.row-1) > .value {
                display: revert !important;
            }

            > .value,
            > .pair > .value {

                &.textbox {
                    @include clean;
                }

                &.array {
                    grid-template-columns: 1fr;
                    > * {
                        @include clean;
                    }
                }

                &.field-Title {

                    position:       unset;
                    margin-top:     2rem;
                    background:     #eeeeee;
                    grid-column:    1/-1;
                    grid-row:       1/1;
                    pointer-events: none;

                    .repository {
                        img {
                            box-shadow: none;
                        }
                    }
                }

                @each $type in map.keys($field-columns) {
                    &.field-#{$type} {
                        $columns: map-get($field-columns, $type);
                        @if $columns {
                            grid-column: $columns;
                            grid-row:    2/2;
                        } @else {
                            display: none !important;
                        }
                    }
                }
            }
        }
    }
}

//=============================================================================
// Style - extended title
//=============================================================================

body.search {

    .search-list {

        .search-list-item {

            > .value,
            > .pair > .value {

                &.field-Title {

                    .item-date,
                    .item-number {

                        margin-left:    0.5rem;
                        color:          black;
                        background:     $title-bg;
                        box-shadow:     inset 0 0 0 1px gray;

                        @media #{$wide-screen} {
                            padding:    0 0.5rem;
                        }

                        @media #{$not-wide-screen} {
                            padding:    0 0.375rem;
                        }
                    }

                    .item-date {
                        margin-left: 0.75rem;
                        font-weight: normal;
                    }
                }
            }
        }

        .search-list-item.colorized {

            > .value,
            > .pair > .value {

                &.field-Title {

                    .item-date,
                    .item-number {
                        background:  white;
                    }
                }
            }
        }
    }
}

body.search.title_results {

    @mixin fill($r-offset: 2px, $l-offset: 2px, $bg: $title-bg) {

        background: $bg;
        box-shadow:
             $r-offset  1px  0  2px  $bg,
             $r-offset -1px  0  2px  $bg,
            -$l-offset  1px  0  2px  $bg,
            -$l-offset -1px  0  2px  $bg;

        @media print {
            background: unset;
            box-shadow: none;
        }
    }

    //=========================================================================
    // Sections
    //=========================================================================

    .search-list {

        .number {

            .toggle.for-item {
                @media #{$not-narrow-screen} {
                    width:      1.875rem;
                    margin-top: 0;
                }
            }

            // Do not show format counts by default.
            .format-counts {
                display: none;
            }
        }

        .search-list-item {

            @media #{$wide-screen} {
                @include search-item-columns(0.15fr);
            }

            // Divider between metadata for individual parts
            > .label.field-section,
            > .pair > .label.field-section,
            > .pair.field-section > .label,
            > .value.field-section,
            > .pair > .value.field-section,
            > .pair.field-section > .value {

                margin:      0.5rem 0;
                line-height: 1.25;
                font-size:   larger;

                @media print {
                    margin-top: 1rem;
                }

                // Don't display the divider if not valid.
                &[data-value="-"],
                &:not([data-value]) {
                    display: none;
                }
            }

            > .label.field-section,
            > .pair > .label.field-section,
            > .pair.field-section > .label {

                @include fill(2rem); // Extend to touch the .value element.

                display:     flex;
                column-gap:  0.5rem;
                font-weight: bolder;

                border-top-left-radius:    0.75rem;
                border-bottom-left-radius: 0.75rem;

                @media #{$narrow-screen} {
                    box-shadow:
                        -1px  1px  0  3px  $title-bg,
                        -1px -1px  0  3px  $title-bg;
                }

                &.open {
                    @media print {
                        break-after: avoid;
                    }
                }

                // Open/close toggle button
                .toggle {}

                // Section label
                .text {

                    cursor: default;

                    &:focus {

                        outline-color:      $title-focus;

                        @media #{$narrow-screen} {
                            outline-offset: 1px;
                        }
                    }
                }
            }

            > .value.field-section,
            > .pair > .value.field-section,
            > .pair.field-section > .value {

                @include fill(2px);

                height:      unset;

                @media #{$narrow-screen} {
                    display: none;
                }

                &.open {

                    @media print {
                        break-after: avoid;
                    }

                    .details {
                        display: none;
                    }
                }
            }

            //=================================================================
            // Indentation levels
            //=================================================================

            $part-indent:   0;
            $format-indent: 1rem;
            $file-indent:   2rem;

            > .label,
            > .pair > .label {

                &.field-NewPart   { margin-left: $part-indent; }
                &.field-NewFormat { margin-left: $format-indent; }
                &.field-NewFile   { margin-left: $file-indent; }


                &.scope-parts.scope-formats.scope-files {
                    margin-left: $file-indent;
                }
            }

            > .value,
            > .pair > .value {
                &.scope-parts.scope-formats.scope-files {
                    @media #{$narrow-screen} {
                        margin-left: $file-indent;
                    }
                }
            }
        }
    }
}

//=============================================================================
// Style - format counts
//=============================================================================

body.search.title_results {

    .search-list.format_counts {

        .number {

            display: flex;

            // Due to the way that setupToggleControl() adds the control button
            @media #{$not-narrow-screen} {
                flex-direction:  row-reverse;
                justify-content: flex-end;
            }

            @media #{$wide-screen} {
                padding-top:     0;
            }

            @media #{$narrow-screen} {
                flex-direction:  row;
                justify-content: flex-start;
                margin-right:    -0.75rem;
                padding-top:     1.75rem;
            }

            //=================================================================
            // Elements
            //=================================================================

            .container {

                @media #{$narrow-screen} {
                    padding-top: 0.25rem;
                }

                .toggle.for-item {
                    @media #{$narrow-screen} {
                        margin-top: 0;
                    }
                }
            }

            .toggle.for-item,
            .format-counts {
                align-self: flex-start;
            }

            .toggle.for-item {
                margin-bottom: 0;
                z-index:       $z-raised;
            }

            .format-counts {

                display:            grid;
                align-content:      center;
                row-gap:            0.0625rem;
                column-gap:         0.25rem;

                margin:             0;
                padding:            0.125rem 0.25rem;

                // This gives each file count box a uniform appearance.

                min-width:          3.75rem;
                line-height:        0.875;
                color:              green;
                background:         lightyellow;
                border:             1px solid gray;

                // If the previous file count has a lot of lines, this shadow
                // keeps it from appearing to run into the current file count.
                @media #{$not-narrow-screen} {
                    margin-top:     -1.25rem;
                    min-height:     4rem;
                    font-size:      small;
                    box-shadow:     0 -0.25rem 0.5rem 0.25rem $bg-color;
                    grid-template-columns: [count] max-content [format] 1fr;
                }

                @media #{$wide-screen} {
                    margin-left:    0.75rem;
                }

                @media #{$medium-width} {
                    margin-left:    0.5rem;
                }

                @media #{$narrow-screen} {
                    height:         1.75rem;
                    width:          12.5rem;
                    margin-right:   -8.625rem;
                    margin-left:    0.5rem;
                    font-size:      medium;
                    overflow-y:     auto;
                    flex:           1 0 auto;
                    grid-template-columns: repeat(3, 1fr 1fr);
                }

                .count {
                    margin:     auto 0;
                    text-align: right;
                }

                .format {

                    margin:     auto 0;
                    text-align: left;

                    @media #{$narrow-screen} {
                        margin-right: 0.125rem;
                    }
                }
            }

            ul.format-counts {

                list-style: none;

                li {
                    display: contents;
                }
            }

            //=================================================================
            // When the associated list item is closed.
            //=================================================================

            // Constraining the height makes the file count behave as box that
            // descends from a line that runs through the open/close control
            // and the text of the title.
            &:not(.open) {
                height: 1.5rem;
            }

            //=================================================================
            // When the associated list item is open.
            //=================================================================

            &.open {

                .format-counts {
                    position: sticky;
                    top:      1vh;
                }

                @media #{$narrow-screen} {

                    height: calc(100% - 5.5rem);

                    .toggle.for-item,
                    .format-counts {
                        align-self: flex-start;
                        top:        1rem;
                    }
                }
            }
        }

        // Adjustments due to .number changes:
        .search-list-item {

            @media #{$wide-screen} {
                @include search-item-columns(0.1875fr);
            }

            @media #{$medium-width} {
                @include search-item-columns(0.3125fr);
            }

            @media #{$narrow-screen} {
                margin-left:  -27.5vw;
                margin-right: 27.5vw;
            }

            > .value,
            > .pair > .value {

                &.list,
                &.textbox {

                    @media #{$wide-screen} {
                        max-width: 66vw;
                    }

                    @media #{$medium-width} {
                        max-width: 50vw;
                    }

                    @media #{$narrow-screen} {
                        max-width: 75vw;
                    }
                }
            }
        }
    }
}

//=============================================================================
// Style - collapsed (file results)
//=============================================================================

body.search.file_results {

    .search-list.collapsed {
        @include collapsible-search-list;
    }

    .search-list:not(.collapsed) {
        .toggle {
            display: none;
        }
    }
}
