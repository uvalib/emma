// app/assets/stylesheets/feature/_file_upload.scss

// @use 'shared/common'; // TODO: SASS 4.0
// @use 'vendor/uppy';   // TODO: SASS 4.0

//=============================================================================
// File uploader pages.
//=============================================================================

// Text sections on upload pages.
.file-upload-text {

    margin: 1rem 0;

    // noinspection SassScssResolvedByNameOnly
    @media #{$wide-screen} {
        width: 50%;
    }

    // Space between consecutive text sections.
    & + & {
        margin-top: 3rem;
    }

    //=========================================================================
    // Variants
    //=========================================================================

    // Text following the header on the page.
    &.description {
        padding:       0 1rem;
        border:        1px solid black;
        border-radius: 0.25rem;
    }

    // Text preceding the main control section of the page.
    &.directions {
        text-decoration: underline;
        font-weight:     bold;
    }

    // Text following the main control section of the page.
    &.notes {

        @extend .description;

        margin: 3rem 0;
    }

    //=========================================================================
    // Enclosed element styles
    //=========================================================================

    h1, h2, h3 { font-size: large; }
}

// Display for the selected filename.
// This is hidden until a file has been uploaded.
.uploaded-filename {

    display:     none;
    margin:      auto 0;
    line-height: 2;
    overflow-x:  auto;

    .leader {
        margin-right: 0.25rem;
        word-break:   break-all;
    }

    .filename {
        font-weight: bold;
        word-break:  keep-all;
    }
}

// Control for filtering which upload form fields are displayed.
.upload-field-control {

    // noinspection SassScssResolvedByNameOnly
    @include user-select(none);

    display:         flex;
    flex-direction:  row;
    flex-wrap:       wrap;
    justify-content: space-between;

    line-height:     1.5;
    border:          1px solid gray;
    border-radius:   0.25rem;

    // noinspection SassScssResolvedByNameOnly
    @media #{$not-narrow-screen} {
        padding-right: 0.5rem;
    }

    // noinspection SassScssResolvedByNameOnly
    @media #{$narrow-screen} {
        flex-direction: column;
    }

    // A label/radio button pair.
    .radio {

        display:    block;
        margin:     0.25rem;
        word-break: keep-all;

        input[type="radio"] {
            margin-right: 0;
        }

        label {
            padding-left: 0.5rem;
        }

        // noinspection SassScssResolvedByNameOnly
        &:hover {
            label {
                @extend %hover-bold;
            }
        }
    }
}

// Form containing and metadata field inputs and file upload controls.
//
// noinspection SassScssResolvedByNameOnly
.file-upload-form,
.file-upload-delete {

    @include grid([submit] auto [cancel] auto [file] auto [selected] 1fr);
    @include grid-gap(1.5rem);

    @media #{$narrow-screen} {
        @include grid-gap(0.5rem);
    }

    // Uploader for a new EMMA entry.
    &.new {}

    // Uploader for an existing EMMA entry.
    &.edit {}

    //=========================================================================
    // Elements - first grid row
    //=========================================================================

    %upload-control {
        @include grid-row(1);
        max-height: 2.25rem;
    }

    // Invisible element generated by #form_with only for the edit form.
    input[type="hidden"][name="_method"] { }

    // Invisible element generated by #form_with.
    input[type="hidden"][name="authenticity_token"] { }

    // ERB-provided submit to '/upload/create' or '/upload/update'.
    .submit-button { // input[type="submit"].uppy-FileInput-btn
        @extend %upload-control;
    }

    // ERB-provided cancel (back to '/upload/new' or '/upload/edit').
    .cancel-button { // button[type="cancel"].uppy-FileInput-btn
        @extend %upload-control;
    }

    // Appended to .file-upload-form and moved into place via file-upload.js.
    .uppy-FileInput-container {
        @extend %upload-control;
    }

    // Display for the selected filename moved into place by setupUpload()
    // in file-upload.js.
    .uploaded-filename {

        @include grid-row(1);

        line-height: 1.5;

        @media #{$narrow-screen} {
            @include grid-row(2);
            @include grid-column-span;
        }
    }

    // Invisible data holders.
    .upload-hidden {

        @extend %hidden;

        // Invisible file data holder.
        &[name="upload[file]"]#upload_file_data {}

        // Invisible EMMA data holder.
        &[name="upload[emma_data]"]#upload_emma_data {}

    }

    // ERB-provided file chooser.
    // JavaScript will hide this in favor of the Uppy-supplied button.
    input[type="file"][name="upload[file]"]#upload_file {}

    // Only for .file-upload-delete - the form that wraps the "Delete" button.
    .button_to {
        @include grid-row(1);
    }

    //=========================================================================
    // Elements - second grid row
    //=========================================================================

    // Control for filtering which upload form fields are displayed.
    // noinspection CssReplaceWithShorthandSafely
    .upload-field-control {

        @include grid-column-span;

        @media #{$narrow-screen} {
            margin-top: 0.5rem;
        }
    }

    //=========================================================================
    // Elements - final grid row
    //=========================================================================

    // Container for metadata field inputs.
    .upload-fields {
        @include grid-column-span;
    }

    //=========================================================================
    // Properties
    //=========================================================================

    // Add to a button to accent it as the next best action to perform.
    .best-choice {
        box-shadow: 0 0 0.5rem 0.25rem $button-accent;
    }
}

// The element which contains .file-upload-form.
//
// noinspection SassScssResolvedByNameOnly
.file-upload-container {

    // If true then the area where the status bar will appear during upload is
    // always present, effectively vertical white space except when visible.
    // This prevents the display from expanding and collapsing during the time
    // that Uppy displays the status bar.

    $status-bar-is-white-space: true;

    @include grid(max-content);
    @include grid-gap(1rem);

    @if $status-bar-is-white-space {
        margin-top: 0;
    } @else {
        margin-top: 2rem;
    }
    margin-bottom: 1.5rem;

    @media #{$wide-screen} {
        width: 50vw;
    }

    @media #{$narrow-screen} {
        @include grid(1fr);
    }

    @media #{$browser-ie} {
        display:        flex;
        flex-direction: row;
    }

    //=========================================================================
    // Elements
    //=========================================================================

    // Form containing and metadata field inputs and file upload controls.
    .file-upload-form {
        width:      inherit;
        margin-top: 0;
    }

    // Inserted by Uppy via file-upload.js if FEATURES.status_bar is true.
    .uppy-ProgressBar,
    .uppy-StatusBar {

        @include grid-row(1);
        @include grid-column-span;

        @if $status-bar-is-white-space {

            min-height: 3rem;

            &:before {
                background-color: transparent;
            }

            // Before upload is engaged.
            &.is-waiting {
                .uppy-StatusBar-actions {
                    background-color: transparent;
                }
            }

            // Back to "white space" after uploading is finished.
            &.is-complete {
                visibility: hidden;
            }
        }
    }

    // Inserted by Uppy via file-upload.js.
    // Doesn't need grid adjustment.
    .uppy-Informer { }
}

// List of upload actions (new, edit, delete).
ul.file-upload-actions {

    margin-top: 3rem;
    padding:    1rem 0 0;
    border-top: 2px solid gray;

    li { list-style-position: inside; }
}
