// app/assets/stylesheets/layouts/controls/_table.scss

@use 'shared/variables'      as v;
@use 'shared/controls/grids' as g;
@use 'shared/controls/table' as t;

// ============================================================================
// Grid-based table.
// ============================================================================

.grid-table {

    $table-gap:        1.75rem;
    $table-narrow-gap: 1rem;
    $table-border-bg:  v.$root-rev-bg-color;
    $table-border-fg:  v.$root-rev-fg-color;

    display:        grid;
    position:       relative;
    padding-bottom: $table-gap;
    line-height:    1.25;

    @media #{v.$narrow-screen} {
        padding-bottom: $table-narrow-gap;
    }

    //=========================================================================
    // Grid layout
    //=========================================================================

    $max-columns: 50;

    gap: $table-gap;

    @include g.grid-column-classes($max-columns, 1fr);
    @include g.grid-cell-col-classes($max-columns);

    @media #{v.$narrow-screen} {
        gap: $table-narrow-gap;
    }

    //=========================================================================
    // Elements
    //=========================================================================

    thead, tbody, tfoot, tr {
        display: contents;
    }

    thead {

        tr.spanner {
            display: none;
            z-index: v.$z-hidden;
        }

        th {
            min-width:     max-content;
            text-align:    start;
            border-bottom: 2px solid $table-border-bg;
            z-index:       v.$z-visible;
        }
    }

    td {
        z-index: v.$z-hidden - 1;
    }

    //=========================================================================
    // Variations
    //=========================================================================

    // Give the heading row a background.
    // @see ModelHelper::Table::DARK_HEAD
    &.dark-head {

        /**
         * Since "display: contents" makes the <tr> un-stylable an additional
         * <tr> is required which explicitly positioned so that the <tr> with
         * the actual <th> headings can be displayed above it in the Z-order.
         */
        thead {

            tr.spanner {
                display:    block;
                position:   absolute;
                height:     2.5rem;
                width:      100%;
                margin-top: -0.5rem;
                background: $table-border-bg;
            }

            th {
                color:         $table-border-fg;
                border-bottom: none;
            }
        }

        .col-first {
            margin-left: 0.5rem;
        }

        .col-last {
            margin-right: 0.5rem;
        }
    }

    // Make the heading row stick to the top of the table when scrolling.
    // @see ModelHelper::Table::STICKY_HEAD
    &.sticky-head {

        position:   sticky;
        top:        $table-gap;
        max-height: 95vh;
        overflow:   auto;
        background: v.$root-bg-color;

        @media #{v.$narrow-screen} {
            top: $table-narrow-gap;
        }

        //=====================================================================
        // Elements
        //=====================================================================

        thead {
            th {

                @include g.grid-row(1);

                position:    sticky;
                top:         0;
                padding-top: 0.5rem;
                background:  v.$root-bg-color;
            }
        }

        .col-last {
            margin-right: 0.5rem;
        }
    }

    &.sticky-head.dark-head {

        padding-bottom: 0;
        background:     v.$root-bg-color;
        border:         2px solid $table-border-bg;

        //=====================================================================
        // Elements
        //=====================================================================

        thead {

            tr.spanner {

                @include g.grid-row(1);
                @include g.grid-column-span;

                position: sticky;
                top:      0;
            }

            th {
                line-height: 2.5;
                padding-top: 0;
                background:  none;
            }
        }

        .row-last {

            padding-bottom: $table-gap;

            @media #{v.$narrow-screen} {
                padding-bottom: $table-narrow-gap;
            }
        }
    }

    //=========================================================================
    // Relative changes
    //=========================================================================

    & + ul.page-actions {
        margin-top: 1.25rem;
    }

    &.sticky-head + ul.page-actions {
        border: none;
    }
}
