# Support for debugging tests.
#
module TestHelper::Debugging
  TEST_DEBUG_FRAME: String

  TEST_DEBUG_INDENT: String

  RUN_TEST_OPT: symArray

  # Run the test code provided via the block.
  #
  # When debugging, this frames the console output generated by the test.
  #
  # @param [String, Symbol, nil] test_name
  # @param [Hash]                opt        Passed to #show_test_start and
  #                                           #show_test_end except for:
  #
  # @option opt [Symbol] :format
  #
  # @return [void]
  #
  def run_test: (String|Symbol|nil test_name, **untyped opt) { () -> void } -> void

  attr_reader tests_primed: bool | nil

  # Make sure that "Sign in as" is visible on the sign-in page by ensuring that
  # the interface is in "debug mode".
  #
  # @return [void]
  #
  def prime_tests: () -> void

  # Produce the top frame of debug output for a test.
  #
  # @param [String, Symbol, nil] test_name
  # @param [Hash]                opt
  #
  # @option opt [Symbol] :test        Overrides *test_name* if given.
  # @option opt [String] :part
  # @option opt [String] :frame       Default: #TEST_DEBUG_FRAME.
  #
  # @return [void]
  #
  def show_test_start: (String|Symbol|nil test_name, **untyped opt) -> void

  # Produce the bottom frame of debug output for a test.
  #
  # @param [String, Symbol, nil] test_name
  # @param [Hash]                opt
  #
  # @option opt [Symbol] :test        Overrides :name if given.
  # @option opt [String] :part
  # @option opt [String] :frame       Default: #TEST_DEBUG_FRAME.
  #
  # @return [void]
  #
  def show_test_end: (String|Symbol|nil test_name, **untyped opt) -> void

  SHOW_MODEL_OPT: symArray

  # Display item model in output.
  #
  # @param [ActiveRecord::Base] item
  # @param [Hash]               opt     Passed to #show except for:
  #
  # @option opt [String]  :indent       Default: #TEST_DEBUG_INDENT
  # @option opt [Boolean] :reflections  Default: *true*
  #
  # @return [String]
  #
  def show_model: (ActiveRecord::Base item, **untyped opt) -> String

  # Display item model associations in output.
  #
  # @param [ActiveRecord::Base] item
  # @param [Hash]               opt   Passed to #show except for:
  #
  # @option opt [String] :indent      Default: #TEST_DEBUG_INDENT
  #
  # @return [String]
  #
  def show_reflections: (ActiveRecord::Base item, **untyped opt) -> String

  # Display a URL in output.
  #
  # @param [URI, String, nil] url     Default: `#current_url`.
  # @param [Hash]             opt     Passed to #show.
  #
  # @return [String]
  #
  def show_url: (?url: String|URI|nil, **untyped opt) -> String

  # Display a user in output.
  #
  # @param [String, Symbol, User, nil] user   Default: `#current_user`.
  # @param [Hash]                      opt    Passed to #show.
  #
  # @return [String]
  #
  def show_user: (?user: String|Symbol|User|nil, **untyped opt) -> String

  # Display item contents in output.
  #
  # @param [Array<*>] items
  # @param [Hash]     opt             Passed to #show_model except for:
  #
  # @option opt [String] :output      If *false* the result is not displayed.
  #
  # @return [String]                  The displayable result.
  #
  # @yield To supply additional items.
  # @yieldreturn [Array, String, Any]
  #
  def show: (*untyped items, **untyped opt) { () -> (anyArray|String|untyped) } -> String

  TRACE_NL: String

  TRACE_BODY: Integer

  TRACE_SEPARATOR: Hash[String,String]

  SHOW_PRE_SEND_OPT: symArray

  SHOW_POST_SEND_OPT: symArray

  SHOW_TRACE_OPT: symArray

  # Display conditions prior to invoking an HTTP method.
  #
  # @param [Symbol] verb              HTTP verb (:get, :put, :post, :delete)
  # @param [String] url               Target URL or relative path.
  # @param [Hash]   opt               Passed to #show_trace except for:
  #
  # @option opt [String] :user
  # @option opt [Symbol] :format      Result format (:html, :json, :xml).
  # @option opt [Symbol] :verb        Overrides *verb* argument if given.
  # @option opt [String] :url         Overrides *url* argument if given.
  #
  # @return [String]                  The displayable result.
  #
  def show_pre_send: (Symbol verb, String url, **untyped opt) -> String

  # Display conditions after invoking an HTTP method.
  #
  # @param [Hash] opt                 Passed to #show_trace except for:
  #
  # @option opt [Symbol, String, Integer]      :expect
  # @option opt [Symbol, String, Integer]      :status
  # @option opt [ActionDispatch::TestResponse] :response
  #
  # @return [String]                  The displayable result.
  #
  def show_post_send: (**untyped opt) -> String

  # show_trace
  #
  # @param [Hash] opt                 Passed to #show except for:
  #
  # @option opt [String, Integer] :indent
  #
  # @return [String]                  The displayable result.
  #
  # @yield To supply pairs to be displayed.
  # @yieldreturn [Hash]
  #
  def show_trace: (**untyped opt) { () -> anyHash } -> String

  # This module is included in ActionDispatch::IntegrationTest to support
  # tracing of HTTP method calls.
  module Trace
    PRE_OPTIONS: symArray

    POST_OPTIONS: symArray

    TRACE_OPTIONS: symArray

    # Override HTTP methods defined in ActionDispatch::Integration::Runner
    # in order to surround the method calls with trace debugging information.
    #
    # No override methods are created if *base* is some other class/module
    # which doesn't define these methods.
    #
    # @param [Module] base
    #
    def self.included: (Module base) -> void
  end
end
