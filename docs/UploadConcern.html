<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: UploadConcern
  
    &mdash; Documentation by YARD 0.9.26
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "UploadConcern";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index (U)</a> &raquo;
    
    
    <span class="title">UploadConcern</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Module: UploadConcern
  
  
  
</h1>
<div class="box_info">
  

  
  
  <dl>
      <dt>Extended by:</dt>
      <dd>ActiveSupport::Concern</dd>
  </dl>
  
  
  
  <dl>
      <dt>Includes:</dt>
      <dd><span class='object_link'><a href="Emma/Csv.html" title="Emma::Csv (module)">Emma::Csv</a></span>, <span class='object_link'><a href="Emma/Json.html" title="Emma::Json (module)">Emma::Json</a></span>, <span class='object_link'><a href="ParamsHelper.html" title="ParamsHelper (module)">ParamsHelper</a></span>, <span class='object_link'><a href="UploadWorkflow/Properties.html" title="UploadWorkflow::Properties (module)">UploadWorkflow::Properties</a></span></dd>
  </dl>
  
  

  
  <dl>
    <dt>Included in:</dt>
    <dd><span class='object_link'><a href="UploadController.html" title="UploadController (class)">UploadController</a></span></dd>
  </dl>
  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>app/controllers/concerns/upload_concern.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Support methods for the “/upload” controller.</p>


  </div>
</div>
<div class="tags">
  

</div>
  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="MIME_REGISTRATION-constant" class="">MIME_REGISTRATION =
          
        </dt>
        <dd><pre class="code"><span class='const'><span class='object_link'><a href="FileNaming.html" title="FileNaming (module)">FileNaming</a></span></span><span class='period'>.</span><span class='id identifier rubyid_format_classes'><span class='object_link'><a href="FileNaming.html#format_classes-class_method" title="FileNaming.format_classes (method)">format_classes</a></span></span><span class='period'>.</span><span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:register_mime_types</span><span class='rparen'>)</span></pre></dd>
      
        <dt id="PAGE_PARAMS-constant" class="">PAGE_PARAMS =
          <div class="docstring">
  <div class="discussion">
    
<p>URL parameters involved in pagination.</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='qsymbols_beg'>%i[</span><span class='tstring_content'>page</span><span class='words_sep'> </span><span class='tstring_content'>start</span><span class='words_sep'> </span><span class='tstring_content'>offset</span><span class='words_sep'> </span><span class='tstring_content'>limit</span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre></dd>
      
        <dt id="FORM_PARAMS-constant" class="">FORM_PARAMS =
          <div class="docstring">
  <div class="discussion">
    
<p>URL parameters involved in form submission.</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='qsymbols_beg'>%i[</span><span class='tstring_content'>selected</span><span class='words_sep'> </span><span class='tstring_content'>field-group</span><span class='words_sep'> </span><span class='tstring_content'>cancel</span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre></dd>
      
        <dt id="IGNORED_UPLOAD_FORM_PARAMS-constant" class="">IGNORED_UPLOAD_FORM_PARAMS =
          <div class="docstring">
  <div class="discussion">
    
<p>POST/PUT/PATCH parameters from the upload form that are not relevant to the create/update of an Upload instance.</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="#PAGE_PARAMS-constant" title="UploadConcern::PAGE_PARAMS (constant)">PAGE_PARAMS</a></span></span> <span class='op'>+</span> <span class='const'><span class='object_link'><a href="#FORM_PARAMS-constant" title="UploadConcern::FORM_PARAMS (constant)">FORM_PARAMS</a></span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre></dd>
      
        <dt id="IDENTIFIER_PARAMS-constant" class="">IDENTIFIER_PARAMS =
          <div class="docstring">
  <div class="discussion">
    
<p>URL parameters associated with item/entry identification.</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='qsymbols_beg'>%i[</span><span class='tstring_content'>id</span><span class='words_sep'> </span><span class='tstring_content'>selected</span><span class='words_sep'> </span><span class='tstring_content'>submission_id</span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre></dd>
      
    </dl>
  



  
  
  <h3 class="inherited">Constants included
     from <span class='object_link'><a href="UploadWorkflow/Properties.html" title="UploadWorkflow::Properties (module)">UploadWorkflow::Properties</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="UploadWorkflow/Properties.html#BATCH_SIZE-constant" title="UploadWorkflow::Properties::BATCH_SIZE (constant)">UploadWorkflow::Properties::BATCH_SIZE</a></span>, <span class='object_link'><a href="UploadWorkflow/Properties.html#BATCH_SIZE_DEFAULT-constant" title="UploadWorkflow::Properties::BATCH_SIZE_DEFAULT (constant)">UploadWorkflow::Properties::BATCH_SIZE_DEFAULT</a></span>, <span class='object_link'><a href="UploadWorkflow/Properties.html#DEV_TITLE_PREFIX-constant" title="UploadWorkflow::Properties::DEV_TITLE_PREFIX (constant)">UploadWorkflow::Properties::DEV_TITLE_PREFIX</a></span>, <span class='object_link'><a href="UploadWorkflow/Properties.html#EMERGENCY_DELETE_DEFAULT-constant" title="UploadWorkflow::Properties::EMERGENCY_DELETE_DEFAULT (constant)">UploadWorkflow::Properties::EMERGENCY_DELETE_DEFAULT</a></span>, <span class='object_link'><a href="UploadWorkflow/Properties.html#FORCE_DELETE_DEFAULT-constant" title="UploadWorkflow::Properties::FORCE_DELETE_DEFAULT (constant)">UploadWorkflow::Properties::FORCE_DELETE_DEFAULT</a></span>, <span class='object_link'><a href="UploadWorkflow/Properties.html#INGEST_MAX_SIZE-constant" title="UploadWorkflow::Properties::INGEST_MAX_SIZE (constant)">UploadWorkflow::Properties::INGEST_MAX_SIZE</a></span>, <span class='object_link'><a href="UploadWorkflow/Properties.html#MAX_BATCH_SIZE-constant" title="UploadWorkflow::Properties::MAX_BATCH_SIZE (constant)">UploadWorkflow::Properties::MAX_BATCH_SIZE</a></span>, <span class='object_link'><a href="UploadWorkflow/Properties.html#REPO_CREATE_DEFAULT-constant" title="UploadWorkflow::Properties::REPO_CREATE_DEFAULT (constant)">UploadWorkflow::Properties::REPO_CREATE_DEFAULT</a></span>, <span class='object_link'><a href="UploadWorkflow/Properties.html#REPO_EDIT_DEFAULT-constant" title="UploadWorkflow::Properties::REPO_EDIT_DEFAULT (constant)">UploadWorkflow::Properties::REPO_EDIT_DEFAULT</a></span>, <span class='object_link'><a href="UploadWorkflow/Properties.html#REPO_REMOVE_DEFAULT-constant" title="UploadWorkflow::Properties::REPO_REMOVE_DEFAULT (constant)">UploadWorkflow::Properties::REPO_REMOVE_DEFAULT</a></span>, <span class='object_link'><a href="UploadWorkflow/Properties.html#THROTTLE_PAUSE-constant" title="UploadWorkflow::Properties::THROTTLE_PAUSE (constant)">UploadWorkflow::Properties::THROTTLE_PAUSE</a></span>, <span class='object_link'><a href="UploadWorkflow/Properties.html#TITLE_PREFIX-constant" title="UploadWorkflow::Properties::TITLE_PREFIX (constant)">UploadWorkflow::Properties::TITLE_PREFIX</a></span>, <span class='object_link'><a href="UploadWorkflow/Properties.html#TRUNCATE_DELETE_DEFAULT-constant" title="UploadWorkflow::Properties::TRUNCATE_DELETE_DEFAULT (constant)">UploadWorkflow::Properties::TRUNCATE_DELETE_DEFAULT</a></span>, <span class='object_link'><a href="UploadWorkflow/Properties.html#WF_URL_PARAMETER-constant" title="UploadWorkflow::Properties::WF_URL_PARAMETER (constant)">UploadWorkflow::Properties::WF_URL_PARAMETER</a></span></p>

  
  
  <h3 class="inherited">Constants included
     from <span class='object_link'><a href="UploadWorkflow/Errors.html" title="UploadWorkflow::Errors (module)">UploadWorkflow::Errors</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="UploadWorkflow/Errors.html#DEFAULT_ERROR_MESSAGE-constant" title="UploadWorkflow::Errors::DEFAULT_ERROR_MESSAGE (constant)">UploadWorkflow::Errors::DEFAULT_ERROR_MESSAGE</a></span>, <span class='object_link'><a href="UploadWorkflow/Errors.html#INTERNAL_EXCEPTION-constant" title="UploadWorkflow::Errors::INTERNAL_EXCEPTION (constant)">UploadWorkflow::Errors::INTERNAL_EXCEPTION</a></span>, <span class='object_link'><a href="UploadWorkflow/Errors.html#UPLOAD_ERROR-constant" title="UploadWorkflow::Errors::UPLOAD_ERROR (constant)">UploadWorkflow::Errors::UPLOAD_ERROR</a></span></p>

  
  
  <h3 class="inherited">Constants included
     from <span class='object_link'><a href="UploadWorkflow/Errors/RenderMethods.html" title="UploadWorkflow::Errors::RenderMethods (module)">UploadWorkflow::Errors::RenderMethods</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="UploadWorkflow/Errors/RenderMethods.html#DEFAULT_LABEL-constant" title="UploadWorkflow::Errors::RenderMethods::DEFAULT_LABEL (constant)">UploadWorkflow::Errors::RenderMethods::DEFAULT_LABEL</a></span></p>

  
  
  <h3 class="inherited">Constants included
     from <span class='object_link'><a href="Emma/Debug.html" title="Emma::Debug (module)">Emma::Debug</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Emma/Debug.html#DEBUG_SEPARATOR-constant" title="Emma::Debug::DEBUG_SEPARATOR (constant)">Emma::Debug::DEBUG_SEPARATOR</a></span></p>

  
  
  <h3 class="inherited">Constants included
     from <span class='object_link'><a href="Emma/Common.html" title="Emma::Common (module)">Emma::Common</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Emma/Common.html#BOOLEAN_VALUES-constant" title="Emma::Common::BOOLEAN_VALUES (constant)">Emma::Common::BOOLEAN_VALUES</a></span>, <span class='object_link'><a href="Emma/Common.html#HTML_QUOTES-constant" title="Emma::Common::HTML_QUOTES (constant)">Emma::Common::HTML_QUOTES</a></span>, <span class='object_link'><a href="Emma/Common.html#INFLECT_PLURAL-constant" title="Emma::Common::INFLECT_PLURAL (constant)">Emma::Common::INFLECT_PLURAL</a></span>, <span class='object_link'><a href="Emma/Common.html#INFLECT_SINGULAR-constant" title="Emma::Common::INFLECT_SINGULAR (constant)">Emma::Common::INFLECT_SINGULAR</a></span>, <span class='object_link'><a href="Emma/Common.html#LIST_SEPARATOR-constant" title="Emma::Common::LIST_SEPARATOR (constant)">Emma::Common::LIST_SEPARATOR</a></span>, <span class='object_link'><a href="Emma/Common.html#PAIR_SEPARATOR-constant" title="Emma::Common::PAIR_SEPARATOR (constant)">Emma::Common::PAIR_SEPARATOR</a></span>, <span class='object_link'><a href="Emma/Common.html#QUOTE_MARKS-constant" title="Emma::Common::QUOTE_MARKS (constant)">Emma::Common::QUOTE_MARKS</a></span></p>

  
  
  <h3 class="inherited">Constants included
     from <span class='object_link'><a href="ParamsHelper.html" title="ParamsHelper (module)">ParamsHelper</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="ParamsHelper.html#COMPRESSION_MARKER-constant" title="ParamsHelper::COMPRESSION_MARKER (constant)">ParamsHelper::COMPRESSION_MARKER</a></span>, <span class='object_link'><a href="ParamsHelper.html#IGNORED_PARAMETERS-constant" title="ParamsHelper::IGNORED_PARAMETERS (constant)">ParamsHelper::IGNORED_PARAMETERS</a></span></p>





  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#find_or_match_records-instance_method" title="#find_or_match_records (instance method)">#<strong>find_or_match_records</strong>(*items, **opt)  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Locate and filter records.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_record-instance_method" title="#get_record (instance method)">#<strong>get_record</strong>(id)  &#x21d2; Upload<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Return with the specified record or <strong>nil</strong> if one could not be found.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_upload_params-instance_method" title="#get_upload_params (instance method)">#<strong>get_upload_params</strong>(p = nil)  &#x21d2; Hash{Symbol=&gt;*} </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get URL parameters relevant to the current operation.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#post_response-instance_method" title="#post_response (instance method)">#<strong>post_response</strong>(status, item = nil, redirect: nil, xhr: nil, meth: nil)  &#x21d2; * </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Generate a response to a POST.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#proxy_get_record-instance_method" title="#proxy_get_record (instance method)">#<strong>proxy_get_record</strong>(sid, host)  &#x21d2; Upload<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get item data from the production service.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_identifiers-instance_method" title="#set_identifiers (instance method)">#<strong>set_identifiers</strong>(p = nil)  &#x21d2; String<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Extract the best-match URL parameter which represents an item identifier.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#upload_bulk_post_parameters-instance_method" title="#upload_bulk_post_parameters (instance method)">#<strong>upload_bulk_post_parameters</strong>(p = nil, req = nil)  &#x21d2; Array&lt;Hash&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Extract POST parameters and data for bulk operations.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#upload_params-instance_method" title="#upload_params (instance method)">#<strong>upload_params</strong>  &#x21d2; Hash{Symbol=&gt;*} </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>URL parameters relevant to the current operation.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#upload_post_parameters-instance_method" title="#upload_post_parameters (instance method)">#<strong>upload_post_parameters</strong>(p = nil)  &#x21d2; Hash{Symbol=&gt;*} </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Extract POST parameters that are usable for creating/updating an Upload instance.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#wf_bulk-instance_method" title="#wf_bulk (instance method)">#<strong>wf_bulk</strong>(rec: nil, data: nil, **opt)  &#x21d2; Array&lt;Upload,String&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Gather information to create a bulk upload workflow instance.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#wf_check_partial_failure-instance_method" title="#wf_check_partial_failure (instance method)">#<strong>wf_check_partial_failure</strong>(wf = @workflow)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Produce flash error messages for failures that did not abort the workflow step but did affect the outcome (e.g. for bulk uploads where some of the original files could not be acquired).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#wf_single-instance_method" title="#wf_single (instance method)">#<strong>wf_single</strong>(rec: nil, data: nil, **opt)  &#x21d2; * </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Gather information to create an upload workflow instance.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#wf_single_check-instance_method" title="#wf_single_check (instance method)">#<strong>wf_single_check</strong>(rec: nil, **opt)  &#x21d2; Array&lt;String&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Determine whether the workflow state of the indicated item can be advanced.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#workflow_parameters-instance_method" title="#workflow_parameters (instance method)">#<strong>workflow_parameters</strong>  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>workflow_parameters.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="UploadWorkflow/Properties.html" title="UploadWorkflow::Properties (module)">UploadWorkflow::Properties</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="UploadWorkflow/Properties.html#batch_size-instance_method" title="UploadWorkflow::Properties#batch_size (method)">#batch_size</a></span>, <span class='object_link'><a href="UploadWorkflow/Properties.html#emergency_delete-instance_method" title="UploadWorkflow::Properties#emergency_delete (method)">#emergency_delete</a></span>, <span class='object_link'><a href="UploadWorkflow/Properties.html#force_delete-instance_method" title="UploadWorkflow::Properties#force_delete (method)">#force_delete</a></span>, <span class='object_link'><a href="UploadWorkflow/Properties.html#repo_create-instance_method" title="UploadWorkflow::Properties#repo_create (method)">#repo_create</a></span>, <span class='object_link'><a href="UploadWorkflow/Properties.html#repo_edit-instance_method" title="UploadWorkflow::Properties#repo_edit (method)">#repo_edit</a></span>, <span class='object_link'><a href="UploadWorkflow/Properties.html#repo_remove-instance_method" title="UploadWorkflow::Properties#repo_remove (method)">#repo_remove</a></span>, <span class='object_link'><a href="UploadWorkflow/Properties.html#title_prefix-instance_method" title="UploadWorkflow::Properties#title_prefix (method)">#title_prefix</a></span>, <span class='object_link'><a href="UploadWorkflow/Properties.html#truncate_delete-instance_method" title="UploadWorkflow::Properties#truncate_delete (method)">#truncate_delete</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="UploadWorkflow/Errors.html" title="UploadWorkflow::Errors (module)">UploadWorkflow::Errors</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="UploadWorkflow/Errors.html#failure-instance_method" title="UploadWorkflow::Errors#failure (method)">#failure</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="UploadWorkflow/Errors/RenderMethods.html" title="UploadWorkflow::Errors::RenderMethods (module)">UploadWorkflow::Errors::RenderMethods</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="UploadWorkflow/Errors/RenderMethods.html#make_label-instance_method" title="UploadWorkflow::Errors::RenderMethods#make_label (method)">#make_label</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Emma/Debug.html" title="Emma::Debug (module)">Emma::Debug</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Emma/Debug.html#__debug_args-instance_method" title="Emma::Debug#__debug_args (method)">#__debug_args</a></span>, <span class='object_link'><a href="Emma/Debug.html#__debug_env_hash-instance_method" title="Emma::Debug#__debug_env_hash (method)">#__debug_env_hash</a></span>, <span class='object_link'><a href="Emma/Debug.html#__debug_exception-instance_method" title="Emma::Debug#__debug_exception (method)">#__debug_exception</a></span>, <span class='object_link'><a href="Emma/Debug.html#__debug_header_hash-instance_method" title="Emma::Debug#__debug_header_hash (method)">#__debug_header_hash</a></span>, <span class='object_link'><a href="Emma/Debug.html#__debug_items-instance_method" title="Emma::Debug#__debug_items (method)">#__debug_items</a></span>, <span class='object_link'><a href="Emma/Debug.html#__debug_label-instance_method" title="Emma::Debug#__debug_label (method)">#__debug_label</a></span>, <span class='object_link'><a href="Emma/Debug.html#__debug_line-instance_method" title="Emma::Debug#__debug_line (method)">#__debug_line</a></span>, <span class='object_link'><a href="Emma/Debug.html#__debug_request-instance_method" title="Emma::Debug#__debug_request (method)">#__debug_request</a></span>, <span class='object_link'><a href="Emma/Debug.html#__debug_route-instance_method" title="Emma::Debug#__debug_route (method)">#__debug_route</a></span>, <span class='object_link'><a href="Emma/Debug.html#__debug_route_label-instance_method" title="Emma::Debug#__debug_route_label (method)">#__debug_route_label</a></span>, <span class='object_link'><a href="Emma/Debug.html#__debug_session_hash-instance_method" title="Emma::Debug#__debug_session_hash (method)">#__debug_session_hash</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Emma/Common.html" title="Emma::Common (module)">Emma::Common</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Emma/Common.html#array_string-instance_method" title="Emma::Common#array_string (method)">#array_string</a></span>, <span class='object_link'><a href="Emma/Common.html#boolean%3F-instance_method" title="Emma::Common#boolean? (method)">#boolean?</a></span>, <span class='object_link'><a href="Emma/Common.html#build_query_options-instance_method" title="Emma::Common#build_query_options (method)">#build_query_options</a></span>, <span class='object_link'><a href="Emma/Common.html#calling_method-instance_method" title="Emma::Common#calling_method (method)">#calling_method</a></span>, <span class='object_link'><a href="Emma/Common.html#digits_only%3F-instance_method" title="Emma::Common#digits_only? (method)">#digits_only?</a></span>, <span class='object_link'><a href="Emma/Common.html#get_method-instance_method" title="Emma::Common#get_method (method)">#get_method</a></span>, <span class='object_link'><a href="Emma/Common.html#get_params-instance_method" title="Emma::Common#get_params (method)">#get_params</a></span>, <span class='object_link'><a href="Emma/Common.html#hash_string-instance_method" title="Emma::Common#hash_string (method)">#hash_string</a></span>, <span class='object_link'><a href="Emma/Common.html#html_id-instance_method" title="Emma::Common#html_id (method)">#html_id</a></span>, <span class='object_link'><a href="Emma/Common.html#inflection-instance_method" title="Emma::Common#inflection (method)">#inflection</a></span>, <span class='object_link'><a href="Emma/Common.html#labelize-instance_method" title="Emma::Common#labelize (method)">#labelize</a></span>, <span class='object_link'><a href="Emma/Common.html#make_path-instance_method" title="Emma::Common#make_path (method)">#make_path</a></span>, <span class='object_link'><a href="Emma/Common.html#named_format_references-instance_method" title="Emma::Common#named_format_references (method)">#named_format_references</a></span>, <span class='object_link'><a href="Emma/Common.html#non_breaking-instance_method" title="Emma::Common#non_breaking (method)">#non_breaking</a></span>, <span class='object_link'><a href="Emma/Common.html#non_negative-instance_method" title="Emma::Common#non_negative (method)">#non_negative</a></span>, <span class='object_link'><a href="Emma/Common.html#normalized_list-instance_method" title="Emma::Common#normalized_list (method)">#normalized_list</a></span>, <span class='object_link'><a href="Emma/Common.html#partition_options-instance_method" title="Emma::Common#partition_options (method)">#partition_options</a></span>, <span class='object_link'><a href="Emma/Common.html#positive-instance_method" title="Emma::Common#positive (method)">#positive</a></span>, <span class='object_link'><a href="Emma/Common.html#quote-instance_method" title="Emma::Common#quote (method)">#quote</a></span>, <span class='object_link'><a href="Emma/Common.html#reject_blanks-instance_method" title="Emma::Common#reject_blanks (method)">#reject_blanks</a></span>, <span class='object_link'><a href="Emma/Common.html#sanitized_string-instance_method" title="Emma::Common#sanitized_string (method)">#sanitized_string</a></span>, <span class='object_link'><a href="Emma/Common.html#strip_quotes-instance_method" title="Emma::Common#strip_quotes (method)">#strip_quotes</a></span>, <span class='object_link'><a href="Emma/Common.html#url_escape-instance_method" title="Emma::Common#url_escape (method)">#url_escape</a></span>, <span class='object_link'><a href="Emma/Common.html#url_query-instance_method" title="Emma::Common#url_query (method)">#url_query</a></span></p>

  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="ParamsHelper.html" title="ParamsHelper (module)">ParamsHelper</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="ParamsHelper.html#compress_value-instance_method" title="ParamsHelper#compress_value (method)">#compress_value</a></span>, <span class='object_link'><a href="ParamsHelper.html#compressed_value%3F-instance_method" title="ParamsHelper#compressed_value? (method)">#compressed_value?</a></span>, <span class='object_link'><a href="ParamsHelper.html#decompress_value-instance_method" title="ParamsHelper#decompress_value (method)">#decompress_value</a></span>, <span class='object_link'><a href="ParamsHelper.html#local_request%3F-instance_method" title="ParamsHelper#local_request? (method)">#local_request?</a></span>, <span class='object_link'><a href="ParamsHelper.html#request_parameter_count-instance_method" title="ParamsHelper#request_parameter_count (method)">#request_parameter_count</a></span>, <span class='object_link'><a href="ParamsHelper.html#request_parameters-instance_method" title="ParamsHelper#request_parameters (method)">#request_parameters</a></span>, <span class='object_link'><a href="ParamsHelper.html#request_path-instance_method" title="ParamsHelper#request_path (method)">#request_path</a></span>, <span class='object_link'><a href="ParamsHelper.html#request_xhr%3F-instance_method" title="ParamsHelper#request_xhr? (method)">#request_xhr?</a></span>, <span class='object_link'><a href="ParamsHelper.html#route_request%3F-instance_method" title="ParamsHelper#route_request? (method)">#route_request?</a></span>, <span class='object_link'><a href="ParamsHelper.html#same_request%3F-instance_method" title="ParamsHelper#same_request? (method)">#same_request?</a></span>, <span class='object_link'><a href="ParamsHelper.html#session_section-instance_method" title="ParamsHelper#session_section (method)">#session_section</a></span>, <span class='object_link'><a href="ParamsHelper.html#url_parameters-instance_method" title="ParamsHelper#url_parameters (method)">#url_parameters</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Emma/Json.html" title="Emma::Json (module)">Emma::Json</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Emma/Json.html#json_parse-instance_method" title="Emma::Json#json_parse (method)">#json_parse</a></span>, <span class='object_link'><a href="Emma/Json.html#pretty_json-instance_method" title="Emma::Json#pretty_json (method)">#pretty_json</a></span>, <span class='object_link'><a href="Emma/Json.html#safe_json_parse-instance_method" title="Emma::Json#safe_json_parse (method)">#safe_json_parse</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Emma/Csv.html" title="Emma::Csv (module)">Emma::Csv</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Emma/Csv.html#csv_parse-instance_method" title="Emma::Csv#csv_parse (method)">#csv_parse</a></span></p>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="find_or_match_records-instance_method">
  
    #<strong>find_or_match_records</strong>(*items, **opt)  &#x21d2; <tt>Hash</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Locate and filter records.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>items</span>
      
      
        <span class='type'>(<tt>Array&lt;String,Array&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Default: `@identifier`.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>opt</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Passed to Upload#search_records; default: `#upload_params` if no <strong>items</strong> are given.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>Upload#search_records</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/concerns/upload_concern.rb', line 235</span>

<span class='kw'>def</span> <span class='id identifier rubyid_find_or_match_records'>find_or_match_records</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_items'>items</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opt'>opt</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_items'>items</span> <span class='op'>=</span> <span class='id identifier rubyid_items'>items</span><span class='period'>.</span><span class='id identifier rubyid_flatten'>flatten</span><span class='period'>.</span><span class='id identifier rubyid_compact'>compact</span>
  <span class='id identifier rubyid_items'>items</span> <span class='op'>&lt;&lt;</span> <span class='ivar'>@identifier</span> <span class='kw'>if</span> <span class='id identifier rubyid_items'>items</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@identifier</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>

  <span class='comment'># If neither items nor field queries were given, use request parameters.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_items'>items</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='id identifier rubyid_opt'>opt</span><span class='lbracket'>[</span><span class='symbol'>:groups</span><span class='rbracket'>]</span> <span class='op'>!=</span> <span class='symbol'>:only</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_option_keys'>option_keys</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Upload.html" title="Upload (class)">Upload</a></span></span><span class='op'>::</span><span class='const'>SEARCH_RECORDS_OPTIONS</span> <span class='op'>-</span> <span class='qsymbols_beg'>%i[</span><span class='tstring_content'>offset</span><span class='words_sep'> </span><span class='tstring_content'>limit</span><span class='tstring_end'>]</span></span>
    <span class='id identifier rubyid_opt'>opt</span> <span class='op'>=</span> <span class='id identifier rubyid_upload_params'>upload_params</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_opt'>opt</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_opt'>opt</span><span class='period'>.</span><span class='id identifier rubyid_except'>except</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_option_keys'>option_keys</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_opt'>opt</span><span class='lbracket'>[</span><span class='symbol'>:limit</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='int'>20</span> <span class='comment'># TODO: Default page size for Upload index.
</span>  <span class='id identifier rubyid_opt'>opt</span><span class='lbracket'>[</span><span class='symbol'>:page</span><span class='rbracket'>]</span>  <span class='op'>||=</span> <span class='int'>0</span>  <span class='comment'># Start at the first page by default.
</span>
  <span class='comment'># Disallow experimental database WHERE predicates unless privileged.
</span>  <span class='id identifier rubyid_admin'>admin</span> <span class='op'>=</span> <span class='kw'>true</span> <span class='comment'># TODO: delete
</span>  <span class='comment'>#admin = can?(:manage, Upload) # TODO: restore
</span>  <span class='id identifier rubyid_opt'>opt</span><span class='period'>.</span><span class='id identifier rubyid_slice!'>slice!</span><span class='lparen'>(</span><span class='symbol'>:user</span><span class='comma'>,</span> <span class='symbol'>:user_id</span><span class='comma'>,</span> <span class='symbol'>:state</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_admin'>admin</span>

  <span class='comment'># Select records for the current user unless a different user has been
</span>  <span class='comment'># specified (or all records if specified as &#39;*&#39;, &#39;all&#39;, or &#39;false&#39;).
</span>  <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_opt'>opt</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:user</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_opt'>opt</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:user_id</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='id identifier rubyid_u'>u</span> <span class='op'>||</span> <span class='ivar'>@user</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_u'>u</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='id identifier rubyid_u'>u</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_u'>u</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span>
    <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='int'>0</span>      <span class='kw'>if</span> <span class='qwords_beg'>%w(</span><span class='tstring_content'>*</span><span class='words_sep'> </span><span class='tstring_content'>0</span><span class='words_sep'> </span><span class='tstring_content'>all</span><span class='words_sep'> </span><span class='tstring_content'>false</span><span class='tstring_end'>)</span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_u'>u</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_u'>u</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='kw'>if</span> <span class='id identifier rubyid_digits_only?'>digits_only?</span><span class='lparen'>(</span><span class='id identifier rubyid_u'>u</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='comment'># noinspection RubyCaseWithoutElseBlockInspection
</span>  <span class='kw'>case</span> <span class='id identifier rubyid_u'>u</span>
    <span class='kw'>when</span> <span class='int'>0</span>       <span class='kw'>then</span> <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='kw'>when</span> <span class='const'>Integer</span> <span class='kw'>then</span> <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="User.html" title="User (class)">User</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_u'>u</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='const'>String</span>  <span class='kw'>then</span> <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="User.html" title="User (class)">User</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>email:</span> <span class='id identifier rubyid_u'>u</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_u'>u</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="User.html" title="User (class)">User</a></span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_opt'>opt</span><span class='lbracket'>[</span><span class='symbol'>:user_id</span><span class='rbracket'>]</span>   <span class='op'>=</span> <span class='id identifier rubyid_u'>u</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>  <span class='kw'>if</span> <span class='id identifier rubyid_u'>u</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
    <span class='id identifier rubyid_opt'>opt</span><span class='lbracket'>[</span><span class='symbol'>:edit_user</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_u'>u</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span> <span class='kw'>if</span> <span class='id identifier rubyid_u'>u</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
  <span class='kw'>end</span>

  <span class='comment'># Limit records to those in the given state (or records with an empty state
</span>  <span class='comment'># field if specified as &#39;nil&#39;, &#39;empty&#39;, or &#39;missing&#39;).
</span>  <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_opt'>opt</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:state</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
    <span class='kw'>if</span> <span class='qwords_beg'>%w(</span><span class='tstring_content'>empty</span><span class='words_sep'> </span><span class='tstring_content'>false</span><span class='words_sep'> </span><span class='tstring_content'>missing</span><span class='words_sep'> </span><span class='tstring_content'>nil</span><span class='words_sep'> </span><span class='tstring_content'>none</span><span class='words_sep'> </span><span class='tstring_content'>null</span><span class='tstring_end'>)</span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_opt'>opt</span><span class='lbracket'>[</span><span class='symbol'>:state</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_opt'>opt</span><span class='lbracket'>[</span><span class='symbol'>:state</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span>
      <span class='id identifier rubyid_opt'>opt</span><span class='lbracket'>[</span><span class='symbol'>:edit_state</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='id identifier rubyid_s'>s</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Limit by workflow status group.
</span>  <span class='id identifier rubyid_group'>group</span> <span class='op'>=</span> <span class='id identifier rubyid_opt'>opt</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:group</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_group'>group</span> <span class='op'>=</span> <span class='id identifier rubyid_group'>group</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\s*,\s*</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_group'>group</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_group'>group</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_wrap'>wrap</span><span class='lparen'>(</span><span class='id identifier rubyid_group'>group</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_reject'>reject</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:blank?</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_group'>group</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
    <span class='id identifier rubyid_group'>group</span><span class='period'>.</span><span class='id identifier rubyid_map!'>map!</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:downcase</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map!'>map!</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:to_sym</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_group'>group</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='symbol'>:all</span><span class='rparen'>)</span>
      <span class='qsymbols_beg'>%i[</span><span class='tstring_content'>state</span><span class='words_sep'> </span><span class='tstring_content'>edit_state</span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='op'>|</span> <span class='id identifier rubyid_opt'>opt</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_k'>k</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_states'>states</span> <span class='op'>=</span>
        <span class='id identifier rubyid_group'>group</span><span class='period'>.</span><span class='id identifier rubyid_flat_map'>flat_map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_g'>g</span><span class='op'>|</span>
          <span class='const'><span class='object_link'><a href="Upload.html" title="Upload (class)">Upload</a></span></span><span class='op'>::</span><span class='const'>STATE_GROUP</span><span class='period'>.</span><span class='id identifier rubyid_dig'>dig</span><span class='lparen'>(</span><span class='id identifier rubyid_g'>g</span><span class='comma'>,</span> <span class='symbol'>:states</span><span class='rparen'>)</span>
        <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_compact'>compact</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:to_s</span><span class='rparen'>)</span>
      <span class='qsymbols_beg'>%i[</span><span class='tstring_content'>state</span><span class='words_sep'> </span><span class='tstring_content'>edit_state</span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='op'>|</span>
        <span class='id identifier rubyid_opt'>opt</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_wrap'>wrap</span><span class='lparen'>(</span><span class='id identifier rubyid_opt'>opt</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='id identifier rubyid_states'>states</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_uniq'>uniq</span>
        <span class='id identifier rubyid_opt'>opt</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_k'>k</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_opt'>opt</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='const'><span class='object_link'><a href="Upload.html" title="Upload (class)">Upload</a></span></span><span class='period'>.</span><span class='id identifier rubyid_search_records'>search_records</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_items'>items</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opt'>opt</span><span class='rparen'>)</span>

<span class='kw'>rescue</span> <span class='const'>RangeError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>

  <span class='comment'># Re-cast as a SubmitError so that UploadController#index redirects to
</span>  <span class='comment'># the main index page instead of the root page.
</span>  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="UploadWorkflow.html" title="UploadWorkflow (class)">UploadWorkflow</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="UploadWorkflow/Errors/SubmitError.html" title="UploadWorkflow::Errors::SubmitError (class)">SubmitError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_record-instance_method">
  
    #<strong>get_record</strong>(id)  &#x21d2; <tt><span class='object_link'><a href="Upload.html" title="Upload (class)">Upload</a></span></tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Return with the specified record or <strong>nil</strong> if one could not be found.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>id</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Hash</tt>, <tt><span class='object_link'><a href="Upload.html" title="Upload (class)">Upload</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Upload.html" title="Upload (class)">Upload</a></span></tt>, <tt>nil</tt>)</span>
      
      
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>StandardError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>If <strong>item</strong> not found.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>Upload#get_record</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


323
324
325
326
327
328
329
330
331
332</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/concerns/upload_concern.rb', line 323</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_record'>get_record</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Upload.html" title="Upload (class)">Upload</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_record'>get_record</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_result'>result</span>
  <span class='kw'>elsif</span> <span class='const'><span class='object_link'><a href="Upload.html" title="Upload (class)">Upload</a></span></span><span class='period'>.</span><span class='id identifier rubyid_id_term'>id_term</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
    <span class='id identifier rubyid_failure'>failure</span><span class='lparen'>(</span><span class='symbol'>:file_id</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='const'><span class='object_link'><a href="top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid___method__'>__method__</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_content'>: non-existent record</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
    <span class='id identifier rubyid_failure'>failure</span><span class='lparen'>(</span><span class='symbol'>:find</span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_upload_params-instance_method">
  
    #<strong>get_upload_params</strong>(p = nil)  &#x21d2; <tt>Hash{Symbol=&gt;*}</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get URL parameters relevant to the current operation.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>p</span>
      
      
        <span class='type'>(<tt>ActionController::Parameters</tt>, <tt>Hash</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Def: `#url_parameters`</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash{Symbol=&gt;*}</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


84
85
86
87
88
89</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/concerns/upload_concern.rb', line 84</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_upload_params'>get_upload_params</span><span class='lparen'>(</span><span class='id identifier rubyid_p'>p</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_prm'>prm</span> <span class='op'>=</span> <span class='id identifier rubyid_url_parameters'>url_parameters</span><span class='lparen'>(</span><span class='id identifier rubyid_p'>p</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_prm'>prm</span><span class='period'>.</span><span class='id identifier rubyid_except!'>except!</span><span class='lparen'>(</span><span class='op'>*</span><span class='const'><span class='object_link'><a href="#IGNORED_UPLOAD_FORM_PARAMS-constant" title="UploadConcern::IGNORED_UPLOAD_FORM_PARAMS (constant)">IGNORED_UPLOAD_FORM_PARAMS</a></span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_prm'>prm</span><span class='period'>.</span><span class='id identifier rubyid_deep_symbolize_keys!'>deep_symbolize_keys!</span>
  <span class='id identifier rubyid_reject_blanks'>reject_blanks</span><span class='lparen'>(</span><span class='id identifier rubyid_prm'>prm</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="post_response-instance_method">
  
    
      <span class="overload">#<strong>post_response</strong>(status, item, **)  &#x21d2; <tt>*</tt> </span>
    
      <span class="overload">#<strong>post_response</strong>(except, **)  &#x21d2; <tt>*</tt> </span>
    
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Generate a response to a POST.</p>

<h2 id="label-Variations">Variations</h2>


  </div>
</div>
<div class="tags">
  
  <p class="tag_title">Overloads:</p>
  <ul class="overload">
    
      
      <li class="overload_item">
        <span class="signature">#<strong>post_response</strong>(status, item, **)  &#x21d2; <tt>*</tt> </span>
        <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>status</span>
      
      
        <span class='type'>(<tt>Symbol</tt>, <tt>Integer</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>item</span>
      
      
        <span class='type'>(<tt>Exception</tt>, <tt>String</tt>, <tt>Array</tt>)</span>
      
      
      
    </li>
  
</ul>


</div>
      </li>
    
      
      <li class="overload_item">
        <span class="signature">#<strong>post_response</strong>(except, **)  &#x21d2; <tt>*</tt> </span>
        <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>except</span>
      
      
        <span class='type'>(<tt>Exception</tt>)</span>
      
      
      
    </li>
  
</ul>


</div>
      </li>
    
  </ul>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>status</span>
      
      
        <span class='type'>(<tt>Symbol</tt>, <tt>Integer</tt>, <tt>Exception</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>item</span>
      
      
        <span class='type'>(<tt>Exception</tt>, <tt>String</tt>, <tt>Array</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>redirect</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>FalseClass</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>xhr</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="top-level-namespace.html#Boolean-constant" title="Boolean (constant)">Boolean</a></span></tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Override `request.xhr?`.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>meth</span>
      
      
        <span class='type'>(<tt>Symbol</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Calling method.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>*</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/concerns/upload_concern.rb', line 479</span>

<span class='kw'>def</span> <span class='id identifier rubyid_post_response'>post_response</span><span class='lparen'>(</span><span class='id identifier rubyid_status'>status</span><span class='comma'>,</span> <span class='id identifier rubyid_item'>item</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>redirect:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>xhr:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>meth:</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_meth'>meth</span> <span class='op'>||=</span> <span class='id identifier rubyid_calling_method'>calling_method</span>
  <span class='id identifier rubyid___debug_args'>__debug_args</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UPLOAD </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_meth'>meth</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid___method__'>__method__</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_binding'>binding</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_status'>status</span><span class='comma'>,</span> <span class='id identifier rubyid_item'>item</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_status'>status</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_status'>status</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Exception</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Exception</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_status'>status</span> <span class='op'>||=</span> <span class='lparen'>(</span><span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_code'>code</span>            <span class='kw'>if</span> <span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:code</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_status'>status</span> <span class='op'>||=</span> <span class='lparen'>(</span><span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_status'>status</span> <span class='kw'>if</span> <span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:response</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_wrap'>wrap</span><span class='lparen'>(</span><span class='id identifier rubyid_item'>item</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_wrap'>wrap</span><span class='lparen'>(</span><span class='id identifier rubyid_item'>item</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='const'><span class='object_link'><a href="UploadWorkflow/Errors/ErrorEntry.html" title="UploadWorkflow::Errors::ErrorEntry (class)">ErrorEntry</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_v'>v</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_status'>status</span> <span class='op'>||=</span> <span class='symbol'>:bad_request</span>

  <span class='id identifier rubyid_opt'>opt</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='label'>meth:</span> <span class='id identifier rubyid_meth'>meth</span><span class='comma'>,</span> <span class='label'>status:</span> <span class='id identifier rubyid_status'>status</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_xhr'>xhr</span> <span class='op'>=</span> <span class='id identifier rubyid_request_xhr?'>request_xhr?</span> <span class='kw'>if</span> <span class='id identifier rubyid_xhr'>xhr</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_xhr'>xhr</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_redirect'>redirect</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_message'>message</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
      <span class='id identifier rubyid_head'>head</span> <span class='id identifier rubyid_status'>status</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>X-Flash-Message</span><span class='label_end'>&#39;:</span> <span class='id identifier rubyid_flash_xhr'>flash_xhr</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_message'>message</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opt'>opt</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_head'>head</span> <span class='id identifier rubyid_status'>status</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='kw'>if</span> <span class='qsymbols_beg'>%i[</span><span class='tstring_content'>ok</span><span class='words_sep'> </span><span class='tstring_content'>found</span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_status'>status</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='lparen'>(</span><span class='int'>200</span><span class='op'>..</span><span class='int'>399</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_status'>status</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_flash_success'>flash_success</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_message'>message</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opt'>opt</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_flash_failure'>flash_failure</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_message'>message</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opt'>opt</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='kw'>case</span> <span class='id identifier rubyid_redirect'>redirect</span>
      <span class='kw'>when</span> <span class='kw'>false</span>  <span class='kw'>then</span> <span class='comment'># no redirect
</span>      <span class='kw'>when</span> <span class='const'>String</span> <span class='kw'>then</span> <span class='id identifier rubyid_redirect_to'>redirect_to</span><span class='lparen'>(</span><span class='id identifier rubyid_redirect'>redirect</span><span class='rparen'>)</span>
      <span class='kw'>else</span>             <span class='id identifier rubyid_redirect_back'>redirect_back</span><span class='lparen'>(</span><span class='label'>fallback_location:</span> <span class='id identifier rubyid_upload_index_path'>upload_index_path</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="proxy_get_record-instance_method">
  
    #<strong>proxy_get_record</strong>(sid, host)  &#x21d2; <tt><span class='object_link'><a href="Upload.html" title="Upload (class)">Upload</a></span></tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get item data from the production service.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>sid</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Submission ID of the item.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>host</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Base URL of production service.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Upload.html" title="Upload (class)">Upload</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Object created from received data.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Bad data and/or no object created.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


342
343
344
345
346
347</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/concerns/upload_concern.rb', line 342</span>

<span class='kw'>def</span> <span class='id identifier rubyid_proxy_get_record'>proxy_get_record</span><span class='lparen'>(</span><span class='id identifier rubyid_sid'>sid</span><span class='comma'>,</span> <span class='id identifier rubyid_host'>host</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_sid'>sid</span> <span class='op'>&amp;&amp;</span> <span class='const'>Faraday</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_host'>host</span><span class='embexpr_end'>}</span><span class='tstring_content'>/upload/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_sid'>sid</span><span class='embexpr_end'>}</span><span class='tstring_content'>.json</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_body'>body</span><span class='period'>.</span><span class='id identifier rubyid_presence'>presence</span>
  <span class='id identifier rubyid_data'>data</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_json_parse'>json_parse</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_data'>data</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:entry</span><span class='rbracket'>]</span>
  <span class='const'><span class='object_link'><a href="Upload.html" title="Upload (class)">Upload</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Upload.html#initialize-instance_method" title="Upload#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_identifiers-instance_method">
  
    #<strong>set_identifiers</strong>(p = nil)  &#x21d2; <tt>String</tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Extract the best-match URL parameter which represents an item identifier.</p>

<p>The @identifier member variable contains the original item specification, if one was provided, and not the array of IDs represented by it.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>p</span>
      
      
        <span class='type'>(<tt>ActionController::Parameters</tt>, <tt>Hash</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Def: `#url_parameters`</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Value of @identifier.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>No param from #IDENTIFIER_PARAMS found.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


211
212
213
214
215
216</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/concerns/upload_concern.rb', line 211</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_identifiers'>set_identifiers</span><span class='lparen'>(</span><span class='id identifier rubyid_p'>p</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_prm'>prm</span> <span class='op'>=</span> <span class='id identifier rubyid_url_parameters'>url_parameters</span><span class='lparen'>(</span><span class='id identifier rubyid_p'>p</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_sel'>sel</span><span class='comma'>,</span> <span class='id identifier rubyid_sid'>sid</span> <span class='op'>=</span> <span class='id identifier rubyid_prm'>prm</span><span class='period'>.</span><span class='id identifier rubyid_values_at'>values_at</span><span class='lparen'>(</span><span class='op'>*</span><span class='const'><span class='object_link'><a href="#IDENTIFIER_PARAMS-constant" title="UploadConcern::IDENTIFIER_PARAMS (constant)">IDENTIFIER_PARAMS</a></span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:presence</span><span class='rparen'>)</span>
  <span class='ivar'>@db_id</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_sel'>sel</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='kw'>if</span> <span class='id identifier rubyid_digits_only?'>digits_only?</span><span class='lparen'>(</span><span class='id identifier rubyid_sel'>sel</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='kw'>if</span> <span class='id identifier rubyid_digits_only?'>digits_only?</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='ivar'>@identifier</span> <span class='op'>=</span> <span class='id identifier rubyid_sel'>sel</span> <span class='op'>||</span> <span class='id identifier rubyid_sid'>sid</span> <span class='op'>||</span> <span class='id identifier rubyid_id'>id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="upload_bulk_post_parameters-instance_method">
  
    #<strong>upload_bulk_post_parameters</strong>(p = nil, req = nil)  &#x21d2; <tt>Array&lt;Hash&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Extract POST parameters and data for bulk operations.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>p</span>
      
      
        <span class='type'>(<tt>ActionController::Parameters</tt>, <tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Default: `#url_parameters`.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>req</span>
      
      
        <span class='type'>(<tt>ActionDispatch::Request</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Default: `#request`.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;Hash&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


123
124
125
126
127
128</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/concerns/upload_concern.rb', line 123</span>

<span class='kw'>def</span> <span class='id identifier rubyid_upload_bulk_post_parameters'>upload_bulk_post_parameters</span><span class='lparen'>(</span><span class='id identifier rubyid_p'>p</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_req'>req</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_prm'>prm</span> <span class='op'>=</span> <span class='id identifier rubyid_p'>p</span> <span class='op'>?</span> <span class='id identifier rubyid_get_upload_params'>get_upload_params</span><span class='lparen'>(</span><span class='id identifier rubyid_p'>p</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='id identifier rubyid_upload_params'>upload_params</span>
  <span class='id identifier rubyid_src'>src</span> <span class='op'>=</span> <span class='id identifier rubyid_prm'>prm</span><span class='lbracket'>[</span><span class='symbol'>:src</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_prm'>prm</span><span class='lbracket'>[</span><span class='symbol'>:source</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_opt'>opt</span> <span class='op'>=</span> <span class='id identifier rubyid_src'>src</span> <span class='op'>?</span> <span class='lbrace'>{</span> <span class='label'>src:</span> <span class='id identifier rubyid_src'>src</span> <span class='rbrace'>}</span> <span class='op'>:</span> <span class='lbrace'>{</span> <span class='label'>data:</span> <span class='lparen'>(</span><span class='id identifier rubyid_req'>req</span> <span class='op'>||</span> <span class='id identifier rubyid_request'>request</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_wrap'>wrap</span><span class='lparen'>(</span><span class='id identifier rubyid_fetch_data'>fetch_data</span><span class='lparen'>(</span><span class='op'>**</span><span class='id identifier rubyid_opt'>opt</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:symbolize_keys</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="upload_params-instance_method">
  
    #<strong>upload_params</strong>  &#x21d2; <tt>Hash{Symbol=&gt;*}</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>URL parameters relevant to the current operation.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash{Symbol=&gt;*}</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


74
75
76</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/concerns/upload_concern.rb', line 74</span>

<span class='kw'>def</span> <span class='id identifier rubyid_upload_params'>upload_params</span>
  <span class='ivar'>@upload_params</span> <span class='op'>||=</span> <span class='id identifier rubyid_get_upload_params'>get_upload_params</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="upload_post_parameters-instance_method">
  
    #<strong>upload_post_parameters</strong>(p = nil)  &#x21d2; <tt>Hash{Symbol=&gt;*}</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Extract POST parameters that are usable for creating/updating an Upload instance.</p>

<h2 id="label-Implementation+Notes">Implementation Notes</h2>

<p>The value `<a href=":upload">params</a>[:emma_data]` is ignored because it reports the original metadata values that were supplied to the edit form.  The value `<a href=":upload">params</a>[:file]` is ignored if it is blank or is the JSON representation of an empty object (“{}”) – this indicates an editing submission where metadata is being changed but the uploaded file is not being replaced.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>p</span>
      
      
        <span class='type'>(<tt>ActionController::Parameters</tt>, <tt>Hash</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Def: `#url_parameters`</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash{Symbol=&gt;*}</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


106
107
108
109
110
111
112
113
114</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/concerns/upload_concern.rb', line 106</span>

<span class='kw'>def</span> <span class='id identifier rubyid_upload_post_parameters'>upload_post_parameters</span><span class='lparen'>(</span><span class='id identifier rubyid_p'>p</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_prm'>prm</span>  <span class='op'>=</span> <span class='id identifier rubyid_p'>p</span> <span class='op'>?</span> <span class='id identifier rubyid_get_upload_params'>get_upload_params</span><span class='lparen'>(</span><span class='id identifier rubyid_p'>p</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='id identifier rubyid_upload_params'>upload_params</span>
  <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_safe_json_parse'>safe_json_parse</span><span class='lparen'>(</span><span class='id identifier rubyid_prm'>prm</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:upload</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='label'>default:</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_file'>file</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:file</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_prm'>prm</span><span class='lbracket'>[</span><span class='symbol'>:file_data</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_file'>file</span> <span class='kw'>unless</span> <span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span> <span class='op'>||</span> <span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>{}</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_prm'>prm</span><span class='lbracket'>[</span><span class='symbol'>:base_url</span><span class='rbracket'>]</span>  <span class='op'>=</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_base_url'>base_url</span>
  <span class='id identifier rubyid_prm'>prm</span><span class='lbracket'>[</span><span class='symbol'>:revert</span><span class='rbracket'>]</span>  <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_safe_json_parse'>safe_json_parse</span><span class='lparen'>(</span><span class='id identifier rubyid_prm'>prm</span><span class='lbracket'>[</span><span class='symbol'>:revert</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='ivar'>@upload_params</span>  <span class='op'>=</span> <span class='id identifier rubyid_reject_blanks'>reject_blanks</span><span class='lparen'>(</span><span class='id identifier rubyid_prm'>prm</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="wf_bulk-instance_method">
  
    #<strong>wf_bulk</strong>(rec: nil, data: nil, **opt)  &#x21d2; <tt>Array&lt;<span class='object_link'><a href="Upload.html" title="Upload (class)">Upload</a></span>,String&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Gather information to create a bulk upload workflow instance.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>rec</span>
      
      
        <span class='type'>(<tt>Array</tt>, <tt>:unset</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>data</span>
      
      
        <span class='type'>(<tt>Array</tt>, <tt>:unset</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>opt</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>To workflow initializer except:</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    
    
    <p class="tag_title">Options Hash (<tt>**opt</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:from</span>
          <span class="type">(<tt>Symbol</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Default: `#calling_method`.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:event</span>
          <span class="type">(<tt>Symbol</tt>)</span>
          <span class="default">
            
          </span>
          
        </li>
      
    </ul>
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="Upload.html" title="Upload (class)">Upload</a></span>,String&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>@see UploadWorkflow::Bulk#results</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>UploadWorkflow::Bulk#generate</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/concerns/upload_concern.rb', line 420</span>

<span class='kw'>def</span> <span class='id identifier rubyid_wf_bulk'>wf_bulk</span><span class='lparen'>(</span><span class='label'>rec:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>data:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opt'>opt</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_from'>from</span>  <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_opt'>opt</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:from</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='id identifier rubyid_calling_method'>calling_method</span><span class='rparen'>)</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
  <span class='id identifier rubyid_event'>event</span> <span class='op'>=</span> <span class='id identifier rubyid_opt'>opt</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:event</span><span class='rparen'>)</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='op'>&amp;.</span><span class='id identifier rubyid_delete_suffix'>delete_suffix</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>!</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid___method__'>__method__</span><span class='embexpr_end'>}</span><span class='tstring_content'>: missing :from</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_from'>from</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_from'>from</span><span class='embexpr_end'>}</span><span class='tstring_content'>: missing :event</span><span class='tstring_end'>&quot;</span></span>      <span class='kw'>unless</span> <span class='id identifier rubyid_event'>event</span>
  <span class='id identifier rubyid_rec'>rec</span>   <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_rec'>rec</span> <span class='op'>==</span> <span class='symbol'>:unset</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='op'>:</span> <span class='lparen'>(</span><span class='id identifier rubyid_rec'>rec</span> <span class='op'>||</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='comment'># TODO: transaction record?
</span>  <span class='id identifier rubyid_data'>data</span>  <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_data'>data</span> <span class='op'>==</span> <span class='symbol'>:unset</span>
  <span class='kw'>unless</span> <span class='id identifier rubyid_data'>data</span>
    <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_upload_bulk_post_parameters'>upload_bulk_post_parameters</span> <span class='kw'>or</span> <span class='id identifier rubyid_failure'>failure</span><span class='lparen'>(</span><span class='id identifier rubyid_from'>from</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_data'>data</span> <span class='op'>&lt;&lt;</span> <span class='lbrace'>{</span> <span class='label'>base_url:</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_base_url'>base_url</span> <span class='rbrace'>}</span>
    <span class='id identifier rubyid_opt'>opt</span><span class='lbracket'>[</span><span class='symbol'>:control</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:src</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:source</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_opt'>opt</span><span class='lbracket'>[</span><span class='symbol'>:variant</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='id identifier rubyid_event'>event</span> <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="UploadWorkflow.html" title="UploadWorkflow (class)">UploadWorkflow</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="UploadWorkflow/Bulk.html" title="UploadWorkflow::Bulk (class)">Bulk</a></span></span><span class='period'>.</span><span class='id identifier rubyid_variant?'>variant?</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_opt'>opt</span><span class='lbracket'>[</span><span class='symbol'>:user</span><span class='rbracket'>]</span>    <span class='op'>||=</span> <span class='ivar'>@user</span>
  <span class='id identifier rubyid_opt'>opt</span><span class='lbracket'>[</span><span class='symbol'>:params</span><span class='rbracket'>]</span>  <span class='op'>||=</span> <span class='id identifier rubyid_workflow_parameters'>workflow_parameters</span>
  <span class='id identifier rubyid_opt'>opt</span><span class='lbracket'>[</span><span class='symbol'>:no_sim</span><span class='rbracket'>]</span>    <span class='op'>=</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="UploadWorkflow.html" title="UploadWorkflow (class)">UploadWorkflow</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="UploadWorkflow/Bulk.html" title="UploadWorkflow::Bulk (class)">Bulk</a></span></span><span class='op'>::</span><span class='const'>SIMULATION</span> <span class='comment'># TODO: remove
</span>  <span class='ivar'>@workflow</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="UploadWorkflow.html" title="UploadWorkflow (class)">UploadWorkflow</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="UploadWorkflow/Bulk.html" title="UploadWorkflow::Bulk (class)">Bulk</a></span></span><span class='period'>.</span><span class='id identifier rubyid_generate'>generate</span><span class='lparen'>(</span><span class='id identifier rubyid_rec'>rec</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opt'>opt</span><span class='rparen'>)</span>
  <span class='ivar'>@workflow</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_failure'>failure</span><span class='lparen'>(</span><span class='id identifier rubyid_from'>from</span><span class='comma'>,</span> <span class='ivar'>@workflow</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='ivar'>@workflow</span><span class='period'>.</span><span class='id identifier rubyid_failures?'>failures?</span>
  <span class='comment'># noinspection RubyYardReturnMatch
</span>  <span class='ivar'>@workflow</span><span class='period'>.</span><span class='id identifier rubyid_results'>results</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="wf_check_partial_failure-instance_method">
  
    #<strong>wf_check_partial_failure</strong>(wf = @workflow)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Produce flash error messages for failures that did not abort the workflow step but did affect the outcome (e.g. for bulk uploads where some of the original files could not be acquired).</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>wf</span>
      
      
        <span class='type'>(<tt>Workflow</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>@workflow</tt>)</em>
      
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


449
450
451
452</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/concerns/upload_concern.rb', line 449</span>

<span class='kw'>def</span> <span class='id identifier rubyid_wf_check_partial_failure'>wf_check_partial_failure</span><span class='lparen'>(</span><span class='id identifier rubyid_wf'>wf</span> <span class='op'>=</span> <span class='ivar'>@workflow</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_problems'>problems</span> <span class='op'>=</span> <span class='id identifier rubyid_wf'>wf</span><span class='period'>.</span><span class='id identifier rubyid_failed'>failed</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
  <span class='id identifier rubyid_post_response'>post_response</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_problems'>problems</span><span class='comma'>,</span> <span class='label'>redirect:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='label'>xhr:</span> <span class='kw'>false</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="wf_single-instance_method">
  
    #<strong>wf_single</strong>(rec: nil, data: nil, **opt)  &#x21d2; <tt>*</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Gather information to create an upload workflow instance.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>rec</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Integer</tt>, <tt>:unset</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>data</span>
      
      
        <span class='type'>(<tt>Hash</tt>, <tt>String</tt>, <tt>:unset</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>opt</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>To workflow initializer except:</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    
    
    <p class="tag_title">Options Hash (<tt>**opt</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:from</span>
          <span class="type">(<tt>Symbol</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Default: `#calling_method`.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:event</span>
          <span class="type">(<tt>Symbol</tt>)</span>
          <span class="default">
            
          </span>
          
        </li>
      
    </ul>
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>*</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>@see UploadWorkflow::Single#results</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="UploadWorkflow/Single.html#generate-class_method" title="UploadWorkflow::Single.generate (method)">UploadWorkflow::Single.generate</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/concerns/upload_concern.rb', line 368</span>

<span class='kw'>def</span> <span class='id identifier rubyid_wf_single'>wf_single</span><span class='lparen'>(</span><span class='label'>rec:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>data:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opt'>opt</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_from'>from</span>  <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_opt'>opt</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:from</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='id identifier rubyid_calling_method'>calling_method</span><span class='rparen'>)</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
  <span class='id identifier rubyid_event'>event</span> <span class='op'>=</span> <span class='id identifier rubyid_opt'>opt</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:event</span><span class='rparen'>)</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='op'>&amp;.</span><span class='id identifier rubyid_delete_suffix'>delete_suffix</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>!</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid___method__'>__method__</span><span class='embexpr_end'>}</span><span class='tstring_content'>: missing :from</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_from'>from</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_from'>from</span><span class='embexpr_end'>}</span><span class='tstring_content'>: missing :event</span><span class='tstring_end'>&quot;</span></span>      <span class='kw'>unless</span> <span class='id identifier rubyid_event'>event</span>
  <span class='id identifier rubyid_rec'>rec</span>  <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_rec'>rec</span>  <span class='op'>||</span> <span class='ivar'>@db_id</span> <span class='op'>||</span> <span class='ivar'>@identifier</span> <span class='kw'>unless</span> <span class='id identifier rubyid_rec'>rec</span>  <span class='op'>==</span> <span class='symbol'>:unset</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span> <span class='op'>||</span> <span class='id identifier rubyid_workflow_parameters'>workflow_parameters</span> <span class='kw'>unless</span> <span class='id identifier rubyid_data'>data</span> <span class='op'>==</span> <span class='symbol'>:unset</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_opt'>opt</span><span class='lbracket'>[</span><span class='symbol'>:variant</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='id identifier rubyid_event'>event</span> <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="UploadWorkflow.html" title="UploadWorkflow (class)">UploadWorkflow</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="UploadWorkflow/Single.html" title="UploadWorkflow::Single (class)">Single</a></span></span><span class='period'>.</span><span class='id identifier rubyid_variant?'>variant?</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_opt'>opt</span><span class='lbracket'>[</span><span class='symbol'>:user</span><span class='rbracket'>]</span>    <span class='op'>||=</span> <span class='ivar'>@user</span>
  <span class='id identifier rubyid_opt'>opt</span><span class='lbracket'>[</span><span class='symbol'>:params</span><span class='rbracket'>]</span>  <span class='op'>||=</span> <span class='id identifier rubyid_workflow_parameters'>workflow_parameters</span>
  <span class='id identifier rubyid_opt'>opt</span><span class='lbracket'>[</span><span class='symbol'>:no_sim</span><span class='rbracket'>]</span>    <span class='op'>=</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="UploadWorkflow.html" title="UploadWorkflow (class)">UploadWorkflow</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="UploadWorkflow/Single.html" title="UploadWorkflow::Single (class)">Single</a></span></span><span class='op'>::</span><span class='const'>SIMULATION</span> <span class='comment'># TODO: remove
</span>  <span class='ivar'>@workflow</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="UploadWorkflow.html" title="UploadWorkflow (class)">UploadWorkflow</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="UploadWorkflow/Single.html" title="UploadWorkflow::Single (class)">Single</a></span></span><span class='period'>.</span><span class='id identifier rubyid_generate'><span class='object_link'><a href="UploadWorkflow/Single.html#generate-class_method" title="UploadWorkflow::Single.generate (method)">generate</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_rec'>rec</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opt'>opt</span><span class='rparen'>)</span>
  <span class='ivar'>@workflow</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_failure'>failure</span><span class='lparen'>(</span><span class='id identifier rubyid_from'>from</span><span class='comma'>,</span> <span class='ivar'>@workflow</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='ivar'>@workflow</span><span class='period'>.</span><span class='id identifier rubyid_failures?'>failures?</span>
  <span class='ivar'>@workflow</span><span class='period'>.</span><span class='id identifier rubyid_results'>results</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="wf_single_check-instance_method">
  
    #<strong>wf_single_check</strong>(rec: nil, **opt)  &#x21d2; <tt>Array&lt;String&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Determine whether the workflow state of the indicated item can be advanced.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>rec</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Integer</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>opt</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;String&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>@see UploadWorkflow::Single#wf_check_status</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="UploadWorkflow/Single.html#check_status-class_method" title="UploadWorkflow::Single.check_status (method)">UploadWorkflow::Single.check_status</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


394
395
396
397
398
399
400
401
402
403
404
405</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/concerns/upload_concern.rb', line 394</span>

<span class='kw'>def</span> <span class='id identifier rubyid_wf_single_check'>wf_single_check</span><span class='lparen'>(</span><span class='label'>rec:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opt'>opt</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_from'>from</span>           <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_opt'>opt</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:from</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='id identifier rubyid_calling_method'>calling_method</span><span class='rparen'>)</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
  <span class='id identifier rubyid_rec'>rec</span>          <span class='op'>||=</span> <span class='ivar'>@db_id</span> <span class='op'>||</span> <span class='ivar'>@identifier</span>
  <span class='id identifier rubyid_opt'>opt</span><span class='lbracket'>[</span><span class='symbol'>:user</span><span class='rbracket'>]</span>   <span class='op'>||=</span> <span class='ivar'>@user</span>
  <span class='id identifier rubyid_opt'>opt</span><span class='lbracket'>[</span><span class='symbol'>:params</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='id identifier rubyid_workflow_parameters'>workflow_parameters</span>
  <span class='id identifier rubyid_opt'>opt</span><span class='lbracket'>[</span><span class='symbol'>:no_sim</span><span class='rbracket'>]</span>   <span class='op'>=</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="UploadWorkflow.html" title="UploadWorkflow (class)">UploadWorkflow</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="UploadWorkflow/Single.html" title="UploadWorkflow::Single (class)">Single</a></span></span><span class='op'>::</span><span class='const'>SIMULATION</span> <span class='comment'># TODO: remove
</span>  <span class='id identifier rubyid_opt'>opt</span><span class='lbracket'>[</span><span class='symbol'>:html</span><span class='rbracket'>]</span>     <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:format</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span> <span class='op'>||</span> <span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:format</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>html</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='comment'># noinspection RubyYardParamTypeMatch
</span>  <span class='ivar'>@workflow</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="UploadWorkflow.html" title="UploadWorkflow (class)">UploadWorkflow</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="UploadWorkflow/Single.html" title="UploadWorkflow::Single (class)">Single</a></span></span><span class='period'>.</span><span class='id identifier rubyid_check_status'><span class='object_link'><a href="UploadWorkflow/Single.html#check_status-class_method" title="UploadWorkflow::Single.check_status (method)">check_status</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_rec'>rec</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opt'>opt</span><span class='rparen'>)</span>
  <span class='comment'># noinspection RubyYardReturnMatch
</span>  <span class='ivar'>@workflow</span><span class='period'>.</span><span class='id identifier rubyid_results'>results</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="workflow_parameters-instance_method">
  
    #<strong>workflow_parameters</strong>  &#x21d2; <tt>Hash</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>workflow_parameters</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


134
135
136
137
138
139</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/concerns/upload_concern.rb', line 134</span>

<span class='kw'>def</span> <span class='id identifier rubyid_workflow_parameters'>workflow_parameters</span>
  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='label'>id:</span> <span class='ivar'>@db_id</span><span class='comma'>,</span> <span class='label'>user_id:</span> <span class='ivar'>@user</span><span class='op'>&amp;.</span><span class='id identifier rubyid_id'>id</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_compact!'>compact!</span>
  <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_merge!'>merge!</span><span class='lparen'>(</span><span class='id identifier rubyid_upload_post_parameters'>upload_post_parameters</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_except!'>except!</span><span class='lparen'>(</span><span class='symbol'>:selected</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Mon Jan 25 14:09:12 2021 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.26 (ruby-2.7.2).
</div>

    </div>
  </body>
</html>