<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: UploadWorkflow::External
  
    &mdash; Documentation by YARD 0.9.26
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "UploadWorkflow::External";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (E)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../UploadWorkflow.html" title="UploadWorkflow (class)">UploadWorkflow</a></span></span>
     &raquo; 
    <span class="title">External</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Module: UploadWorkflow::External
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  <dl>
      <dt>Includes:</dt>
      <dd><span class='object_link'><a href="Events.html" title="UploadWorkflow::Events (module)">Events</a></span>, <span class='object_link'><a href="Properties.html" title="UploadWorkflow::Properties (module)">Properties</a></span></dd>
  </dl>
  
  

  
  <dl>
    <dt>Included in:</dt>
    <dd><span class='object_link'><a href="Bulk/External.html" title="UploadWorkflow::Bulk::External (module)">Bulk::External</a></span>, <span class='object_link'><a href="Data.html" title="UploadWorkflow::Data (module)">Data</a></span>, <span class='object_link'><a href="Single/External.html" title="UploadWorkflow::Single::External (module)">Single::External</a></span></dd>
  </dl>
  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>app/models/upload_workflow.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Fundamental upload mechanisms for managing submissions which entail:</p>
<ul><li>
<p>File storage/retrieval/removal</p>
</li><li>
<p>Database create/update/delete</p>
</li><li>
<p>Federated Index create/update/delete</p>
</li><li>
<p>Member repository submission queue (AWS S3) create/update/delete</p>
</li></ul>


  </div>
</div>
<div class="tags">
  

</div>
  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="DISABLE_UPLOAD_INDEX_UPDATE-constant" class="">DISABLE_UPLOAD_INDEX_UPDATE =
          <div class="docstring">
  <div class="discussion">
    
<p>As a convenience for testing, sending to the Federated Search Ingest API can be short-circuited here.  The value should be <strong>false</strong> normally.</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='id identifier rubyid_true?'>true?</span><span class='lparen'>(</span><span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DISABLE_UPLOAD_INDEX_UPDATE</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span></pre></dd>
      
        <dt id="REPO_FAILURE-constant" class="">REPO_FAILURE =
          <div class="docstring">
  <div class="discussion">
    
<p>Failure messages for member repository requests. # TODO: I18n</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='lbrace'>{</span>
  <span class='label'>no_repo:</span>    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>No repository given</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
  <span class='label'>no_items:</span>   <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>No items given</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
  <span class='label'>no_create:</span>  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Repository submissions are disabled</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
  <span class='label'>no_edit:</span>    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Repository modification requests are disabled</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
  <span class='label'>no_remove:</span>  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Repository removal requests are disabled</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
<span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_deep_freeze'>deep_freeze</span></pre></dd>
      
    </dl>
  



  
  
  <h3 class="inherited">Constants included
     from <span class='object_link'><a href="Properties.html" title="UploadWorkflow::Properties (module)">Properties</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Properties.html#BATCH_SIZE-constant" title="UploadWorkflow::Properties::BATCH_SIZE (constant)">Properties::BATCH_SIZE</a></span>, <span class='object_link'><a href="Properties.html#BATCH_SIZE_DEFAULT-constant" title="UploadWorkflow::Properties::BATCH_SIZE_DEFAULT (constant)">Properties::BATCH_SIZE_DEFAULT</a></span>, <span class='object_link'><a href="Properties.html#DEV_TITLE_PREFIX-constant" title="UploadWorkflow::Properties::DEV_TITLE_PREFIX (constant)">Properties::DEV_TITLE_PREFIX</a></span>, <span class='object_link'><a href="Properties.html#EMERGENCY_DELETE_DEFAULT-constant" title="UploadWorkflow::Properties::EMERGENCY_DELETE_DEFAULT (constant)">Properties::EMERGENCY_DELETE_DEFAULT</a></span>, <span class='object_link'><a href="Properties.html#FORCE_DELETE_DEFAULT-constant" title="UploadWorkflow::Properties::FORCE_DELETE_DEFAULT (constant)">Properties::FORCE_DELETE_DEFAULT</a></span>, <span class='object_link'><a href="Properties.html#INGEST_MAX_SIZE-constant" title="UploadWorkflow::Properties::INGEST_MAX_SIZE (constant)">Properties::INGEST_MAX_SIZE</a></span>, <span class='object_link'><a href="Properties.html#MAX_BATCH_SIZE-constant" title="UploadWorkflow::Properties::MAX_BATCH_SIZE (constant)">Properties::MAX_BATCH_SIZE</a></span>, <span class='object_link'><a href="Properties.html#REPO_CREATE_DEFAULT-constant" title="UploadWorkflow::Properties::REPO_CREATE_DEFAULT (constant)">Properties::REPO_CREATE_DEFAULT</a></span>, <span class='object_link'><a href="Properties.html#REPO_EDIT_DEFAULT-constant" title="UploadWorkflow::Properties::REPO_EDIT_DEFAULT (constant)">Properties::REPO_EDIT_DEFAULT</a></span>, <span class='object_link'><a href="Properties.html#REPO_REMOVE_DEFAULT-constant" title="UploadWorkflow::Properties::REPO_REMOVE_DEFAULT (constant)">Properties::REPO_REMOVE_DEFAULT</a></span>, <span class='object_link'><a href="Properties.html#THROTTLE_PAUSE-constant" title="UploadWorkflow::Properties::THROTTLE_PAUSE (constant)">Properties::THROTTLE_PAUSE</a></span>, <span class='object_link'><a href="Properties.html#TITLE_PREFIX-constant" title="UploadWorkflow::Properties::TITLE_PREFIX (constant)">Properties::TITLE_PREFIX</a></span>, <span class='object_link'><a href="Properties.html#TRUNCATE_DELETE_DEFAULT-constant" title="UploadWorkflow::Properties::TRUNCATE_DELETE_DEFAULT (constant)">Properties::TRUNCATE_DELETE_DEFAULT</a></span>, <span class='object_link'><a href="Properties.html#WF_URL_PARAMETER-constant" title="UploadWorkflow::Properties::WF_URL_PARAMETER (constant)">Properties::WF_URL_PARAMETER</a></span></p>

  
  
  <h3 class="inherited">Constants included
     from <span class='object_link'><a href="Errors.html" title="UploadWorkflow::Errors (module)">Errors</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Errors.html#DEFAULT_ERROR_MESSAGE-constant" title="UploadWorkflow::Errors::DEFAULT_ERROR_MESSAGE (constant)">UploadWorkflow::Errors::DEFAULT_ERROR_MESSAGE</a></span>, <span class='object_link'><a href="Errors.html#INTERNAL_EXCEPTION-constant" title="UploadWorkflow::Errors::INTERNAL_EXCEPTION (constant)">UploadWorkflow::Errors::INTERNAL_EXCEPTION</a></span>, <span class='object_link'><a href="Errors.html#UPLOAD_ERROR-constant" title="UploadWorkflow::Errors::UPLOAD_ERROR (constant)">UploadWorkflow::Errors::UPLOAD_ERROR</a></span></p>

  
  
  <h3 class="inherited">Constants included
     from <span class='object_link'><a href="Errors/RenderMethods.html" title="UploadWorkflow::Errors::RenderMethods (module)">UploadWorkflow::Errors::RenderMethods</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Errors/RenderMethods.html#DEFAULT_LABEL-constant" title="UploadWorkflow::Errors::RenderMethods::DEFAULT_LABEL (constant)">UploadWorkflow::Errors::RenderMethods::DEFAULT_LABEL</a></span></p>

  
  
  <h3 class="inherited">Constants included
     from <span class='object_link'><a href="../Emma/Debug/FormatMethods.html" title="Emma::Debug::FormatMethods (module)">Emma::Debug::FormatMethods</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Emma/Debug/FormatMethods.html#DEBUG_INSPECT_COMMON-constant" title="Emma::Debug::FormatMethods::DEBUG_INSPECT_COMMON (constant)">Emma::Debug::FormatMethods::DEBUG_INSPECT_COMMON</a></span>, <span class='object_link'><a href="../Emma/Debug/FormatMethods.html#DEBUG_INSPECT_MAX-constant" title="Emma::Debug::FormatMethods::DEBUG_INSPECT_MAX (constant)">Emma::Debug::FormatMethods::DEBUG_INSPECT_MAX</a></span>, <span class='object_link'><a href="../Emma/Debug/FormatMethods.html#DEBUG_INSPECT_OMISSION-constant" title="Emma::Debug::FormatMethods::DEBUG_INSPECT_OMISSION (constant)">Emma::Debug::FormatMethods::DEBUG_INSPECT_OMISSION</a></span>, <span class='object_link'><a href="../Emma/Debug/FormatMethods.html#DEBUG_SEPARATOR-constant" title="Emma::Debug::FormatMethods::DEBUG_SEPARATOR (constant)">Emma::Debug::FormatMethods::DEBUG_SEPARATOR</a></span></p>

  
  
  <h3 class="inherited">Constants included
     from <span class='object_link'><a href="../Emma/Common.html" title="Emma::Common (module)">Emma::Common</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Emma/Common.html#ASCII-constant" title="Emma::Common::ASCII (constant)">Emma::Common::ASCII</a></span>, <span class='object_link'><a href="../Emma/Common.html#BOOLEAN_VALUES-constant" title="Emma::Common::BOOLEAN_VALUES (constant)">Emma::Common::BOOLEAN_VALUES</a></span>, <span class='object_link'><a href="../Emma/Common.html#HTML_ID_IGNORED-constant" title="Emma::Common::HTML_ID_IGNORED (constant)">Emma::Common::HTML_ID_IGNORED</a></span>, <span class='object_link'><a href="../Emma/Common.html#HTML_ID_WORD_BREAK-constant" title="Emma::Common::HTML_ID_WORD_BREAK (constant)">Emma::Common::HTML_ID_WORD_BREAK</a></span>, <span class='object_link'><a href="../Emma/Common.html#HTML_QUOTES-constant" title="Emma::Common::HTML_QUOTES (constant)">Emma::Common::HTML_QUOTES</a></span>, <span class='object_link'><a href="../Emma/Common.html#INFLECT_PLURAL-constant" title="Emma::Common::INFLECT_PLURAL (constant)">Emma::Common::INFLECT_PLURAL</a></span>, <span class='object_link'><a href="../Emma/Common.html#INFLECT_SINGULAR-constant" title="Emma::Common::INFLECT_SINGULAR (constant)">Emma::Common::INFLECT_SINGULAR</a></span>, <span class='object_link'><a href="../Emma/Common.html#LIST_SEPARATOR-constant" title="Emma::Common::LIST_SEPARATOR (constant)">Emma::Common::LIST_SEPARATOR</a></span>, <span class='object_link'><a href="../Emma/Common.html#PAIR_SEPARATOR-constant" title="Emma::Common::PAIR_SEPARATOR (constant)">Emma::Common::PAIR_SEPARATOR</a></span>, <span class='object_link'><a href="../Emma/Common.html#QUOTE_MARKS-constant" title="Emma::Common::QUOTE_MARKS (constant)">Emma::Common::QUOTE_MARKS</a></span></p>





  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#add_to_index-instance_method" title="#add_to_index (instance method)">#<strong>add_to_index</strong>(*items, atomic: true)  &#x21d2; (Array,Array,Array) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Add the indicated items from the EMMA Unified Index.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#aws_api-instance_method" title="#aws_api (instance method)">#<strong>aws_api</strong>  &#x21d2; AwsS3Service </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Current AWS API service instance.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#batch_repository_remove-instance_method" title="#batch_repository_remove (instance method)">#<strong>batch_repository_remove</strong>(items, **opt)  &#x21d2; (Array,Array) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>batch_repository_remove.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#batch_repository_request-instance_method" title="#batch_repository_request (instance method)">#<strong>batch_repository_request</strong>(items, empty_key: false)  &#x21d2; Hash{String=&gt;Array} </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>batch_repository_request.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#db_delete-instance_method" title="#db_delete (instance method)">#<strong>db_delete</strong>(data)  &#x21d2; *<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Remove a single existing Upload record from the database.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#db_insert-instance_method" title="#db_insert (instance method)">#<strong>db_insert</strong>(data)  &#x21d2; Upload<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Add a single Upload record to the database.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#db_update-instance_method" title="#db_update (instance method)">#<strong>db_update</strong>(record, data = nil)  &#x21d2; Upload<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Modify a single existing Upload database record.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#emma_item%3F-instance_method" title="#emma_item? (instance method)">#<strong>emma_item?</strong>(item)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Indicate whether the item represents an EMMA repository entry (as opposed to a member repository entry).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#find_records-instance_method" title="#find_records (instance method)">#<strong>find_records</strong>(*items, **opt)  &#x21d2; Array&lt;Upload&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Find all of the specified Upload records.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_record-instance_method" title="#get_record (instance method)">#<strong>get_record</strong>(id, no_raise: false, meth: nil)  &#x21d2; Upload<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Return with the specified record or <strong>nil</strong> if one could not be found.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#identifier-instance_method" title="#identifier (instance method)">#<strong>identifier</strong>(item)  &#x21d2; String<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The database ID for the item, or, failing that, the submission ID.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#identifiers-instance_method" title="#identifiers (instance method)">#<strong>identifiers</strong>(item)  &#x21d2; Array&lt;String&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Return an array of the characteristic identifiers for the item.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#ingest_api-instance_method" title="#ingest_api (instance method)">#<strong>ingest_api</strong>  &#x21d2; IngestService </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Current Ingest API service instance.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#new_record-instance_method" title="#new_record (instance method)">#<strong>new_record</strong>(data = nil)  &#x21d2; Upload </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Create a new free-standing (un-persisted) Upload instance.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#remove_from_index-instance_method" title="#remove_from_index (instance method)">#<strong>remove_from_index</strong>(*items, atomic: true)  &#x21d2; (Array,Array) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Remove the indicated items from the EMMA Unified Index.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#repository_create-instance_method" title="#repository_create (instance method)">#<strong>repository_create</strong>(repo, *data, **opt)  &#x21d2; (Array,Array) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Submit a new item to member repository.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#repository_edit-instance_method" title="#repository_edit (instance method)">#<strong>repository_edit</strong>(repo, *data, **opt)  &#x21d2; (Array,Array) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>TODO: request update of an existing member repository entry.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#repository_remove-instance_method" title="#repository_remove (instance method)">#<strong>repository_remove</strong>(repo, *data, **opt)  &#x21d2; (Array,Array) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>TODO: request removal of an existing member repository entry.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#skip_index_ingest-instance_method" title="#skip_index_ingest (instance method)">#<strong>skip_index_ingest</strong>(method, *items)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_in_index-instance_method" title="#update_in_index (instance method)">#<strong>update_in_index</strong>(*items, atomic: true)  &#x21d2; (Array,Array,Array) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Add/modify the indicated items from the EMMA Unified Index.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#upload_create-instance_method" title="#upload_create (instance method)">#<strong>upload_create</strong>(index: nil, atomic: true, **data)  &#x21d2; (Upload,Array&gt;, (nil,Array) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Add a new submission to the database, upload its file to storage, and add a new index entry for it (if explicitly requested).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#upload_edit-instance_method" title="#upload_edit (instance method)">#<strong>upload_edit</strong>(index: nil, atomic: true, **data)  &#x21d2; (Upload,Array&gt;, (nil,Array) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Update an existing database record and update its associated index entry (if explicitly requested).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#upload_remove-instance_method" title="#upload_remove (instance method)">#<strong>upload_remove</strong>(*items, index: nil, atomic: true, force: nil, **opt)  &#x21d2; (Array,Array) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Remove Upload records from the database and from the index.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Properties.html" title="UploadWorkflow::Properties (module)">Properties</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Properties.html#batch_size-instance_method" title="UploadWorkflow::Properties#batch_size (method)">#batch_size</a></span>, <span class='object_link'><a href="Properties.html#emergency_delete-instance_method" title="UploadWorkflow::Properties#emergency_delete (method)">#emergency_delete</a></span>, <span class='object_link'><a href="Properties.html#force_delete-instance_method" title="UploadWorkflow::Properties#force_delete (method)">#force_delete</a></span>, <span class='object_link'><a href="Properties.html#repo_create-instance_method" title="UploadWorkflow::Properties#repo_create (method)">#repo_create</a></span>, <span class='object_link'><a href="Properties.html#repo_edit-instance_method" title="UploadWorkflow::Properties#repo_edit (method)">#repo_edit</a></span>, <span class='object_link'><a href="Properties.html#repo_remove-instance_method" title="UploadWorkflow::Properties#repo_remove (method)">#repo_remove</a></span>, <span class='object_link'><a href="Properties.html#title_prefix-instance_method" title="UploadWorkflow::Properties#title_prefix (method)">#title_prefix</a></span>, <span class='object_link'><a href="Properties.html#truncate_delete-instance_method" title="UploadWorkflow::Properties#truncate_delete (method)">#truncate_delete</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Errors.html" title="UploadWorkflow::Errors (module)">Errors</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Errors.html#failure-instance_method" title="UploadWorkflow::Errors#failure (method)">#failure</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Errors/RenderMethods.html" title="UploadWorkflow::Errors::RenderMethods (module)">UploadWorkflow::Errors::RenderMethods</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Errors/RenderMethods.html#make_label-instance_method" title="UploadWorkflow::Errors::RenderMethods#make_label (method)">#make_label</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../Emma/Debug.html" title="Emma::Debug (module)">Emma::Debug</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Emma/Debug.html#included-class_method" title="Emma::Debug.included (method)">included</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">Emma::Debug::OutputMethods</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Emma/Debug/OutputMethods.html#__debug_exception-instance_method" title="Emma::Debug::OutputMethods#__debug_exception (method)">#__debug_exception</a></span>, <span class='object_link'><a href="../Emma/Debug/OutputMethods.html#__debug_items-instance_method" title="Emma::Debug::OutputMethods#__debug_items (method)">#__debug_items</a></span>, <span class='object_link'><a href="../Emma/Debug/OutputMethods.html#__debug_line-instance_method" title="Emma::Debug::OutputMethods#__debug_line (method)">#__debug_line</a></span>, <span class='object_link'><a href="../Emma/Debug/OutputMethods.html#__debug_request-instance_method" title="Emma::Debug::OutputMethods#__debug_request (method)">#__debug_request</a></span>, <span class='object_link'><a href="../Emma/Debug/OutputMethods.html#__debug_route-instance_method" title="Emma::Debug::OutputMethods#__debug_route (method)">#__debug_route</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../Emma/Debug/FormatMethods.html" title="Emma::Debug::FormatMethods (module)">Emma::Debug::FormatMethods</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Emma/Debug/FormatMethods.html#__debug_env_hash-instance_method" title="Emma::Debug::FormatMethods#__debug_env_hash (method)">#__debug_env_hash</a></span>, <span class='object_link'><a href="../Emma/Debug/FormatMethods.html#__debug_header_hash-instance_method" title="Emma::Debug::FormatMethods#__debug_header_hash (method)">#__debug_header_hash</a></span>, <span class='object_link'><a href="../Emma/Debug/FormatMethods.html#__debug_inspect-instance_method" title="Emma::Debug::FormatMethods#__debug_inspect (method)">#__debug_inspect</a></span>, <span class='object_link'><a href="../Emma/Debug/FormatMethods.html#__debug_inspect_item-instance_method" title="Emma::Debug::FormatMethods#__debug_inspect_item (method)">#__debug_inspect_item</a></span>, <span class='object_link'><a href="../Emma/Debug/FormatMethods.html#__debug_inspect_items-instance_method" title="Emma::Debug::FormatMethods#__debug_inspect_items (method)">#__debug_inspect_items</a></span>, <span class='object_link'><a href="../Emma/Debug/FormatMethods.html#__debug_label-instance_method" title="Emma::Debug::FormatMethods#__debug_label (method)">#__debug_label</a></span>, <span class='object_link'><a href="../Emma/Debug/FormatMethods.html#__debug_route_label-instance_method" title="Emma::Debug::FormatMethods#__debug_route_label (method)">#__debug_route_label</a></span>, <span class='object_link'><a href="../Emma/Debug/FormatMethods.html#__debug_session_hash-instance_method" title="Emma::Debug::FormatMethods#__debug_session_hash (method)">#__debug_session_hash</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../Emma/Common.html" title="Emma::Common (module)">Emma::Common</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Emma/Common.html#array_string-instance_method" title="Emma::Common#array_string (method)">#array_string</a></span>, <span class='object_link'><a href="../Emma/Common.html#boolean%3F-instance_method" title="Emma::Common#boolean? (method)">#boolean?</a></span>, <span class='object_link'><a href="../Emma/Common.html#build_query_options-instance_method" title="Emma::Common#build_query_options (method)">#build_query_options</a></span>, <span class='object_link'><a href="../Emma/Common.html#calling_method-instance_method" title="Emma::Common#calling_method (method)">#calling_method</a></span>, <span class='object_link'><a href="../Emma/Common.html#digits_only%3F-instance_method" title="Emma::Common#digits_only? (method)">#digits_only?</a></span>, <span class='object_link'><a href="../Emma/Common.html#get_method-instance_method" title="Emma::Common#get_method (method)">#get_method</a></span>, <span class='object_link'><a href="../Emma/Common.html#get_params-instance_method" title="Emma::Common#get_params (method)">#get_params</a></span>, <span class='object_link'><a href="../Emma/Common.html#hash_string-instance_method" title="Emma::Common#hash_string (method)">#hash_string</a></span>, <span class='object_link'><a href="../Emma/Common.html#html_id-instance_method" title="Emma::Common#html_id (method)">#html_id</a></span>, <span class='object_link'><a href="../Emma/Common.html#inflection-instance_method" title="Emma::Common#inflection (method)">#inflection</a></span>, <span class='object_link'><a href="../Emma/Common.html#labelize-instance_method" title="Emma::Common#labelize (method)">#labelize</a></span>, <span class='object_link'><a href="../Emma/Common.html#make_path-instance_method" title="Emma::Common#make_path (method)">#make_path</a></span>, <span class='object_link'><a href="../Emma/Common.html#named_format_references-instance_method" title="Emma::Common#named_format_references (method)">#named_format_references</a></span>, <span class='object_link'><a href="../Emma/Common.html#non_breaking-instance_method" title="Emma::Common#non_breaking (method)">#non_breaking</a></span>, <span class='object_link'><a href="../Emma/Common.html#non_negative-instance_method" title="Emma::Common#non_negative (method)">#non_negative</a></span>, <span class='object_link'><a href="../Emma/Common.html#normalized_list-instance_method" title="Emma::Common#normalized_list (method)">#normalized_list</a></span>, <span class='object_link'><a href="../Emma/Common.html#partition_options-instance_method" title="Emma::Common#partition_options (method)">#partition_options</a></span>, <span class='object_link'><a href="../Emma/Common.html#positive-instance_method" title="Emma::Common#positive (method)">#positive</a></span>, <span class='object_link'><a href="../Emma/Common.html#quote-instance_method" title="Emma::Common#quote (method)">#quote</a></span>, <span class='object_link'><a href="../Emma/Common.html#reject_blanks-instance_method" title="Emma::Common#reject_blanks (method)">#reject_blanks</a></span>, <span class='object_link'><a href="../Emma/Common.html#sanitized_string-instance_method" title="Emma::Common#sanitized_string (method)">#sanitized_string</a></span>, <span class='object_link'><a href="../Emma/Common.html#strip_quotes-instance_method" title="Emma::Common#strip_quotes (method)">#strip_quotes</a></span>, <span class='object_link'><a href="../Emma/Common.html#url_escape-instance_method" title="Emma::Common#url_escape (method)">#url_escape</a></span>, <span class='object_link'><a href="../Emma/Common.html#url_query-instance_method" title="Emma::Common#url_query (method)">#url_query</a></span></p>

  

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="add_to_index-instance_method">
  
    #<strong>add_to_index</strong>(*items, atomic: true)  &#x21d2; <tt>(Array,Array,Array)</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Add the indicated items from the EMMA Unified Index.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>items</span>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span>&gt;</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>atomic</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../top-level-namespace.html#Boolean-constant" title="Boolean (constant)">Boolean</a></span></tt>)</span>
      
      
        <em class="default">(defaults to: <tt>true</tt>)</em>
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>(Array,Array,Array)</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Succeeded records, failed item messages, and records to roll back.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>StandardError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>@see IngestService::Request::Records#put_records</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1214
1215
1216
1217
1218
1219
1220
1221
1222
1223
1224
1225
1226
1227
1228
1229
1230
1231
1232</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/upload_workflow.rb', line 1214</span>

<span class='kw'>def</span> <span class='id identifier rubyid_add_to_index'>add_to_index</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_items'>items</span><span class='comma'>,</span> <span class='label'>atomic:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='op'>**</span><span class='rparen'>)</span>
  <span class='id identifier rubyid___debug_items'>__debug_items</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW UPLOAD </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid___method__'>__method__</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_binding'>binding</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_succeeded'>succeeded</span><span class='comma'>,</span> <span class='id identifier rubyid_failed'>failed</span><span class='comma'>,</span> <span class='id identifier rubyid_rollback'>rollback</span> <span class='op'>=</span> <span class='id identifier rubyid_update_in_index'>update_in_index</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_items'>items</span><span class='comma'>,</span> <span class='label'>atomic:</span> <span class='id identifier rubyid_atomic'>atomic</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_rollback'>rollback</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
    <span class='comment'># Any submissions that could not be added to the index will be removed
</span>    <span class='comment'># from the database.  The assumption here is that they failed because
</span>    <span class='comment'># they were missing information and need to be re-submitted anyway.
</span>    <span class='id identifier rubyid_removed'>removed</span><span class='comma'>,</span> <span class='id identifier rubyid_kept'>kept</span> <span class='op'>=</span> <span class='id identifier rubyid_upload_remove'>upload_remove</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_rollback'>rollback</span><span class='comma'>,</span> <span class='label'>atomic:</span> <span class='kw'>false</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_removed'>removed</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
      <span class='id identifier rubyid_sids'>sids</span> <span class='op'>=</span> <span class='id identifier rubyid_removed'>removed</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:submission_id</span><span class='rparen'>)</span>
      <span class='const'><span class='object_link'><a href="../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid___method__'>__method__</span><span class='embexpr_end'>}</span><span class='tstring_content'>: removed: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_sids'>sids</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
      <span class='id identifier rubyid_rollback'>rollback</span><span class='period'>.</span><span class='id identifier rubyid_reject!'>reject!</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_item'>item</span><span class='op'>|</span> <span class='id identifier rubyid_sids'>sids</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_submission_id'>submission_id</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_succeeded'>succeeded</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_atomic'>atomic</span>
    <span class='id identifier rubyid_failed'>failed</span> <span class='op'>+=</span> <span class='id identifier rubyid_kept'>kept</span> <span class='kw'>if</span> <span class='id identifier rubyid_kept'>kept</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
    <span class='id identifier rubyid_rollback'>rollback</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:delete_file</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_succeeded'>succeeded</span><span class='comma'>,</span> <span class='id identifier rubyid_failed'>failed</span><span class='comma'>,</span> <span class='id identifier rubyid_rollback'>rollback</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="aws_api-instance_method">
  
    #<strong>aws_api</strong>  &#x21d2; <tt><span class='object_link'><a href="../AwsS3Service.html" title="AwsS3Service (class)">AwsS3Service</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Current AWS API service instance.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../AwsS3Service.html" title="AwsS3Service (class)">AwsS3Service</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


647
648
649
650</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/upload_workflow.rb', line 647</span>

<span class='kw'>def</span> <span class='id identifier rubyid_aws_api'>aws_api</span>
  <span class='comment'># noinspection RubyYardReturnMatch
</span>  <span class='const'><span class='object_link'><a href="../AwsS3Service.html" title="AwsS3Service (class)">AwsS3Service</a></span></span><span class='period'>.</span><span class='id identifier rubyid_instance'>instance</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="batch_repository_remove-instance_method">
  
    
      <span class="overload">#<strong>batch_repository_remove</strong>(requests, **opt)  &#x21d2; <tt>(Array,Array)</tt> </span>
    
      <span class="overload">#<strong>batch_repository_remove</strong>(items, **opt)  &#x21d2; <tt>(Array,Array)</tt> </span>
    
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>batch_repository_remove</p>

<h2 id="label-Variations">Variations</h2>


  </div>
</div>
<div class="tags">
  
  <p class="tag_title">Overloads:</p>
  <ul class="overload">
    
      
      <li class="overload_item">
        <span class="signature">#<strong>batch_repository_remove</strong>(requests, **opt)  &#x21d2; <tt>(Array,Array)</tt> </span>
        <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>requests</span>
      
      
        <span class='type'>(<tt>Hash{Symbol=&gt;Array}</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>opt</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>(Array,Array)</tt>)</span>
      
      
      
    </li>
  
</ul>

</div>
      </li>
    
      
      <li class="overload_item">
        <span class="signature">#<strong>batch_repository_remove</strong>(items, **opt)  &#x21d2; <tt>(Array,Array)</tt> </span>
        <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>items</span>
      
      
        <span class='type'>(<tt>Array&lt;String,#emma_recordId,*&gt;</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>opt</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>(Array,Array)</tt>)</span>
      
      
      
    </li>
  
</ul>

</div>
      </li>
    
  </ul>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>items</span>
      
      
        <span class='type'>(<tt>Hash</tt>, <tt>Array</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>opt</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Passed to #repository_remove.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>(Array,Array)</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Succeeded items and failed item messages.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1524
1525
1526
1527
1528
1529
1530
1531
1532
1533
1534</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/upload_workflow.rb', line 1524</span>

<span class='kw'>def</span> <span class='id identifier rubyid_batch_repository_remove'>batch_repository_remove</span><span class='lparen'>(</span><span class='id identifier rubyid_items'>items</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opt'>opt</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_succeeded'>succeeded</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_failed'>failed</span>    <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_batch_repository_request'>batch_repository_request</span><span class='lparen'>(</span><span class='id identifier rubyid_items'>items</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each_pair'>each_pair</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_repo'>repo</span><span class='comma'>,</span> <span class='id identifier rubyid_repo_items'>repo_items</span><span class='op'>|</span>
    <span class='id identifier rubyid_repo_items'>repo_items</span><span class='period'>.</span><span class='id identifier rubyid_map!'>map!</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_item'>item</span><span class='op'>|</span> <span class='const'><span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span></span><span class='period'>.</span><span class='id identifier rubyid_record_id'><span class='object_link'><a href="../Upload.html#record_id-class_method" title="Upload.record_id (method)">record_id</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_item'>item</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
    <span class='id identifier rubyid_s'>s</span><span class='comma'>,</span> <span class='id identifier rubyid_f'>f</span> <span class='op'>=</span> <span class='id identifier rubyid_repository_remove'>repository_remove</span><span class='lparen'>(</span><span class='id identifier rubyid_repo'>repo</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_repo_items'>repo_items</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opt'>opt</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_succeeded'>succeeded</span> <span class='op'>+=</span> <span class='id identifier rubyid_s'>s</span>
    <span class='id identifier rubyid_failed'>failed</span>    <span class='op'>+=</span> <span class='id identifier rubyid_f'>f</span>
  <span class='kw'>end</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_succeeded'>succeeded</span><span class='comma'>,</span> <span class='id identifier rubyid_failed'>failed</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="batch_repository_request-instance_method">
  
    
      <span class="overload">#<strong>batch_repository_request</strong>(requests)  &#x21d2; <tt>Hash{String=&gt;Array}</tt> </span>
    
      <span class="overload">#<strong>batch_repository_request</strong>(items)  &#x21d2; <tt>Hash{String=&gt;Array}</tt> </span>
    
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>batch_repository_request</p>

<h2 id="label-Variations">Variations</h2>


  </div>
</div>
<div class="tags">
  
  <p class="tag_title">Overloads:</p>
  <ul class="overload">
    
      
      <li class="overload_item">
        <span class="signature">#<strong>batch_repository_request</strong>(requests)  &#x21d2; <tt>Hash{String=&gt;Array}</tt> </span>
        <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>requests</span>
      
      
        <span class='type'>(<tt>Hash{String=&gt;Array}</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash{String=&gt;Array}</tt>)</span>
      
      
      
    </li>
  
</ul>

</div>
      </li>
    
      
      <li class="overload_item">
        <span class="signature">#<strong>batch_repository_request</strong>(items)  &#x21d2; <tt>Hash{String=&gt;Array}</tt> </span>
        <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>items</span>
      
      
        <span class='type'>(<tt>Array&lt;String,#emma_recordId,*&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash{String=&gt;Array}</tt>)</span>
      
      
      
    </li>
  
</ul>

</div>
      </li>
    
  </ul>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>items</span>
      
      
        <span class='type'>(<tt>Hash</tt>, <tt>Array</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>empty_key</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../top-level-namespace.html#Boolean-constant" title="Boolean (constant)">Boolean</a></span></tt>)</span>
      
      
        <em class="default">(defaults to: <tt>false</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>If <strong>true</strong>, allow invalid items.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash{String=&gt;Array}</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1553
1554
1555
1556
1557
1558
1559
1560
1561
1562
1563
1564
1565
1566</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/upload_workflow.rb', line 1553</span>

<span class='kw'>def</span> <span class='id identifier rubyid_batch_repository_request'>batch_repository_request</span><span class='lparen'>(</span><span class='id identifier rubyid_items'>items</span><span class='comma'>,</span> <span class='label'>empty_key:</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_items'>items</span>
    <span class='kw'>when</span> <span class='const'>Array</span>
      <span class='id identifier rubyid_items'>items</span>  <span class='op'>=</span> <span class='id identifier rubyid_items'>items</span><span class='period'>.</span><span class='id identifier rubyid_flatten'>flatten</span><span class='period'>.</span><span class='id identifier rubyid_reject'>reject</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:blank?</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_items'>items</span><span class='period'>.</span><span class='id identifier rubyid_group_by'>group_by</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_item'>item</span><span class='op'>|</span> <span class='const'><span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span></span><span class='period'>.</span><span class='id identifier rubyid_repository_of'><span class='object_link'><a href="../Upload.html#repository_of-class_method" title="Upload.repository_of (method)">repository_of</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_item'>item</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
    <span class='kw'>when</span> <span class='const'>Hash</span>
      <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_items'>items</span><span class='period'>.</span><span class='id identifier rubyid_transform_values'>transform_values</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_repo_items'>repo_items</span><span class='op'>|</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_wrap'>wrap</span><span class='lparen'>(</span><span class='id identifier rubyid_repo_items'>repo_items</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
    <span class='kw'>else</span>
      <span class='const'><span class='object_link'><a href="../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid___method__'>__method__</span><span class='embexpr_end'>}</span><span class='tstring_content'>: expected &#39;items&#39; type: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_items'>items</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
  <span class='comment'># noinspection RubyYardReturnMatch
</span>  <span class='id identifier rubyid_empty_key'>empty_key</span> <span class='op'>?</span> <span class='id identifier rubyid_result'>result</span> <span class='op'>:</span> <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_delete_if'>delete_if</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_repo'>repo</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='op'>|</span> <span class='id identifier rubyid_repo'>repo</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="db_delete-instance_method">
  
    #<strong>db_delete</strong>(data)  &#x21d2; <tt>*</tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Remove a single existing Upload record from the database.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>data</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span></tt>, <tt>Hash</tt>, <tt>String</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>*</tt>)</span>
      
      
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>If the record was not found or removed.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1185
1186
1187
1188
1189</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/upload_workflow.rb', line 1185</span>

<span class='kw'>def</span> <span class='id identifier rubyid_db_delete'>db_delete</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
  <span class='id identifier rubyid___debug_items'>__debug_items</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW UPLOAD </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid___method__'>__method__</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_binding'>binding</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_record'>record</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span></span><span class='rparen'>)</span> <span class='op'>?</span> <span class='id identifier rubyid_data'>data</span> <span class='op'>:</span> <span class='id identifier rubyid_get_record'>get_record</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_record'>record</span><span class='op'>&amp;.</span><span class='id identifier rubyid_destroy'>destroy</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="db_insert-instance_method">
  
    #<strong>db_insert</strong>(data)  &#x21d2; <tt><span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span></tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Add a single Upload record to the database.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>data</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span></tt>, <tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>@see Upload#assign_attributes.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The provided or created record.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>If the record was not created or updated.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1137
1138
1139
1140
1141
1142
1143</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/upload_workflow.rb', line 1137</span>

<span class='kw'>def</span> <span class='id identifier rubyid_db_insert'>db_insert</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
  <span class='id identifier rubyid___debug_items'>__debug_items</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW UPLOAD </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid___method__'>__method__</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_binding'>binding</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_record'>record</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span></span><span class='rparen'>)</span> <span class='op'>?</span> <span class='id identifier rubyid_data'>data</span> <span class='op'>:</span> <span class='id identifier rubyid_new_record'>new_record</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_record'>record</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span> <span class='kw'>if</span> <span class='id identifier rubyid_record'>record</span><span class='op'>&amp;.</span><span class='id identifier rubyid_new_record?'>new_record?</span>
  <span class='comment'># noinspection RubyYardReturnMatch
</span>  <span class='id identifier rubyid_record'>record</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="db_update-instance_method">
  
    #<strong>db_update</strong>(record, data = nil)  &#x21d2; <tt><span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span></tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Modify a single existing Upload database record.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>record</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span></tt>, <tt>Hash</tt>, <tt>String</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>data</span>
      
      
        <span class='type'>(<tt>Hash</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The provided or located record.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>If the record was not found or updated.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1153
1154
1155
1156
1157
1158
1159
1160
1161
1162
1163
1164
1165
1166
1167
1168
1169
1170
1171
1172
1173
1174
1175
1176</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/upload_workflow.rb', line 1153</span>

<span class='kw'>def</span> <span class='id identifier rubyid_db_update'>db_update</span><span class='lparen'>(</span><span class='id identifier rubyid_record'>record</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid___debug_items'>__debug_items</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW UPLOAD </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid___method__'>__method__</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_binding'>binding</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_record'>record</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_record'>record</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_record'>record</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span>
  <span class='kw'>unless</span> <span class='id identifier rubyid_record'>record</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span></span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_opt'>opt</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_partition_options'>partition_options</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='comma'>,</span> <span class='symbol'>:no_raise</span><span class='comma'>,</span> <span class='symbol'>:meth</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_ids'>ids</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_partition_options'>partition_options</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='comma'>,</span> <span class='symbol'>:id</span><span class='comma'>,</span> <span class='symbol'>:submission_id</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_id'>id</span>   <span class='op'>=</span> <span class='id identifier rubyid_record'>record</span> <span class='op'>||</span> <span class='id identifier rubyid_ids'>ids</span><span class='period'>.</span><span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_opt'>opt</span>  <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
      <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='kw'>nil</span>
      <span class='id identifier rubyid_id'>id</span>   <span class='op'>=</span> <span class='id identifier rubyid_record'>record</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_record'>record</span> <span class='op'>=</span> <span class='id identifier rubyid_get_record'>get_record</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opt'>opt</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_record'>record</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
    <span class='id identifier rubyid_record'>record</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_record'>record</span><span class='period'>.</span><span class='id identifier rubyid_new_record?'>new_record?</span>
    <span class='id identifier rubyid_record'>record</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
  <span class='kw'>end</span>
  <span class='comment'># noinspection RubyYardReturnMatch
</span>  <span class='id identifier rubyid_record'>record</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="emma_item?-instance_method">
  
    #<strong>emma_item?</strong>(item)  &#x21d2; <tt><span class='object_link'><a href="../top-level-namespace.html#Boolean-constant" title="Boolean (constant)">Boolean</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Indicate whether the item represents an EMMA repository entry (as opposed to a member repository entry).</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>item</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span></tt>, <tt>String</tt>, <tt>#emma_repository</tt>, <tt>#emma_recordId</tt>, <tt>*</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../top-level-namespace.html#Boolean-constant" title="Boolean (constant)">Boolean</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>Upload#valid_rid?</li>
    
      <li><span class='object_link'><a href="../Upload.html#emma_native%3F-instance_method" title="Upload#emma_native? (method)">Upload#emma_native?</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/upload_workflow.rb', line 669</span>

<span class='kw'>def</span> <span class='id identifier rubyid_emma_item?'>emma_item?</span><span class='lparen'>(</span><span class='id identifier rubyid_item'>item</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span></span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_repository'>repository</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='comment'># noinspection RubyYardParamTypeMatch
</span>  <span class='id identifier rubyid_digits_only?'>digits_only?</span><span class='lparen'>(</span><span class='id identifier rubyid_item'>item</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='const'><span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span></span><span class='period'>.</span><span class='id identifier rubyid_valid_sid?'>valid_sid?</span><span class='lparen'>(</span><span class='id identifier rubyid_item'>item</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='const'><span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span></span><span class='period'>.</span><span class='id identifier rubyid_emma_native?'><span class='object_link'><a href="../Upload.html#emma_native%3F-class_method" title="Upload.emma_native? (method)">emma_native?</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_item'>item</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="find_records-instance_method">
  
    #<strong>find_records</strong>(*items, **opt)  &#x21d2; <tt>Array&lt;<span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span>&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Find all of the specified Upload records.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>items</span>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span>,String,Array&gt;</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>opt</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Passed to #collect_records.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span>&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1015
1016
1017</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/upload_workflow.rb', line 1015</span>

<span class='kw'>def</span> <span class='id identifier rubyid_find_records'>find_records</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_items'>items</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opt'>opt</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_collect_records'>collect_records</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_items'>items</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opt'>opt</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span> <span class='op'>||</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_record-instance_method">
  
    #<strong>get_record</strong>(id, no_raise: false, meth: nil)  &#x21d2; <tt><span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span></tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Return with the specified record or <strong>nil</strong> if one could not be found.</p>

<p> noinspection RubyYardParamTypeMatch ++</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>id</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Hash</tt>, <tt><span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span></tt>, <tt>nil</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>no_raise</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../top-level-namespace.html#Boolean-constant" title="Boolean (constant)">Boolean</a></span></tt>)</span>
      
      
        <em class="default">(defaults to: <tt>false</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>If <strong>true</strong>, do not raise exceptions.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>meth</span>
      
      
        <span class='type'>(<tt>Symbol</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Calling method (for logging).</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The item; from the database if necessary.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>If <strong>item</strong> not found and <strong>no_raise</strong>.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>StandardError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>If <strong>item</strong> not found and !<strong>no_raise</strong>.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


995
996
997
998
999
1000
1001
1002
1003
1004
1005
1006</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/upload_workflow.rb', line 995</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_record'>get_record</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='label'>no_raise:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='label'>meth:</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_record'>get_record</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_result'>result</span>
  <span class='kw'>elsif</span> <span class='const'><span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span></span><span class='period'>.</span><span class='id identifier rubyid_id_term'>id_term</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
    <span class='id identifier rubyid_failure'>failure</span><span class='lparen'>(</span><span class='symbol'>:file_id</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_no_raise'>no_raise</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_no_raise'>no_raise</span>
    <span class='const'><span class='object_link'><a href="../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span>  <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_meth'>meth</span> <span class='op'>||</span> <span class='id identifier rubyid___method__'>__method__</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_content'>: skipping record</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
  <span class='kw'>else</span>
    <span class='const'><span class='object_link'><a href="../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_meth'>meth</span> <span class='op'>||</span> <span class='id identifier rubyid___method__'>__method__</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_content'>: non-existent record</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
    <span class='id identifier rubyid_failure'>failure</span><span class='lparen'>(</span><span class='symbol'>:find</span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="identifier-instance_method">
  
    #<strong>identifier</strong>(item)  &#x21d2; <tt>String</tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The database ID for the item, or, failing that, the submission ID.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>item</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span></tt>, <tt>Hash</tt>, <tt>String</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Record :id or :submission_id.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>No identifier could be determined.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


967
968
969</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/upload_workflow.rb', line 967</span>

<span class='kw'>def</span> <span class='id identifier rubyid_identifier'>identifier</span><span class='lparen'>(</span><span class='id identifier rubyid_item'>item</span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span></span><span class='period'>.</span><span class='id identifier rubyid_id_for'>id_for</span><span class='lparen'>(</span><span class='id identifier rubyid_item'>item</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='const'><span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span></span><span class='period'>.</span><span class='id identifier rubyid_sid_for'>sid_for</span><span class='lparen'>(</span><span class='id identifier rubyid_item'>item</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="identifiers-instance_method">
  
    #<strong>identifiers</strong>(item)  &#x21d2; <tt>Array&lt;String&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Return an array of the characteristic identifiers for the item.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>item</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span></tt>, <tt>Hash</tt>, <tt>String</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;String&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


977
978
979</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/upload_workflow.rb', line 977</span>

<span class='kw'>def</span> <span class='id identifier rubyid_identifiers'>identifiers</span><span class='lparen'>(</span><span class='id identifier rubyid_item'>item</span><span class='rparen'>)</span>
  <span class='lbracket'>[</span><span class='const'><span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span></span><span class='period'>.</span><span class='id identifier rubyid_id_for'>id_for</span><span class='lparen'>(</span><span class='id identifier rubyid_item'>item</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span></span><span class='period'>.</span><span class='id identifier rubyid_sid_for'>sid_for</span><span class='lparen'>(</span><span class='id identifier rubyid_item'>item</span><span class='rparen'>)</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_compact'>compact</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="ingest_api-instance_method">
  
    #<strong>ingest_api</strong>  &#x21d2; <tt><span class='object_link'><a href="../IngestService.html" title="IngestService (class)">IngestService</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Current Ingest API service instance.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../IngestService.html" title="IngestService (class)">IngestService</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


656
657
658
659</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/upload_workflow.rb', line 656</span>

<span class='kw'>def</span> <span class='id identifier rubyid_ingest_api'>ingest_api</span>
  <span class='comment'># noinspection RubyYardReturnMatch
</span>  <span class='const'><span class='object_link'><a href="../IngestService.html" title="IngestService (class)">IngestService</a></span></span><span class='period'>.</span><span class='id identifier rubyid_instance'>instance</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="new_record-instance_method">
  
    #<strong>new_record</strong>(data = nil)  &#x21d2; <tt><span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Create a new free-standing (un-persisted) Upload instance.</p>

<p> noinspection RubyNilAnalysis ++</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>data</span>
      
      
        <span class='type'>(<tt>Hash</tt>, <tt><span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span></tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Passed to Upload#initialize.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'>#add_title_prefix</span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1030
1031
1032
1033</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/upload_workflow.rb', line 1030</span>

<span class='kw'>def</span> <span class='id identifier rubyid_new_record'>new_record</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid___debug_items'>__debug_items</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UPLOAD </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid___method__'>__method__</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_binding'>binding</span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Upload.html#initialize-instance_method" title="Upload#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_tap'>tap</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_record'>record</span><span class='op'>|</span> <span class='id identifier rubyid_add_title_prefix'>add_title_prefix</span><span class='lparen'>(</span><span class='id identifier rubyid_record'>record</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_title_prefix'>title_prefix</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="remove_from_index-instance_method">
  
    #<strong>remove_from_index</strong>(*items, atomic: true)  &#x21d2; <tt>(Array,Array)</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Remove the indicated items from the EMMA Unified Index.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>items</span>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span>, String&gt;</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>atomic</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../top-level-namespace.html#Boolean-constant" title="Boolean (constant)">Boolean</a></span></tt>)</span>
      
      
        <em class="default">(defaults to: <tt>true</tt>)</em>
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>(Array,Array)</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Succeeded items and failed item messages.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>StandardError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>@see IngestService::Request::Records#delete_records</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1267
1268
1269
1270
1271
1272
1273
1274
1275
1276</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/upload_workflow.rb', line 1267</span>

<span class='kw'>def</span> <span class='id identifier rubyid_remove_from_index'>remove_from_index</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_items'>items</span><span class='comma'>,</span> <span class='label'>atomic:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='op'>**</span><span class='rparen'>)</span>
  <span class='id identifier rubyid___debug_items'>__debug_items</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW UPLOAD </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid___method__'>__method__</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_binding'>binding</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_items'>items</span> <span class='op'>=</span> <span class='id identifier rubyid_normalize_index_items'>normalize_index_items</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_items'>items</span><span class='comma'>,</span> <span class='label'>meth:</span> <span class='id identifier rubyid___method__'>__method__</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_items'>items</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>

  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_ingest_api'>ingest_api</span><span class='period'>.</span><span class='id identifier rubyid_delete_records'>delete_records</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_items'>items</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_succeeded'>succeeded</span><span class='comma'>,</span> <span class='id identifier rubyid_failed'>failed</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span> <span class='op'>=</span> <span class='id identifier rubyid_process_ingest_errors'>process_ingest_errors</span><span class='lparen'>(</span><span class='id identifier rubyid_result'>result</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_items'>items</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_succeeded'>succeeded</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_atomic'>atomic</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_failed'>failed</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_succeeded'>succeeded</span><span class='comma'>,</span> <span class='id identifier rubyid_failed'>failed</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="repository_create-instance_method">
  
    #<strong>repository_create</strong>(repo, *data, **opt)  &#x21d2; <tt>(Array,Array)</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Submit a new item to member repository</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>repo</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>data</span>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span>&gt;</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>opt</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>(Array,Array)</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Succeeded items and failed item messages.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1407
1408
1409
1410
1411
1412
1413
1414
1415
1416
1417
1418
1419
1420
1421</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/upload_workflow.rb', line 1407</span>

<span class='kw'>def</span> <span class='id identifier rubyid_repository_create'>repository_create</span><span class='lparen'>(</span><span class='id identifier rubyid_repo'>repo</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_data'>data</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opt'>opt</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_succeeded'>succeeded</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_failed'>failed</span>    <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_repo'>repo</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
    <span class='id identifier rubyid_failed'>failed</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="#REPO_FAILURE-constant" title="UploadWorkflow::External::REPO_FAILURE (constant)">REPO_FAILURE</a></span></span><span class='lbracket'>[</span><span class='symbol'>:no_repo</span><span class='rbracket'>]</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
    <span class='id identifier rubyid_failed'>failed</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="#REPO_FAILURE-constant" title="UploadWorkflow::External::REPO_FAILURE (constant)">REPO_FAILURE</a></span></span><span class='lbracket'>[</span><span class='symbol'>:no_items</span><span class='rbracket'>]</span>
  <span class='kw'>elsif</span> <span class='op'>!</span><span class='id identifier rubyid_repo_create'>repo_create</span>
    <span class='id identifier rubyid_failed'>failed</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="#REPO_FAILURE-constant" title="UploadWorkflow::External::REPO_FAILURE (constant)">REPO_FAILURE</a></span></span><span class='lbracket'>[</span><span class='symbol'>:no_create</span><span class='rbracket'>]</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_aws_api'>aws_api</span><span class='period'>.</span><span class='id identifier rubyid_creation_request'>creation_request</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_data'>data</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opt'>opt</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_succeeded'>succeeded</span><span class='comma'>,</span> <span class='id identifier rubyid_failed'>failed</span> <span class='op'>=</span> <span class='id identifier rubyid_process_aws_errors'>process_aws_errors</span><span class='lparen'>(</span><span class='id identifier rubyid_result'>result</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_succeeded'>succeeded</span><span class='comma'>,</span> <span class='id identifier rubyid_failed'>failed</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="repository_edit-instance_method">
  
    #<strong>repository_edit</strong>(repo, *data, **opt)  &#x21d2; <tt>(Array,Array)</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>TODO: request update of an existing member repository entry</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>repo</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>data</span>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span>&gt;</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>opt</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>(Array,Array)</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Succeeded items and failed item messages.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1431
1432
1433
1434
1435
1436
1437
1438
1439
1440
1441
1442
1443
1444
1445</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/upload_workflow.rb', line 1431</span>

<span class='kw'>def</span> <span class='id identifier rubyid_repository_edit'>repository_edit</span><span class='lparen'>(</span><span class='id identifier rubyid_repo'>repo</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_data'>data</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opt'>opt</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_succeeded'>succeeded</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_failed'>failed</span>    <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_repo'>repo</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
    <span class='id identifier rubyid_failed'>failed</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="#REPO_FAILURE-constant" title="UploadWorkflow::External::REPO_FAILURE (constant)">REPO_FAILURE</a></span></span><span class='lbracket'>[</span><span class='symbol'>:no_repo</span><span class='rbracket'>]</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
    <span class='id identifier rubyid_failed'>failed</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="#REPO_FAILURE-constant" title="UploadWorkflow::External::REPO_FAILURE (constant)">REPO_FAILURE</a></span></span><span class='lbracket'>[</span><span class='symbol'>:no_items</span><span class='rbracket'>]</span>
  <span class='kw'>elsif</span> <span class='op'>!</span><span class='id identifier rubyid_repo_edit'>repo_edit</span>
    <span class='id identifier rubyid_failed'>failed</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="#REPO_FAILURE-constant" title="UploadWorkflow::External::REPO_FAILURE (constant)">REPO_FAILURE</a></span></span><span class='lbracket'>[</span><span class='symbol'>:no_edit</span><span class='rbracket'>]</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_aws_api'>aws_api</span><span class='period'>.</span><span class='id identifier rubyid_modification_request'>modification_request</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_data'>data</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opt'>opt</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_succeeded'>succeeded</span><span class='comma'>,</span> <span class='id identifier rubyid_failed'>failed</span> <span class='op'>=</span> <span class='id identifier rubyid_process_aws_errors'>process_aws_errors</span><span class='lparen'>(</span><span class='id identifier rubyid_result'>result</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_succeeded'>succeeded</span><span class='comma'>,</span> <span class='id identifier rubyid_failed'>failed</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="repository_remove-instance_method">
  
    #<strong>repository_remove</strong>(repo, *data, **opt)  &#x21d2; <tt>(Array,Array)</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>TODO: request removal of an existing member repository entry</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>repo</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>data</span>
      
      
        <span class='type'>(<tt>Array&lt;String,<span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span>&gt;</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>opt</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>(Array,Array)</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Succeeded items and failed item messages.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1455
1456
1457
1458
1459
1460
1461
1462
1463
1464
1465
1466
1467
1468
1469
1470
1471
1472
1473</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/upload_workflow.rb', line 1455</span>

<span class='kw'>def</span> <span class='id identifier rubyid_repository_remove'>repository_remove</span><span class='lparen'>(</span><span class='id identifier rubyid_repo'>repo</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_data'>data</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opt'>opt</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_succeeded'>succeeded</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_failed'>failed</span>    <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_repo'>repo</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
    <span class='id identifier rubyid_failed'>failed</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="#REPO_FAILURE-constant" title="UploadWorkflow::External::REPO_FAILURE (constant)">REPO_FAILURE</a></span></span><span class='lbracket'>[</span><span class='symbol'>:no_repo</span><span class='rbracket'>]</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
    <span class='id identifier rubyid_failed'>failed</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="#REPO_FAILURE-constant" title="UploadWorkflow::External::REPO_FAILURE (constant)">REPO_FAILURE</a></span></span><span class='lbracket'>[</span><span class='symbol'>:no_items</span><span class='rbracket'>]</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_opt'>opt</span><span class='lbracket'>[</span><span class='symbol'>:emergency</span><span class='rbracket'>]</span>
    <span class='comment'># Emergency override for deleting bogus entries creating during
</span>    <span class='comment'># testing/development.
</span>    <span class='id identifier rubyid_succeeded'>succeeded</span><span class='comma'>,</span> <span class='id identifier rubyid_failed'>failed</span> <span class='op'>=</span> <span class='id identifier rubyid_remove_from_index'>remove_from_index</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
  <span class='kw'>elsif</span> <span class='op'>!</span><span class='id identifier rubyid_repo_remove'>repo_remove</span>
    <span class='id identifier rubyid_failed'>failed</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="#REPO_FAILURE-constant" title="UploadWorkflow::External::REPO_FAILURE (constant)">REPO_FAILURE</a></span></span><span class='lbracket'>[</span><span class='symbol'>:no_remove</span><span class='rbracket'>]</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_aws_api'>aws_api</span><span class='period'>.</span><span class='id identifier rubyid_removal_request'>removal_request</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_data'>data</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opt'>opt</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_succeeded'>succeeded</span><span class='comma'>,</span> <span class='id identifier rubyid_failed'>failed</span> <span class='op'>=</span> <span class='id identifier rubyid_process_aws_errors'>process_aws_errors</span><span class='lparen'>(</span><span class='id identifier rubyid_result'>result</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_succeeded'>succeeded</span><span class='comma'>,</span> <span class='id identifier rubyid_failed'>failed</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="skip_index_ingest-instance_method">
  
    #<strong>skip_index_ingest</strong>(method, *items)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1286
1287
1288
1289</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/upload_workflow.rb', line 1286</span>

<span class='kw'>def</span> <span class='id identifier rubyid_skip_index_ingest'>skip_index_ingest</span><span class='lparen'>(</span><span class='id identifier rubyid_method'>method</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_items'>items</span><span class='rparen'>)</span>
  <span class='id identifier rubyid___debug'><span class='object_link'><a href="../top-level-namespace.html#__debug-instance_method" title="#__debug (method)">__debug</a></span></span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>** SKIPPING ** UPLOAD </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_method'>method</span><span class='embexpr_end'>}</span><span class='tstring_content'> | items = </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_items'>items</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_items'>items</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_in_index-instance_method">
  
    #<strong>update_in_index</strong>(*items, atomic: true)  &#x21d2; <tt>(Array,Array,Array)</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Add/modify the indicated items from the EMMA Unified Index.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>items</span>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span>&gt;</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>atomic</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../top-level-namespace.html#Boolean-constant" title="Boolean (constant)">Boolean</a></span></tt>)</span>
      
      
        <em class="default">(defaults to: <tt>true</tt>)</em>
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>(Array,Array,Array)</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Succeeded records, failed item messages, and records to roll back.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>StandardError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>@see IngestService::Request::Records#put_records</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1244
1245
1246
1247
1248
1249
1250
1251
1252
1253
1254
1255
1256</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/upload_workflow.rb', line 1244</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update_in_index'>update_in_index</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_items'>items</span><span class='comma'>,</span> <span class='label'>atomic:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='op'>**</span><span class='rparen'>)</span>
  <span class='id identifier rubyid___debug_items'>__debug_items</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW UPLOAD </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid___method__'>__method__</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_binding'>binding</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_items'>items</span> <span class='op'>=</span> <span class='id identifier rubyid_normalize_index_items'>normalize_index_items</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_items'>items</span><span class='comma'>,</span> <span class='label'>meth:</span> <span class='id identifier rubyid___method__'>__method__</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_items'>items</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>

  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_ingest_api'>ingest_api</span><span class='period'>.</span><span class='id identifier rubyid_put_records'>put_records</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_items'>items</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_succeeded'>succeeded</span><span class='comma'>,</span> <span class='id identifier rubyid_failed'>failed</span><span class='comma'>,</span> <span class='id identifier rubyid_rollback'>rollback</span> <span class='op'>=</span> <span class='id identifier rubyid_process_ingest_errors'>process_ingest_errors</span><span class='lparen'>(</span><span class='id identifier rubyid_result'>result</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_items'>items</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_atomic'>atomic</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_failed'>failed</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
    <span class='id identifier rubyid_succeeded'>succeeded</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_rollback'>rollback</span>  <span class='op'>=</span> <span class='id identifier rubyid_items'>items</span>
  <span class='kw'>end</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_succeeded'>succeeded</span><span class='comma'>,</span> <span class='id identifier rubyid_failed'>failed</span><span class='comma'>,</span> <span class='id identifier rubyid_rollback'>rollback</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="upload_create-instance_method">
  
    #<strong>upload_create</strong>(index: nil, atomic: true, **data)  &#x21d2; <tt>(<span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span>,Array&gt;</tt>, <tt>(nil,Array)</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Add a new submission to the database, upload its file to storage, and add a new index entry for it (if explicitly requested).</p>

<p>Compare with:</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>index</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../top-level-namespace.html#Boolean-constant" title="Boolean (constant)">Boolean</a></span></tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>If <strong>true</strong>, update index.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>atomic</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../top-level-namespace.html#Boolean-constant" title="Boolean (constant)">Boolean</a></span></tt>)</span>
      
      
        <em class="default">(defaults to: <tt>true</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Passed to #add_to_index.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>data</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>@see Upload#assign_attributes.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>(<span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span>,Array&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Record and error messages.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>(nil,Array)</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>No record; error message.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#db_insert-instance_method" title="UploadWorkflow::External#db_insert (method)">#db_insert</a></span></li>
    
      <li><span class='object_link'><a href="#add_to_index-instance_method" title="UploadWorkflow::External#add_to_index (method)">#add_to_index</a></span></li>
    
      <li><span class='object_link'><a href="Bulk/External.html#bulk_upload_create-instance_method" title="UploadWorkflow::Bulk::External#bulk_upload_create (method)">Bulk::External#bulk_upload_create</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


697
698
699
700
701
702
703
704
705
706
707
708
709</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/upload_workflow.rb', line 697</span>

<span class='kw'>def</span> <span class='id identifier rubyid_upload_create'>upload_create</span><span class='lparen'>(</span><span class='label'>index:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>atomic:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
  <span class='id identifier rubyid___debug_items'>__debug_items</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW UPLOAD </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid___method__'>__method__</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_binding'>binding</span><span class='rparen'>)</span>

  <span class='comment'># Save the Upload record to the database.
</span>  <span class='id identifier rubyid_item'>item</span> <span class='op'>=</span> <span class='id identifier rubyid_db_insert'>db_insert</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>nil</span><span class='comma'>,</span>  <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Entry not created</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='kw'>unless</span> <span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span></span><span class='rparen'>)</span> <span class='comment'># TODO: I18n
</span>  <span class='kw'>return</span> <span class='id identifier rubyid_item'>item</span><span class='comma'>,</span> <span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_errors'>errors</span>           <span class='kw'>if</span> <span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_errors'>errors</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>

  <span class='comment'># Include the new submission in the index if specified.
</span>  <span class='kw'>return</span> <span class='id identifier rubyid_item'>item</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='kw'>unless</span> <span class='id identifier rubyid_index'>index</span>
  <span class='id identifier rubyid_succeeded'>succeeded</span><span class='comma'>,</span> <span class='id identifier rubyid_failed'>failed</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span> <span class='op'>=</span> <span class='id identifier rubyid_add_to_index'>add_to_index</span><span class='lparen'>(</span><span class='id identifier rubyid_item'>item</span><span class='comma'>,</span> <span class='label'>atomic:</span> <span class='id identifier rubyid_atomic'>atomic</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_succeeded'>succeeded</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='comma'>,</span> <span class='id identifier rubyid_failed'>failed</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="upload_edit-instance_method">
  
    #<strong>upload_edit</strong>(index: nil, atomic: true, **data)  &#x21d2; <tt>(<span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span>,Array&gt;</tt>, <tt>(nil,Array)</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Update an existing database record and update its associated index entry (if explicitly requested).</p>

<p>Compare with:</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>index</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../top-level-namespace.html#Boolean-constant" title="Boolean (constant)">Boolean</a></span></tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>If <strong>true</strong>, update index.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>atomic</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../top-level-namespace.html#Boolean-constant" title="Boolean (constant)">Boolean</a></span></tt>)</span>
      
      
        <em class="default">(defaults to: <tt>true</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Passed to #update_in_index.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>data</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>@see Upload#assign_attributes</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>(<span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span>,Array&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Record and error messages.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>(nil,Array)</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>No record; error message.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#db_update-instance_method" title="UploadWorkflow::External#db_update (method)">#db_update</a></span></li>
    
      <li><span class='object_link'><a href="#update_in_index-instance_method" title="UploadWorkflow::External#update_in_index (method)">#update_in_index</a></span></li>
    
      <li><span class='object_link'><a href="Bulk/External.html#bulk_upload_edit-instance_method" title="UploadWorkflow::Bulk::External#bulk_upload_edit (method)">Bulk::External#bulk_upload_edit</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


727
728
729
730
731
732
733
734
735
736
737
738
739
740
741
742
743
744
745
746</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/upload_workflow.rb', line 727</span>

<span class='kw'>def</span> <span class='id identifier rubyid_upload_edit'>upload_edit</span><span class='lparen'>(</span><span class='label'>index:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>atomic:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
  <span class='id identifier rubyid___debug_items'>__debug_items</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW UPLOAD </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid___method__'>__method__</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_binding'>binding</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
    <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:submission_id</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
      <span class='kw'>return</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>No identifier provided</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='comment'># TODO: I18n
</span>    <span class='kw'>elsif</span> <span class='op'>!</span><span class='const'><span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span></span><span class='period'>.</span><span class='id identifier rubyid_valid_sid?'>valid_sid?</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid EMMA submission ID </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='comment'># TODO: I18n
</span>    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Fetch the Upload record and update it in the database.
</span>  <span class='id identifier rubyid_item'>item</span> <span class='op'>=</span> <span class='id identifier rubyid_db_update'>db_update</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Entry </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_content'> not found</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='kw'>unless</span> <span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span></span><span class='rparen'>)</span> <span class='comment'># TODO: I18n
</span>  <span class='kw'>return</span> <span class='id identifier rubyid_item'>item</span><span class='comma'>,</span> <span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_errors'>errors</span>              <span class='kw'>if</span> <span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_errors'>errors</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>

  <span class='comment'># Update the index with the modified submission if specified.
</span>  <span class='kw'>return</span> <span class='id identifier rubyid_item'>item</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='kw'>unless</span> <span class='id identifier rubyid_index'>index</span>
  <span class='id identifier rubyid_succeeded'>succeeded</span><span class='comma'>,</span> <span class='id identifier rubyid_failed'>failed</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span> <span class='op'>=</span> <span class='id identifier rubyid_update_in_index'>update_in_index</span><span class='lparen'>(</span><span class='id identifier rubyid_item'>item</span><span class='comma'>,</span> <span class='label'>atomic:</span> <span class='id identifier rubyid_atomic'>atomic</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_succeeded'>succeeded</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='comma'>,</span> <span class='id identifier rubyid_failed'>failed</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="upload_remove-instance_method">
  
    #<strong>upload_remove</strong>(*items, index: nil, atomic: true, force: nil, **opt)  &#x21d2; <tt>(Array,Array)</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Remove Upload records from the database and from the index.</p>

<h2 id="label-Usage+Notes">Usage Notes</h2>

<p>Atomicity of the record removal phase rests on the assumption that any database problem(s) would manifest with the very first destruction attempt. If a later item fails, the successfully-destroyed items will still be removed from the index.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>items</span>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span>,String,Array&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>@see #collect_records</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>index</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../top-level-namespace.html#Boolean-constant" title="Boolean (constant)">Boolean</a></span></tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p><strong>false</strong> -&gt; no index update</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>atomic</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../top-level-namespace.html#Boolean-constant" title="Boolean (constant)">Boolean</a></span></tt>)</span>
      
      
        <em class="default">(defaults to: <tt>true</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p><strong>true</strong> == all-or-none</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>force</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../top-level-namespace.html#Boolean-constant" title="Boolean (constant)">Boolean</a></span></tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Force removal of index entries even if the related database entries do not exist.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>(Array,Array)</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Succeeded items and failed item messages.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#remove_from_index-instance_method" title="UploadWorkflow::External#remove_from_index (method)">#remove_from_index</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/upload_workflow.rb', line 767</span>

<span class='kw'>def</span> <span class='id identifier rubyid_upload_remove'>upload_remove</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_items'>items</span><span class='comma'>,</span> <span class='label'>index:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>atomic:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>force:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opt'>opt</span><span class='rparen'>)</span>
  <span class='id identifier rubyid___debug_items'>__debug_items</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW UPLOAD </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid___method__'>__method__</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_binding'>binding</span><span class='rparen'>)</span>

  <span class='comment'># Translate entries into Upload record instances.
</span>  <span class='id identifier rubyid_items'>items</span><span class='comma'>,</span> <span class='id identifier rubyid_failed'>failed</span> <span class='op'>=</span> <span class='id identifier rubyid_collect_records'>collect_records</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_items'>items</span><span class='comma'>,</span> <span class='label'>force:</span> <span class='id identifier rubyid_force'>force</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_requested'>requested</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_force'>force</span>
    <span class='id identifier rubyid_emergency'>emergency</span> <span class='op'>=</span> <span class='id identifier rubyid_opt'>opt</span><span class='lbracket'>[</span><span class='symbol'>:emergency</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_emergency_delete'>emergency_delete</span>
    <span class='comment'># Mark as failed any non-EMMA-items that could not be added to a request
</span>    <span class='comment'># for removal of member repository items.
</span>    <span class='id identifier rubyid_items'>items</span><span class='comma'>,</span> <span class='id identifier rubyid_failed'>failed</span> <span class='op'>=</span>
      <span class='id identifier rubyid_items'>items</span><span class='period'>.</span><span class='id identifier rubyid_partition'>partition</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_item'>item</span><span class='op'>|</span>
        <span class='id identifier rubyid_emma_item?'>emma_item?</span><span class='lparen'>(</span><span class='id identifier rubyid_item'>item</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span></span><span class='period'>.</span><span class='id identifier rubyid_sid_for'>sid_for</span><span class='lparen'>(</span><span class='id identifier rubyid_item'>item</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_emergency'>emergency</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_repo_remove'>repo_remove</span>
      <span class='id identifier rubyid_deferred'>deferred</span> <span class='op'>=</span> <span class='id identifier rubyid_opt'>opt</span><span class='period'>.</span><span class='id identifier rubyid_key?'>key?</span><span class='lparen'>(</span><span class='symbol'>:requests</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_requests'>requests</span> <span class='op'>=</span> <span class='id identifier rubyid_opt'>opt</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:requests</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
      <span class='id identifier rubyid_failed'>failed</span><span class='period'>.</span><span class='id identifier rubyid_delete_if'>delete_if</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_item'>item</span><span class='op'>|</span>
        <span class='kw'>next</span> <span class='kw'>unless</span> <span class='lparen'>(</span><span class='id identifier rubyid_repo'>repo</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span></span><span class='period'>.</span><span class='id identifier rubyid_repository_of'><span class='object_link'><a href="../Upload.html#repository_of-class_method" title="Upload.repository_of (method)">repository_of</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_item'>item</span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_requests'>requests</span><span class='lbracket'>[</span><span class='id identifier rubyid_repo'>repo</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_requests'>requests</span><span class='lbracket'>[</span><span class='id identifier rubyid_repo'>repo</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_item'>item</span>
        <span class='id identifier rubyid_requested'>requested</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_item'>item</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_batch_repository_remove'>batch_repository_remove</span><span class='lparen'>(</span><span class='id identifier rubyid_requests'>requests</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opt'>opt</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_deferred'>deferred</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_atomic'>atomic</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_failed'>failed</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>||</span> <span class='id identifier rubyid_items'>items</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
    <span class='kw'>return</span> <span class='lparen'>(</span><span class='id identifier rubyid_items'>items</span> <span class='op'>+</span> <span class='id identifier rubyid_requested'>requested</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_failed'>failed</span>
  <span class='kw'>end</span>

  <span class='comment'># Remove the records from the database.
</span>  <span class='id identifier rubyid_destroyed'>destroyed</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_retained'>retained</span>  <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_counter'>counter</span>   <span class='op'>=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_items'>items</span> <span class='op'>=</span>
    <span class='id identifier rubyid_items'>items</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_item'>item</span><span class='op'>|</span>
      <span class='comment'># noinspection RubyYardParamTypeMatch
</span>      <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../Upload.html" title="Upload (class)">Upload</a></span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_item'>item</span>                        <span class='comment'># Only seen if *force* is *true*.
</span>      <span class='kw'>elsif</span> <span class='id identifier rubyid_db_delete'>db_delete</span><span class='lparen'>(</span><span class='id identifier rubyid_item'>item</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_throttle'>throttle</span><span class='lparen'>(</span><span class='id identifier rubyid_counter'>counter</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_counter'>counter</span> <span class='op'>+=</span> <span class='int'>1</span>
        <span class='id identifier rubyid_destroyed'>destroyed</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_item'>item</span>
        <span class='id identifier rubyid_item'>item</span>
      <span class='kw'>elsif</span> <span class='id identifier rubyid_atomic'>atomic</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_destroyed'>destroyed</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
        <span class='kw'>return</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_item'>item</span><span class='rbracket'>]</span>           <span class='comment'># Early return with the problem item.
</span>      <span class='kw'>else</span>
        <span class='id identifier rubyid_retained'>retained</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_item'>item</span> <span class='kw'>and</span> <span class='kw'>next</span>   <span class='comment'># Will not be included in *items*.
</span>      <span class='kw'>end</span>
    <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_compact'>compact</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_retained'>retained</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
    <span class='const'><span class='object_link'><a href="../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_msg'>msg</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid___method__'>__method__</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_msg'>msg</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>not atomic</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_atomic'>atomic</span>
      <span class='id identifier rubyid_msg'>msg</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>items retained in the database that will be de-indexed</span><span class='tstring_end'>&#39;</span></span>
      <span class='id identifier rubyid_msg'>msg</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_retained'>retained</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_item'>item</span><span class='op'>|</span> <span class='id identifier rubyid_make_label'>make_label</span><span class='lparen'>(</span><span class='id identifier rubyid_item'>item</span><span class='rparen'>)</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>, </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_msg'>msg</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>: </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_retained'>retained</span><span class='period'>.</span><span class='id identifier rubyid_map!'>map!</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_item'>item</span><span class='op'>|</span> <span class='const'><span class='object_link'><a href="Errors/ErrorEntry.html" title="UploadWorkflow::Errors::ErrorEntry (class)">ErrorEntry</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../FlashHelper/Entry.html#initialize-instance_method" title="FlashHelper::Entry#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_item'>item</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>not removed</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='rbrace'>}</span> <span class='comment'># TODO: I18n
</span>  <span class='kw'>end</span>

  <span class='comment'># Remove the associated entries from the index.
</span>  <span class='kw'>return</span> <span class='id identifier rubyid_items'>items</span><span class='comma'>,</span> <span class='id identifier rubyid_retained'>retained</span> <span class='kw'>unless</span> <span class='id identifier rubyid_index'>index</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_items'>items</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
  <span class='id identifier rubyid_succeeded'>succeeded</span><span class='comma'>,</span> <span class='id identifier rubyid_failed'>failed</span> <span class='op'>=</span> <span class='id identifier rubyid_remove_from_index'>remove_from_index</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_items'>items</span><span class='comma'>,</span> <span class='label'>atomic:</span> <span class='id identifier rubyid_atomic'>atomic</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='lparen'>(</span><span class='id identifier rubyid_succeeded'>succeeded</span> <span class='op'>+</span> <span class='id identifier rubyid_requested'>requested</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='lparen'>(</span><span class='id identifier rubyid_retained'>retained</span> <span class='op'>+</span> <span class='id identifier rubyid_failed'>failed</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Tue Mar 16 14:48:51 2021 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.26 (ruby-2.7.2).
</div>

    </div>
  </body>
</html>