<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: Workflow::Base::Events
  
    &mdash; Documentation by YARD 0.9.26
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Workflow::Base::Events";
  relpath = '../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../_index.html">Index (E)</a> &raquo;
    <span class='title'>Workflow</span> &raquo; <span class='title'>Base</span>
     &raquo; 
    <span class="title">Events</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Module: Workflow::Base::Events
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  <dl>
      <dt>Includes:</dt>
      <dd><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">Emma::Debug::OutputMethods</a></span>, Roles, Simulation</dd>
  </dl>
  
  

  
  <dl>
    <dt>Included in:</dt>
    <dd><span class='object_link'><a href="../../UploadWorkflow/Events.html" title="UploadWorkflow::Events (module)">UploadWorkflow::Events</a></span>, <span class='object_link'><a href="../Base.html" title="Workflow::Base (class)">Workflow::Base</a></span>, <span class='object_link'><a href="States.html" title="Workflow::Base::States (module)">States</a></span></dd>
  </dl>
  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>app/models/workflow.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div>
  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="EVENTS-constant" class="">EVENTS =
          <div class="docstring">
  <div class="discussion">
    
<p>All defined workflow events.</p>

<p>– noinspection LongLine ++</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='lbracket'>[</span>
  <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
  <span class='comment'># === Workflow events triggered by the user
</span>
  <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>  <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>  <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>  <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>  <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>  <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>  <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
  <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
  <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>  <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>  <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>  <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>  <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>  <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>  <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>  <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>  <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>  <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>  <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
  <span class='comment'># === Workflow meta-events
</span>
  <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>  <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>  <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre></dd>
      
    </dl>
  



  
  
  <h3 class="inherited">Constants included
     from <span class='object_link'><a href="../../Emma/Debug/FormatMethods.html" title="Emma::Debug::FormatMethods (module)">Emma::Debug::FormatMethods</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../../Emma/Debug/FormatMethods.html#DEBUG_INSPECT_COMMON-constant" title="Emma::Debug::FormatMethods::DEBUG_INSPECT_COMMON (constant)">Emma::Debug::FormatMethods::DEBUG_INSPECT_COMMON</a></span>, <span class='object_link'><a href="../../Emma/Debug/FormatMethods.html#DEBUG_INSPECT_MAX-constant" title="Emma::Debug::FormatMethods::DEBUG_INSPECT_MAX (constant)">Emma::Debug::FormatMethods::DEBUG_INSPECT_MAX</a></span>, <span class='object_link'><a href="../../Emma/Debug/FormatMethods.html#DEBUG_INSPECT_OMISSION-constant" title="Emma::Debug::FormatMethods::DEBUG_INSPECT_OMISSION (constant)">Emma::Debug::FormatMethods::DEBUG_INSPECT_OMISSION</a></span>, <span class='object_link'><a href="../../Emma/Debug/FormatMethods.html#DEBUG_SEPARATOR-constant" title="Emma::Debug::FormatMethods::DEBUG_SEPARATOR (constant)">Emma::Debug::FormatMethods::DEBUG_SEPARATOR</a></span></p>

  
  
  <h3 class="inherited">Constants included
     from <span class='object_link'><a href="../../Emma/Common.html" title="Emma::Common (module)">Emma::Common</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../../Emma/Common.html#BOOLEAN_VALUES-constant" title="Emma::Common::BOOLEAN_VALUES (constant)">Emma::Common::BOOLEAN_VALUES</a></span>, <span class='object_link'><a href="../../Emma/Common.html#HTML_QUOTES-constant" title="Emma::Common::HTML_QUOTES (constant)">Emma::Common::HTML_QUOTES</a></span>, <span class='object_link'><a href="../../Emma/Common.html#INFLECT_PLURAL-constant" title="Emma::Common::INFLECT_PLURAL (constant)">Emma::Common::INFLECT_PLURAL</a></span>, <span class='object_link'><a href="../../Emma/Common.html#INFLECT_SINGULAR-constant" title="Emma::Common::INFLECT_SINGULAR (constant)">Emma::Common::INFLECT_SINGULAR</a></span>, <span class='object_link'><a href="../../Emma/Common.html#LIST_SEPARATOR-constant" title="Emma::Common::LIST_SEPARATOR (constant)">Emma::Common::LIST_SEPARATOR</a></span>, <span class='object_link'><a href="../../Emma/Common.html#PAIR_SEPARATOR-constant" title="Emma::Common::PAIR_SEPARATOR (constant)">Emma::Common::PAIR_SEPARATOR</a></span>, <span class='object_link'><a href="../../Emma/Common.html#QUOTE_MARKS-constant" title="Emma::Common::QUOTE_MARKS (constant)">Emma::Common::QUOTE_MARKS</a></span></p>





  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#included-class_method" title="included (class method)">.<strong>included</strong>(base)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Override :workflow for a Workflow subclass in order to redefine the workflow event methods.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#abort!-instance_method" title="#abort! (instance method)">#<strong>abort!</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#abort%3F-instance_method" title="#abort? (instance method)">#<strong>abort?</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#advance!-instance_method" title="#advance! (instance method)">#<strong>advance!</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#advance%3F-instance_method" title="#advance? (instance method)">#<strong>advance?</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#approve!-instance_method" title="#approve! (instance method)">#<strong>approve!</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#approve%3F-instance_method" title="#approve? (instance method)">#<strong>approve?</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#assign!-instance_method" title="#assign! (instance method)">#<strong>assign!</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#assign%3F-instance_method" title="#assign? (instance method)">#<strong>assign?</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#can_abort%3F-instance_method" title="#can_abort? (instance method)">#<strong>can_abort?</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#can_advance%3F-instance_method" title="#can_advance? (instance method)">#<strong>can_advance?</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#can_approve%3F-instance_method" title="#can_approve? (instance method)">#<strong>can_approve?</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#can_assign%3F-instance_method" title="#can_assign? (instance method)">#<strong>can_assign?</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#can_cancel%3F-instance_method" title="#can_cancel? (instance method)">#<strong>can_cancel?</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#can_create%3F-instance_method" title="#can_create? (instance method)">#<strong>can_create?</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#can_edit%3F-instance_method" title="#can_edit? (instance method)">#<strong>can_edit?</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#can_fail%3F-instance_method" title="#can_fail? (instance method)">#<strong>can_fail?</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#can_hold%3F-instance_method" title="#can_hold? (instance method)">#<strong>can_hold?</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#can_index%3F-instance_method" title="#can_index? (instance method)">#<strong>can_index?</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#can_purge%3F-instance_method" title="#can_purge? (instance method)">#<strong>can_purge?</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#can_reject%3F-instance_method" title="#can_reject? (instance method)">#<strong>can_reject?</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#can_remove%3F-instance_method" title="#can_remove? (instance method)">#<strong>can_remove?</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#can_reset%3F-instance_method" title="#can_reset? (instance method)">#<strong>can_reset?</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#can_resume%3F-instance_method" title="#can_resume? (instance method)">#<strong>can_resume?</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#can_review%3F-instance_method" title="#can_review? (instance method)">#<strong>can_review?</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#can_schedule%3F-instance_method" title="#can_schedule? (instance method)">#<strong>can_schedule?</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#can_start%3F-instance_method" title="#can_start? (instance method)">#<strong>can_start?</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#can_submit%3F-instance_method" title="#can_submit? (instance method)">#<strong>can_submit?</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#can_suspend%3F-instance_method" title="#can_suspend? (instance method)">#<strong>can_suspend?</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#can_timeout%3F-instance_method" title="#can_timeout? (instance method)">#<strong>can_timeout?</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#can_upload%3F-instance_method" title="#can_upload? (instance method)">#<strong>can_upload?</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#cancel!-instance_method" title="#cancel! (instance method)">#<strong>cancel!</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#cancel%3F-instance_method" title="#cancel? (instance method)">#<strong>cancel?</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create!-instance_method" title="#create! (instance method)">#<strong>create!</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create%3F-instance_method" title="#create? (instance method)">#<strong>create?</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#edit!-instance_method" title="#edit! (instance method)">#<strong>edit!</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#edit%3F-instance_method" title="#edit? (instance method)">#<strong>edit?</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#fail!-instance_method" title="#fail! (instance method)">#<strong>fail!</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#fail%3F-instance_method" title="#fail? (instance method)">#<strong>fail?</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#hold!-instance_method" title="#hold! (instance method)">#<strong>hold!</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#hold%3F-instance_method" title="#hold? (instance method)">#<strong>hold?</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#index!-instance_method" title="#index! (instance method)">#<strong>index!</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#index%3F-instance_method" title="#index? (instance method)">#<strong>index?</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#purge!-instance_method" title="#purge! (instance method)">#<strong>purge!</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#purge%3F-instance_method" title="#purge? (instance method)">#<strong>purge?</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#reject!-instance_method" title="#reject! (instance method)">#<strong>reject!</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#reject%3F-instance_method" title="#reject? (instance method)">#<strong>reject?</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#remove!-instance_method" title="#remove! (instance method)">#<strong>remove!</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#remove%3F-instance_method" title="#remove? (instance method)">#<strong>remove?</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#reset!-instance_method" title="#reset! (instance method)">#<strong>reset!</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#reset%3F-instance_method" title="#reset? (instance method)">#<strong>reset?</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#resume!-instance_method" title="#resume! (instance method)">#<strong>resume!</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#resume%3F-instance_method" title="#resume? (instance method)">#<strong>resume?</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#review!-instance_method" title="#review! (instance method)">#<strong>review!</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#review%3F-instance_method" title="#review? (instance method)">#<strong>review?</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#schedule!-instance_method" title="#schedule! (instance method)">#<strong>schedule!</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#schedule%3F-instance_method" title="#schedule? (instance method)">#<strong>schedule?</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#start!-instance_method" title="#start! (instance method)">#<strong>start!</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#start%3F-instance_method" title="#start? (instance method)">#<strong>start?</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#submit!-instance_method" title="#submit! (instance method)">#<strong>submit!</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#submit%3F-instance_method" title="#submit? (instance method)">#<strong>submit?</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#suspend!-instance_method" title="#suspend! (instance method)">#<strong>suspend!</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#suspend%3F-instance_method" title="#suspend? (instance method)">#<strong>suspend?</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#timeout!-instance_method" title="#timeout! (instance method)">#<strong>timeout!</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#timeout%3F-instance_method" title="#timeout? (instance method)">#<strong>timeout?</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#upload!-instance_method" title="#upload! (instance method)">#<strong>upload!</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#upload%3F-instance_method" title="#upload? (instance method)">#<strong>upload?</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods which are executed to initiate state transitions.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">Emma::Debug::OutputMethods</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html#__debug_exception-instance_method" title="Emma::Debug::OutputMethods#__debug_exception (method)">#__debug_exception</a></span>, <span class='object_link'><a href="../../Emma/Debug/OutputMethods.html#__debug_items-instance_method" title="Emma::Debug::OutputMethods#__debug_items (method)">#__debug_items</a></span>, <span class='object_link'><a href="../../Emma/Debug/OutputMethods.html#__debug_line-instance_method" title="Emma::Debug::OutputMethods#__debug_line (method)">#__debug_line</a></span>, <span class='object_link'><a href="../../Emma/Debug/OutputMethods.html#__debug_request-instance_method" title="Emma::Debug::OutputMethods#__debug_request (method)">#__debug_request</a></span>, <span class='object_link'><a href="../../Emma/Debug/OutputMethods.html#__debug_route-instance_method" title="Emma::Debug::OutputMethods#__debug_route (method)">#__debug_route</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../../Emma/Debug/FormatMethods.html" title="Emma::Debug::FormatMethods (module)">Emma::Debug::FormatMethods</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../../Emma/Debug/FormatMethods.html#__debug_env_hash-instance_method" title="Emma::Debug::FormatMethods#__debug_env_hash (method)">#__debug_env_hash</a></span>, <span class='object_link'><a href="../../Emma/Debug/FormatMethods.html#__debug_header_hash-instance_method" title="Emma::Debug::FormatMethods#__debug_header_hash (method)">#__debug_header_hash</a></span>, <span class='object_link'><a href="../../Emma/Debug/FormatMethods.html#__debug_inspect-instance_method" title="Emma::Debug::FormatMethods#__debug_inspect (method)">#__debug_inspect</a></span>, <span class='object_link'><a href="../../Emma/Debug/FormatMethods.html#__debug_inspect_item-instance_method" title="Emma::Debug::FormatMethods#__debug_inspect_item (method)">#__debug_inspect_item</a></span>, <span class='object_link'><a href="../../Emma/Debug/FormatMethods.html#__debug_inspect_items-instance_method" title="Emma::Debug::FormatMethods#__debug_inspect_items (method)">#__debug_inspect_items</a></span>, <span class='object_link'><a href="../../Emma/Debug/FormatMethods.html#__debug_label-instance_method" title="Emma::Debug::FormatMethods#__debug_label (method)">#__debug_label</a></span>, <span class='object_link'><a href="../../Emma/Debug/FormatMethods.html#__debug_route_label-instance_method" title="Emma::Debug::FormatMethods#__debug_route_label (method)">#__debug_route_label</a></span>, <span class='object_link'><a href="../../Emma/Debug/FormatMethods.html#__debug_session_hash-instance_method" title="Emma::Debug::FormatMethods#__debug_session_hash (method)">#__debug_session_hash</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../../Emma/Common.html" title="Emma::Common (module)">Emma::Common</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../../Emma/Common.html#array_string-instance_method" title="Emma::Common#array_string (method)">#array_string</a></span>, <span class='object_link'><a href="../../Emma/Common.html#boolean%3F-instance_method" title="Emma::Common#boolean? (method)">#boolean?</a></span>, <span class='object_link'><a href="../../Emma/Common.html#build_query_options-instance_method" title="Emma::Common#build_query_options (method)">#build_query_options</a></span>, <span class='object_link'><a href="../../Emma/Common.html#calling_method-instance_method" title="Emma::Common#calling_method (method)">#calling_method</a></span>, <span class='object_link'><a href="../../Emma/Common.html#digits_only%3F-instance_method" title="Emma::Common#digits_only? (method)">#digits_only?</a></span>, <span class='object_link'><a href="../../Emma/Common.html#get_method-instance_method" title="Emma::Common#get_method (method)">#get_method</a></span>, <span class='object_link'><a href="../../Emma/Common.html#get_params-instance_method" title="Emma::Common#get_params (method)">#get_params</a></span>, <span class='object_link'><a href="../../Emma/Common.html#hash_string-instance_method" title="Emma::Common#hash_string (method)">#hash_string</a></span>, <span class='object_link'><a href="../../Emma/Common.html#html_id-instance_method" title="Emma::Common#html_id (method)">#html_id</a></span>, <span class='object_link'><a href="../../Emma/Common.html#inflection-instance_method" title="Emma::Common#inflection (method)">#inflection</a></span>, <span class='object_link'><a href="../../Emma/Common.html#labelize-instance_method" title="Emma::Common#labelize (method)">#labelize</a></span>, <span class='object_link'><a href="../../Emma/Common.html#make_path-instance_method" title="Emma::Common#make_path (method)">#make_path</a></span>, <span class='object_link'><a href="../../Emma/Common.html#named_format_references-instance_method" title="Emma::Common#named_format_references (method)">#named_format_references</a></span>, <span class='object_link'><a href="../../Emma/Common.html#non_breaking-instance_method" title="Emma::Common#non_breaking (method)">#non_breaking</a></span>, <span class='object_link'><a href="../../Emma/Common.html#non_negative-instance_method" title="Emma::Common#non_negative (method)">#non_negative</a></span>, <span class='object_link'><a href="../../Emma/Common.html#normalized_list-instance_method" title="Emma::Common#normalized_list (method)">#normalized_list</a></span>, <span class='object_link'><a href="../../Emma/Common.html#partition_options-instance_method" title="Emma::Common#partition_options (method)">#partition_options</a></span>, <span class='object_link'><a href="../../Emma/Common.html#positive-instance_method" title="Emma::Common#positive (method)">#positive</a></span>, <span class='object_link'><a href="../../Emma/Common.html#quote-instance_method" title="Emma::Common#quote (method)">#quote</a></span>, <span class='object_link'><a href="../../Emma/Common.html#reject_blanks-instance_method" title="Emma::Common#reject_blanks (method)">#reject_blanks</a></span>, <span class='object_link'><a href="../../Emma/Common.html#sanitized_string-instance_method" title="Emma::Common#sanitized_string (method)">#sanitized_string</a></span>, <span class='object_link'><a href="../../Emma/Common.html#strip_quotes-instance_method" title="Emma::Common#strip_quotes (method)">#strip_quotes</a></span>, <span class='object_link'><a href="../../Emma/Common.html#url_escape-instance_method" title="Emma::Common#url_escape (method)">#url_escape</a></span>, <span class='object_link'><a href="../../Emma/Common.html#url_query-instance_method" title="Emma::Common#url_query (method)">#url_query</a></span></p>

  
  

  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="included-class_method">
  
    .<strong>included</strong>(base)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Override :workflow for a Workflow subclass in order to redefine the workflow event methods.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>base</span>
      
      
        <span class='type'>(<tt>Workflow</tt>, <tt>*</tt>)</span>
      
      
      
    </li>
  
</ul>


  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 564</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
      <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
      <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

        <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>        <span class='comment'># there are failures.
</span>        <span class='comment'>#
</span>        <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
          <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
        <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
          <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="abort!-instance_method">
  
    #<strong>abort!</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="abort?-instance_method">
  
    #<strong>abort?</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="advance!-instance_method">
  
    #<strong>advance!</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="advance?-instance_method">
  
    #<strong>advance?</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="approve!-instance_method">
  
    #<strong>approve!</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="approve?-instance_method">
  
    #<strong>approve?</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="assign!-instance_method">
  
    #<strong>assign!</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="assign?-instance_method">
  
    #<strong>assign?</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="can_abort?-instance_method">
  
    #<strong>can_abort?</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="can_advance?-instance_method">
  
    #<strong>can_advance?</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="can_approve?-instance_method">
  
    #<strong>can_approve?</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="can_assign?-instance_method">
  
    #<strong>can_assign?</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="can_cancel?-instance_method">
  
    #<strong>can_cancel?</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="can_create?-instance_method">
  
    #<strong>can_create?</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="can_edit?-instance_method">
  
    #<strong>can_edit?</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="can_fail?-instance_method">
  
    #<strong>can_fail?</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="can_hold?-instance_method">
  
    #<strong>can_hold?</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="can_index?-instance_method">
  
    #<strong>can_index?</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="can_purge?-instance_method">
  
    #<strong>can_purge?</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="can_reject?-instance_method">
  
    #<strong>can_reject?</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="can_remove?-instance_method">
  
    #<strong>can_remove?</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="can_reset?-instance_method">
  
    #<strong>can_reset?</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="can_resume?-instance_method">
  
    #<strong>can_resume?</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="can_review?-instance_method">
  
    #<strong>can_review?</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="can_schedule?-instance_method">
  
    #<strong>can_schedule?</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="can_start?-instance_method">
  
    #<strong>can_start?</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="can_submit?-instance_method">
  
    #<strong>can_submit?</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="can_suspend?-instance_method">
  
    #<strong>can_suspend?</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="can_timeout?-instance_method">
  
    #<strong>can_timeout?</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="can_upload?-instance_method">
  
    #<strong>can_upload?</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="cancel!-instance_method">
  
    #<strong>cancel!</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="cancel?-instance_method">
  
    #<strong>cancel?</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="create!-instance_method">
  
    #<strong>create!</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="create?-instance_method">
  
    #<strong>create?</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="edit!-instance_method">
  
    #<strong>edit!</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="edit?-instance_method">
  
    #<strong>edit?</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="fail!-instance_method">
  
    #<strong>fail!</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="fail?-instance_method">
  
    #<strong>fail?</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="hold!-instance_method">
  
    #<strong>hold!</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="hold?-instance_method">
  
    #<strong>hold?</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="index!-instance_method">
  
    #<strong>index!</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="index?-instance_method">
  
    #<strong>index?</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="purge!-instance_method">
  
    #<strong>purge!</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="purge?-instance_method">
  
    #<strong>purge?</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="reject!-instance_method">
  
    #<strong>reject!</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="reject?-instance_method">
  
    #<strong>reject?</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="remove!-instance_method">
  
    #<strong>remove!</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="remove?-instance_method">
  
    #<strong>remove?</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="reset!-instance_method">
  
    #<strong>reset!</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="reset?-instance_method">
  
    #<strong>reset?</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="resume!-instance_method">
  
    #<strong>resume!</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="resume?-instance_method">
  
    #<strong>resume?</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="review!-instance_method">
  
    #<strong>review!</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="review?-instance_method">
  
    #<strong>review?</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="schedule!-instance_method">
  
    #<strong>schedule!</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="schedule?-instance_method">
  
    #<strong>schedule?</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="start!-instance_method">
  
    #<strong>start!</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="start?-instance_method">
  
    #<strong>start?</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="submit!-instance_method">
  
    #<strong>submit!</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="submit?-instance_method">
  
    #<strong>submit?</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="suspend!-instance_method">
  
    #<strong>suspend!</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="suspend?-instance_method">
  
    #<strong>suspend?</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="timeout!-instance_method">
  
    #<strong>timeout!</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="timeout?-instance_method">
  
    #<strong>timeout?</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="upload!-instance_method">
  
    #<strong>upload!</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="upload?-instance_method">
  
    #<strong>upload?</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods which are executed to initiate state transitions.</p>

<p>The Workflow gem dynamically creates helper methods based on the <strong>workflow</strong> definition.  This module creates “shims” for each of these that insert additional logging support.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>ClassMethods#assign_workflow</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 469</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Simulation</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow events.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:start</span><span class='comma'>,</span>    <span class='comment'># Only used when debugging.
</span>
    <span class='comment'># === Workflow events triggered by the user
</span>
    <span class='symbol'>:create</span><span class='comma'>,</span>   <span class='comment'># The user initiates submission of a new entry.
</span>    <span class='symbol'>:edit</span><span class='comma'>,</span>     <span class='comment'># The user initiates modification of an existing entry.
</span>    <span class='symbol'>:remove</span><span class='comma'>,</span>   <span class='comment'># The user initiates removal of an existing entry.
</span>    <span class='symbol'>:cancel</span><span class='comma'>,</span>   <span class='comment'># The user chooses to cancel the submission process.
</span>    <span class='symbol'>:submit</span><span class='comma'>,</span>   <span class='comment'># The user chooses to proceed to the next step.
</span>    <span class='symbol'>:upload</span><span class='comma'>,</span>   <span class='comment'># The user supplies a file to upload. # TODO: new event
</span>    <span class='symbol'>:abort</span><span class='comma'>,</span>    <span class='comment'># The user chooses to terminate the workflow.
</span>
    <span class='comment'># === Workflow events triggered by an entity other than the user
</span>
    <span class='symbol'>:advance</span><span class='comma'>,</span>  <span class='comment'># The system moves to the next workflow step.
</span>    <span class='symbol'>:fail</span><span class='comma'>,</span>     <span class='comment'># The system has detected failure(s).
</span>    <span class='symbol'>:suspend</span><span class='comma'>,</span>  <span class='comment'># The system has suspended the workflow due to problems.
</span>    <span class='symbol'>:schedule</span><span class='comma'>,</span> <span class='comment'># The system has determined that the submission needs review.
</span>    <span class='symbol'>:approve</span><span class='comma'>,</span>  <span class='comment'># The system or reviewer indicates that the submission is acceptable.
</span>    <span class='symbol'>:reject</span><span class='comma'>,</span>   <span class='comment'># The system or reviewer indicates that the submission requires change(s).
</span>    <span class='symbol'>:hold</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer.
</span>    <span class='symbol'>:assign</span><span class='comma'>,</span>   <span class='comment'># The reviewer claims the submission for review or the system assigns a default reviewer.
</span>    <span class='symbol'>:review</span><span class='comma'>,</span>   <span class='comment'># The reviewer initiates review of the submission.
</span>    <span class='symbol'>:index</span><span class='comma'>,</span>    <span class='comment'># The system indicates the submission can be indexed directly.
</span>    <span class='symbol'>:timeout</span><span class='comma'>,</span>  <span class='comment'># The member repository has not yet retrieved the submission.
</span>
    <span class='comment'># === Workflow meta-events
</span>
    <span class='symbol'>:resume</span><span class='comma'>,</span>   <span class='comment'># The system is returning to the previous workflow state.
</span>    <span class='symbol'>:purge</span><span class='comma'>,</span>    <span class='comment'># The system is removing all data associated with the submission.
</span>    <span class='symbol'>:reset</span><span class='comma'>,</span>    <span class='comment'># The system is resetting the workflow state.
</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># event_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_event'>event</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># event_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, nil]  event
</span>  <span class='comment'># @param [String, Boolean, nil] number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*%s*</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_event_number'>event_number</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>  <span class='comment'># workflow event methods.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Workflow, *] base
</span>  <span class='comment'>#
</span>  <span class='comment'># @see Workflow::ClassMethods#workflow
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

      <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
        <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

          <span class='comment'># Override the method used to invoke the event to return *nil* if
</span>          <span class='comment'># there are failures.
</span>          <span class='comment'>#
</span>          <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
            <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
            <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
          <span class='kw'>end</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow debugging
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='kw'>if</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Roles</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section:
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_protected'>protected</span>

    <span class='comment'># __debug_event
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Symbol, String] event
</span>    <span class='comment'># @param [Array]          args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW ***** EVENT </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>leader:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># =========================================================================
</span>    <span class='comment'># :section: Workflow overrides
</span>    <span class='comment'># =========================================================================
</span>
    <span class='id identifier rubyid_public'>public</span>

    <span class='comment'># Override :workflow for a Workflow subclass in order to redefine the
</span>    <span class='comment'># workflow event methods.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow, *] base
</span>    <span class='comment'>#
</span>    <span class='comment'># @see Workflow::ClassMethods#workflow
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:workflow</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>

        <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_specification'>specification</span><span class='rparen'>)</span>
          <span class='const'><span class='object_link'><a href="#EVENTS-constant" title="Workflow::Base::Events::EVENTS (constant)">EVENTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>

            <span class='comment'># Override the method used to invoke the event to provide
</span>            <span class='comment'># additional debugging information beyond what :process_event!
</span>            <span class='comment'># shows (but let it fail in order to raise an exception instead of
</span>            <span class='comment'># returning *nil*).
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_current_state'>current_state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_first_applicable'>first_applicable</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_current_role'>current_role</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_curr_state'>curr_state</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
                <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'> event </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'> not valid for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in state </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_process_event!'>process_event!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
            <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failures?'>failures?</span>
              <span class='const'><span class='object_link'><a href="../../top-level-namespace.html#Log-constant" title="Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span><span class='embexpr_end'>}</span><span class='tstring_content'>!: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>

            <span class='comment'># The method which is called when the event is triggered.
</span>            <span class='comment'>#
</span>            <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid___debug_event'>__debug_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_protected'>protected</span> <span class='id identifier rubyid_event'>event</span>

          <span class='kw'>end</span>
        <span class='kw'>end</span>

      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Sat Feb  6 16:07:53 2021 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.26 (ruby-2.7.2).
</div>

    </div>
  </body>
</html>