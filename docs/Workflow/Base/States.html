<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: Workflow::Base::States
  
    &mdash; Documentation by YARD 0.9.26
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Workflow::Base::States";
  relpath = '../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../_index.html">Index (S)</a> &raquo;
    <span class='title'>Workflow</span> &raquo; <span class='title'>Base</span>
     &raquo; 
    <span class="title">States</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Module: Workflow::Base::States
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  <dl>
      <dt>Includes:</dt>
      <dd><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">Emma::Debug::OutputMethods</a></span>, Actions, Events</dd>
  </dl>
  
  

  
  <dl>
    <dt>Included in:</dt>
    <dd><span class='object_link'><a href="../../UploadWorkflow/States.html" title="UploadWorkflow::States (module)">UploadWorkflow::States</a></span>, <span class='object_link'><a href="../Base.html" title="Workflow::Base (class)">Workflow::Base</a></span></dd>
  </dl>
  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>app/models/workflow.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div>
  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="STATES-constant" class="">STATES =
          <div class="docstring">
  <div class="discussion">
    
<p>All defined workflow states.</p>

<p>â€“ noinspection LongLine ++</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='lbracket'>[</span>
  <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
  <span class='comment'># === &quot;Create new entry&quot; states
</span>
  <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>  <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>  <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>  <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
  <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
  <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>  <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>  <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>  <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
  <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
  <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>  <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
  <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
  <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>  <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>  <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>  <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>  <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>  <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>  <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
  <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
  <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>  <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>  <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
  <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
  <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>  <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
  <span class='comment'># === Terminal states
</span>
  <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>  <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>  <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>  <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
  <span class='comment'># === Pseudo states
</span>
  <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>  <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
<span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre></dd>
      
        <dt id="HIDDEN_STATE-constant" class="">HIDDEN_STATE =
          <div class="docstring">
  <div class="discussion">
    
<p>States that will not assigned to @previous_state.</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='qsymbols_beg'>%i[</span><span class='words_sep'>
  </span><span class='tstring_content'>starting</span><span class='words_sep'>
  </span><span class='tstring_content'>suspended</span><span class='words_sep'>
  </span><span class='tstring_content'>failed</span><span class='words_sep'>
  </span><span class='tstring_content'>canceled</span><span class='words_sep'>
  </span><span class='tstring_content'>completed</span><span class='words_sep'>
  </span><span class='tstring_content'>resuming</span><span class='words_sep'>
  </span><span class='tstring_content'>purged</span><span class='words_sep'>
</span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre></dd>
      
    </dl>
  



  
  
  <h3 class="inherited">Constants included
     from <span class='object_link'><a href="../../Emma/Debug/FormatMethods.html" title="Emma::Debug::FormatMethods (module)">Emma::Debug::FormatMethods</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../../Emma/Debug/FormatMethods.html#DEBUG_INSPECT_COMMON-constant" title="Emma::Debug::FormatMethods::DEBUG_INSPECT_COMMON (constant)">Emma::Debug::FormatMethods::DEBUG_INSPECT_COMMON</a></span>, <span class='object_link'><a href="../../Emma/Debug/FormatMethods.html#DEBUG_INSPECT_MAX-constant" title="Emma::Debug::FormatMethods::DEBUG_INSPECT_MAX (constant)">Emma::Debug::FormatMethods::DEBUG_INSPECT_MAX</a></span>, <span class='object_link'><a href="../../Emma/Debug/FormatMethods.html#DEBUG_INSPECT_OMISSION-constant" title="Emma::Debug::FormatMethods::DEBUG_INSPECT_OMISSION (constant)">Emma::Debug::FormatMethods::DEBUG_INSPECT_OMISSION</a></span>, <span class='object_link'><a href="../../Emma/Debug/FormatMethods.html#DEBUG_SEPARATOR-constant" title="Emma::Debug::FormatMethods::DEBUG_SEPARATOR (constant)">Emma::Debug::FormatMethods::DEBUG_SEPARATOR</a></span></p>

  
  
  <h3 class="inherited">Constants included
     from <span class='object_link'><a href="../../Emma/Common.html" title="Emma::Common (module)">Emma::Common</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../../Emma/Common.html#ASCII-constant" title="Emma::Common::ASCII (constant)">Emma::Common::ASCII</a></span>, <span class='object_link'><a href="../../Emma/Common.html#BOOLEAN_VALUES-constant" title="Emma::Common::BOOLEAN_VALUES (constant)">Emma::Common::BOOLEAN_VALUES</a></span>, <span class='object_link'><a href="../../Emma/Common.html#HTML_ID_IGNORED-constant" title="Emma::Common::HTML_ID_IGNORED (constant)">Emma::Common::HTML_ID_IGNORED</a></span>, <span class='object_link'><a href="../../Emma/Common.html#HTML_ID_WORD_BREAK-constant" title="Emma::Common::HTML_ID_WORD_BREAK (constant)">Emma::Common::HTML_ID_WORD_BREAK</a></span>, <span class='object_link'><a href="../../Emma/Common.html#HTML_QUOTES-constant" title="Emma::Common::HTML_QUOTES (constant)">Emma::Common::HTML_QUOTES</a></span>, <span class='object_link'><a href="../../Emma/Common.html#INFLECT_PLURAL-constant" title="Emma::Common::INFLECT_PLURAL (constant)">Emma::Common::INFLECT_PLURAL</a></span>, <span class='object_link'><a href="../../Emma/Common.html#INFLECT_SINGULAR-constant" title="Emma::Common::INFLECT_SINGULAR (constant)">Emma::Common::INFLECT_SINGULAR</a></span>, <span class='object_link'><a href="../../Emma/Common.html#LIST_SEPARATOR-constant" title="Emma::Common::LIST_SEPARATOR (constant)">Emma::Common::LIST_SEPARATOR</a></span>, <span class='object_link'><a href="../../Emma/Common.html#PAIR_SEPARATOR-constant" title="Emma::Common::PAIR_SEPARATOR (constant)">Emma::Common::PAIR_SEPARATOR</a></span>, <span class='object_link'><a href="../../Emma/Common.html#QUOTE_MARKS-constant" title="Emma::Common::QUOTE_MARKS (constant)">Emma::Common::QUOTE_MARKS</a></span></p>





  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_approved_entry-instance_method" title="#on_approved_entry (instance method)">#<strong>on_approved_entry</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_approved_exit-instance_method" title="#on_approved_exit (instance method)">#<strong>on_approved_exit</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_assigned_entry-instance_method" title="#on_assigned_entry (instance method)">#<strong>on_assigned_entry</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_assigned_exit-instance_method" title="#on_assigned_exit (instance method)">#<strong>on_assigned_exit</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_assigning_entry-instance_method" title="#on_assigning_entry (instance method)">#<strong>on_assigning_entry</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_assigning_exit-instance_method" title="#on_assigning_exit (instance method)">#<strong>on_assigning_exit</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_canceled_entry-instance_method" title="#on_canceled_entry (instance method)">#<strong>on_canceled_entry</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_canceled_exit-instance_method" title="#on_canceled_exit (instance method)">#<strong>on_canceled_exit</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_completed_entry-instance_method" title="#on_completed_entry (instance method)">#<strong>on_completed_entry</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_completed_exit-instance_method" title="#on_completed_exit (instance method)">#<strong>on_completed_exit</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_creating_entry-instance_method" title="#on_creating_entry (instance method)">#<strong>on_creating_entry</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_creating_exit-instance_method" title="#on_creating_exit (instance method)">#<strong>on_creating_exit</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_editing_entry-instance_method" title="#on_editing_entry (instance method)">#<strong>on_editing_entry</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_editing_exit-instance_method" title="#on_editing_exit (instance method)">#<strong>on_editing_exit</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_failed_entry-instance_method" title="#on_failed_entry (instance method)">#<strong>on_failed_entry</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_failed_exit-instance_method" title="#on_failed_exit (instance method)">#<strong>on_failed_exit</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_holding_entry-instance_method" title="#on_holding_entry (instance method)">#<strong>on_holding_entry</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_holding_exit-instance_method" title="#on_holding_exit (instance method)">#<strong>on_holding_exit</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_indexed_entry-instance_method" title="#on_indexed_entry (instance method)">#<strong>on_indexed_entry</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_indexed_exit-instance_method" title="#on_indexed_exit (instance method)">#<strong>on_indexed_exit</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_indexing_entry-instance_method" title="#on_indexing_entry (instance method)">#<strong>on_indexing_entry</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_indexing_exit-instance_method" title="#on_indexing_exit (instance method)">#<strong>on_indexing_exit</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_modified_entry-instance_method" title="#on_modified_entry (instance method)">#<strong>on_modified_entry</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_modified_exit-instance_method" title="#on_modified_exit (instance method)">#<strong>on_modified_exit</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_modifying_entry-instance_method" title="#on_modifying_entry (instance method)">#<strong>on_modifying_entry</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_modifying_exit-instance_method" title="#on_modifying_exit (instance method)">#<strong>on_modifying_exit</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_purged_entry-instance_method" title="#on_purged_entry (instance method)">#<strong>on_purged_entry</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_purged_exit-instance_method" title="#on_purged_exit (instance method)">#<strong>on_purged_exit</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_rejected_entry-instance_method" title="#on_rejected_entry (instance method)">#<strong>on_rejected_entry</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_rejected_exit-instance_method" title="#on_rejected_exit (instance method)">#<strong>on_rejected_exit</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_removed_entry-instance_method" title="#on_removed_entry (instance method)">#<strong>on_removed_entry</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_removed_exit-instance_method" title="#on_removed_exit (instance method)">#<strong>on_removed_exit</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_removing_entry-instance_method" title="#on_removing_entry (instance method)">#<strong>on_removing_entry</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_removing_exit-instance_method" title="#on_removing_exit (instance method)">#<strong>on_removing_exit</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_replacing_entry-instance_method" title="#on_replacing_entry (instance method)">#<strong>on_replacing_entry</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_replacing_exit-instance_method" title="#on_replacing_exit (instance method)">#<strong>on_replacing_exit</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_retrieved_entry-instance_method" title="#on_retrieved_entry (instance method)">#<strong>on_retrieved_entry</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_retrieved_exit-instance_method" title="#on_retrieved_exit (instance method)">#<strong>on_retrieved_exit</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_reviewing_entry-instance_method" title="#on_reviewing_entry (instance method)">#<strong>on_reviewing_entry</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_reviewing_exit-instance_method" title="#on_reviewing_exit (instance method)">#<strong>on_reviewing_exit</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_scheduling_entry-instance_method" title="#on_scheduling_entry (instance method)">#<strong>on_scheduling_entry</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_scheduling_exit-instance_method" title="#on_scheduling_exit (instance method)">#<strong>on_scheduling_exit</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_staging_entry-instance_method" title="#on_staging_entry (instance method)">#<strong>on_staging_entry</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_staging_exit-instance_method" title="#on_staging_exit (instance method)">#<strong>on_staging_exit</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_starting_entry-instance_method" title="#on_starting_entry (instance method)">#<strong>on_starting_entry</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_starting_exit-instance_method" title="#on_starting_exit (instance method)">#<strong>on_starting_exit</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_submitted_entry-instance_method" title="#on_submitted_entry (instance method)">#<strong>on_submitted_entry</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_submitted_exit-instance_method" title="#on_submitted_exit (instance method)">#<strong>on_submitted_exit</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_submitting_entry-instance_method" title="#on_submitting_entry (instance method)">#<strong>on_submitting_entry</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_submitting_exit-instance_method" title="#on_submitting_exit (instance method)">#<strong>on_submitting_exit</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_suspended_entry-instance_method" title="#on_suspended_entry (instance method)">#<strong>on_suspended_entry</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_suspended_exit-instance_method" title="#on_suspended_exit (instance method)">#<strong>on_suspended_exit</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_unretrieved_entry-instance_method" title="#on_unretrieved_entry (instance method)">#<strong>on_unretrieved_entry</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_unretrieved_exit-instance_method" title="#on_unretrieved_exit (instance method)">#<strong>on_unretrieved_exit</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_validating_entry-instance_method" title="#on_validating_entry (instance method)">#<strong>on_validating_entry</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_validating_exit-instance_method" title="#on_validating_exit (instance method)">#<strong>on_validating_exit</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Methods executed on transition into and out of a state.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">Emma::Debug::OutputMethods</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html#__debug_exception-instance_method" title="Emma::Debug::OutputMethods#__debug_exception (method)">#__debug_exception</a></span>, <span class='object_link'><a href="../../Emma/Debug/OutputMethods.html#__debug_items-instance_method" title="Emma::Debug::OutputMethods#__debug_items (method)">#__debug_items</a></span>, <span class='object_link'><a href="../../Emma/Debug/OutputMethods.html#__debug_line-instance_method" title="Emma::Debug::OutputMethods#__debug_line (method)">#__debug_line</a></span>, <span class='object_link'><a href="../../Emma/Debug/OutputMethods.html#__debug_request-instance_method" title="Emma::Debug::OutputMethods#__debug_request (method)">#__debug_request</a></span>, <span class='object_link'><a href="../../Emma/Debug/OutputMethods.html#__debug_route-instance_method" title="Emma::Debug::OutputMethods#__debug_route (method)">#__debug_route</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../../Emma/Debug/FormatMethods.html" title="Emma::Debug::FormatMethods (module)">Emma::Debug::FormatMethods</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../../Emma/Debug/FormatMethods.html#__debug_env_hash-instance_method" title="Emma::Debug::FormatMethods#__debug_env_hash (method)">#__debug_env_hash</a></span>, <span class='object_link'><a href="../../Emma/Debug/FormatMethods.html#__debug_header_hash-instance_method" title="Emma::Debug::FormatMethods#__debug_header_hash (method)">#__debug_header_hash</a></span>, <span class='object_link'><a href="../../Emma/Debug/FormatMethods.html#__debug_inspect-instance_method" title="Emma::Debug::FormatMethods#__debug_inspect (method)">#__debug_inspect</a></span>, <span class='object_link'><a href="../../Emma/Debug/FormatMethods.html#__debug_inspect_item-instance_method" title="Emma::Debug::FormatMethods#__debug_inspect_item (method)">#__debug_inspect_item</a></span>, <span class='object_link'><a href="../../Emma/Debug/FormatMethods.html#__debug_inspect_items-instance_method" title="Emma::Debug::FormatMethods#__debug_inspect_items (method)">#__debug_inspect_items</a></span>, <span class='object_link'><a href="../../Emma/Debug/FormatMethods.html#__debug_label-instance_method" title="Emma::Debug::FormatMethods#__debug_label (method)">#__debug_label</a></span>, <span class='object_link'><a href="../../Emma/Debug/FormatMethods.html#__debug_route_label-instance_method" title="Emma::Debug::FormatMethods#__debug_route_label (method)">#__debug_route_label</a></span>, <span class='object_link'><a href="../../Emma/Debug/FormatMethods.html#__debug_session_hash-instance_method" title="Emma::Debug::FormatMethods#__debug_session_hash (method)">#__debug_session_hash</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../../Emma/Common.html" title="Emma::Common (module)">Emma::Common</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../../Emma/Common.html#array_string-instance_method" title="Emma::Common#array_string (method)">#array_string</a></span>, <span class='object_link'><a href="../../Emma/Common.html#boolean%3F-instance_method" title="Emma::Common#boolean? (method)">#boolean?</a></span>, <span class='object_link'><a href="../../Emma/Common.html#build_query_options-instance_method" title="Emma::Common#build_query_options (method)">#build_query_options</a></span>, <span class='object_link'><a href="../../Emma/Common.html#calling_method-instance_method" title="Emma::Common#calling_method (method)">#calling_method</a></span>, <span class='object_link'><a href="../../Emma/Common.html#digits_only%3F-instance_method" title="Emma::Common#digits_only? (method)">#digits_only?</a></span>, <span class='object_link'><a href="../../Emma/Common.html#get_method-instance_method" title="Emma::Common#get_method (method)">#get_method</a></span>, <span class='object_link'><a href="../../Emma/Common.html#get_params-instance_method" title="Emma::Common#get_params (method)">#get_params</a></span>, <span class='object_link'><a href="../../Emma/Common.html#hash_string-instance_method" title="Emma::Common#hash_string (method)">#hash_string</a></span>, <span class='object_link'><a href="../../Emma/Common.html#html_id-instance_method" title="Emma::Common#html_id (method)">#html_id</a></span>, <span class='object_link'><a href="../../Emma/Common.html#inflection-instance_method" title="Emma::Common#inflection (method)">#inflection</a></span>, <span class='object_link'><a href="../../Emma/Common.html#labelize-instance_method" title="Emma::Common#labelize (method)">#labelize</a></span>, <span class='object_link'><a href="../../Emma/Common.html#make_path-instance_method" title="Emma::Common#make_path (method)">#make_path</a></span>, <span class='object_link'><a href="../../Emma/Common.html#named_format_references-instance_method" title="Emma::Common#named_format_references (method)">#named_format_references</a></span>, <span class='object_link'><a href="../../Emma/Common.html#non_breaking-instance_method" title="Emma::Common#non_breaking (method)">#non_breaking</a></span>, <span class='object_link'><a href="../../Emma/Common.html#non_negative-instance_method" title="Emma::Common#non_negative (method)">#non_negative</a></span>, <span class='object_link'><a href="../../Emma/Common.html#normalized_list-instance_method" title="Emma::Common#normalized_list (method)">#normalized_list</a></span>, <span class='object_link'><a href="../../Emma/Common.html#partition_options-instance_method" title="Emma::Common#partition_options (method)">#partition_options</a></span>, <span class='object_link'><a href="../../Emma/Common.html#positive-instance_method" title="Emma::Common#positive (method)">#positive</a></span>, <span class='object_link'><a href="../../Emma/Common.html#quote-instance_method" title="Emma::Common#quote (method)">#quote</a></span>, <span class='object_link'><a href="../../Emma/Common.html#reject_blanks-instance_method" title="Emma::Common#reject_blanks (method)">#reject_blanks</a></span>, <span class='object_link'><a href="../../Emma/Common.html#sanitized_string-instance_method" title="Emma::Common#sanitized_string (method)">#sanitized_string</a></span>, <span class='object_link'><a href="../../Emma/Common.html#strip_quotes-instance_method" title="Emma::Common#strip_quotes (method)">#strip_quotes</a></span>, <span class='object_link'><a href="../../Emma/Common.html#url_escape-instance_method" title="Emma::Common#url_escape (method)">#url_escape</a></span>, <span class='object_link'><a href="../../Emma/Common.html#url_query-instance_method" title="Emma::Common#url_query (method)">#url_query</a></span></p>

  
  

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="on_approved_entry-instance_method">
  
    #<strong>on_approved_entry</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_approved_exit-instance_method">
  
    #<strong>on_approved_exit</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_assigned_entry-instance_method">
  
    #<strong>on_assigned_entry</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_assigned_exit-instance_method">
  
    #<strong>on_assigned_exit</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_assigning_entry-instance_method">
  
    #<strong>on_assigning_entry</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_assigning_exit-instance_method">
  
    #<strong>on_assigning_exit</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_canceled_entry-instance_method">
  
    #<strong>on_canceled_entry</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_canceled_exit-instance_method">
  
    #<strong>on_canceled_exit</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_completed_entry-instance_method">
  
    #<strong>on_completed_entry</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_completed_exit-instance_method">
  
    #<strong>on_completed_exit</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_creating_entry-instance_method">
  
    #<strong>on_creating_entry</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_creating_exit-instance_method">
  
    #<strong>on_creating_exit</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_editing_entry-instance_method">
  
    #<strong>on_editing_entry</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_editing_exit-instance_method">
  
    #<strong>on_editing_exit</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_failed_entry-instance_method">
  
    #<strong>on_failed_entry</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_failed_exit-instance_method">
  
    #<strong>on_failed_exit</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_holding_entry-instance_method">
  
    #<strong>on_holding_entry</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_holding_exit-instance_method">
  
    #<strong>on_holding_exit</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_indexed_entry-instance_method">
  
    #<strong>on_indexed_entry</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_indexed_exit-instance_method">
  
    #<strong>on_indexed_exit</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_indexing_entry-instance_method">
  
    #<strong>on_indexing_entry</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_indexing_exit-instance_method">
  
    #<strong>on_indexing_exit</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_modified_entry-instance_method">
  
    #<strong>on_modified_entry</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_modified_exit-instance_method">
  
    #<strong>on_modified_exit</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_modifying_entry-instance_method">
  
    #<strong>on_modifying_entry</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_modifying_exit-instance_method">
  
    #<strong>on_modifying_exit</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_purged_entry-instance_method">
  
    #<strong>on_purged_entry</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_purged_exit-instance_method">
  
    #<strong>on_purged_exit</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_rejected_entry-instance_method">
  
    #<strong>on_rejected_entry</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_rejected_exit-instance_method">
  
    #<strong>on_rejected_exit</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_removed_entry-instance_method">
  
    #<strong>on_removed_entry</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_removed_exit-instance_method">
  
    #<strong>on_removed_exit</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_removing_entry-instance_method">
  
    #<strong>on_removing_entry</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_removing_exit-instance_method">
  
    #<strong>on_removing_exit</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_replacing_entry-instance_method">
  
    #<strong>on_replacing_entry</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_replacing_exit-instance_method">
  
    #<strong>on_replacing_exit</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_retrieved_entry-instance_method">
  
    #<strong>on_retrieved_entry</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_retrieved_exit-instance_method">
  
    #<strong>on_retrieved_exit</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_reviewing_entry-instance_method">
  
    #<strong>on_reviewing_entry</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_reviewing_exit-instance_method">
  
    #<strong>on_reviewing_exit</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_scheduling_entry-instance_method">
  
    #<strong>on_scheduling_entry</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_scheduling_exit-instance_method">
  
    #<strong>on_scheduling_exit</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_staging_entry-instance_method">
  
    #<strong>on_staging_entry</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_staging_exit-instance_method">
  
    #<strong>on_staging_exit</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_starting_entry-instance_method">
  
    #<strong>on_starting_entry</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_starting_exit-instance_method">
  
    #<strong>on_starting_exit</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_submitted_entry-instance_method">
  
    #<strong>on_submitted_entry</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_submitted_exit-instance_method">
  
    #<strong>on_submitted_exit</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_submitting_entry-instance_method">
  
    #<strong>on_submitting_entry</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_submitting_exit-instance_method">
  
    #<strong>on_submitting_exit</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_suspended_entry-instance_method">
  
    #<strong>on_suspended_entry</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_suspended_exit-instance_method">
  
    #<strong>on_suspended_exit</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_unretrieved_entry-instance_method">
  
    #<strong>on_unretrieved_entry</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_unretrieved_exit-instance_method">
  
    #<strong>on_unretrieved_exit</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_validating_entry-instance_method">
  
    #<strong>on_validating_entry</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_validating_exit-instance_method">
  
    #<strong>on_validating_exit</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Methods executed on transition into and out of a state.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>InstanceMethods#run_on_entry</li>
    
      <li>InstanceMethods#run_on_exit</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/workflow.rb', line 745</span>

<span class='kw'>module</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>States</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Events</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Workflow</span><span class='op'>::</span><span class='const'>Base</span><span class='op'>::</span><span class='const'>Actions</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_public'>public</span>

  <span class='comment'># All defined workflow states.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection LongLine
</span>  <span class='comment'>#++
</span>  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:starting</span><span class='comma'>,</span>    <span class='comment'># Initial workflow state.
</span>
    <span class='comment'># === &quot;Create new entry&quot; states
</span>
    <span class='symbol'>:creating</span><span class='comma'>,</span>    <span class='comment'># The user is presented with the form for submitting a new item.
</span>    <span class='symbol'>:validating</span><span class='comma'>,</span>  <span class='comment'># The supplied file is being validated. # TODO: new state
</span>    <span class='symbol'>:submitting</span><span class='comma'>,</span>  <span class='comment'># The submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:submitted</span><span class='comma'>,</span>   <span class='comment'># The submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Modify existing entry&quot; states
</span>
    <span class='symbol'>:editing</span><span class='comma'>,</span>     <span class='comment'># The user is presented with the edit form pre-populated with previously-provided values.
</span>    <span class='symbol'>:replacing</span><span class='comma'>,</span>   <span class='comment'># The supplied replacement file is being validated. # TODO: new state
</span>    <span class='symbol'>:modifying</span><span class='comma'>,</span>   <span class='comment'># The modified submission is complete and ready to move into the submission queue.
</span>    <span class='symbol'>:modified</span><span class='comma'>,</span>    <span class='comment'># The modified submission is moving into the submission queue.
</span>
    <span class='comment'># === &quot;Remove existing entry&quot; states
</span>
    <span class='symbol'>:removing</span><span class='comma'>,</span>    <span class='comment'># The user is presented with a request for confirmation that the item should be submitted for removal.
</span>    <span class='symbol'>:removed</span><span class='comma'>,</span>     <span class='comment'># The removal request is created.
</span>
    <span class='comment'># === &quot;Sub-sequence: Review&quot; states
</span>
    <span class='symbol'>:scheduling</span><span class='comma'>,</span>  <span class='comment'># The submission is being scheduled for review.
</span>    <span class='symbol'>:assigning</span><span class='comma'>,</span>   <span class='comment'># The submission is being assigned for review.
</span>    <span class='symbol'>:holding</span><span class='comma'>,</span>     <span class='comment'># The system is waiting for a reviewer (or the review process is paused).
</span>    <span class='symbol'>:assigned</span><span class='comma'>,</span>    <span class='comment'># The submission has been assigned for review.
</span>    <span class='symbol'>:reviewing</span><span class='comma'>,</span>   <span class='comment'># The submission is under review.
</span>    <span class='symbol'>:rejected</span><span class='comma'>,</span>    <span class='comment'># The submission has been rejected.
</span>    <span class='symbol'>:approved</span><span class='comma'>,</span>    <span class='comment'># The submission has been approved.
</span>
    <span class='comment'># === &quot;Sub-sequence: Submission&quot; states
</span>
    <span class='symbol'>:staging</span><span class='comma'>,</span>     <span class='comment'># The submission request (submitted file plus generated request form) has been added to the staging area.
</span>    <span class='symbol'>:unretrieved</span><span class='comma'>,</span> <span class='comment'># The submission request has not been retrieved by the member repository within a pre-determined maximum time span.
</span>    <span class='symbol'>:retrieved</span><span class='comma'>,</span>   <span class='comment'># The submission request has been retrieved by the member repository and removed from the staging area.
</span>
    <span class='comment'># === &quot;Sub-sequence: Finalization&quot; states
</span>
    <span class='symbol'>:indexing</span><span class='comma'>,</span>    <span class='comment'># The submission is being added to the index.
</span>    <span class='symbol'>:indexed</span><span class='comma'>,</span>     <span class='comment'># The submission is complete and present in the EMMA Unified Index.
</span>
    <span class='comment'># === Terminal states
</span>
    <span class='symbol'>:suspended</span><span class='comma'>,</span>   <span class='comment'># The system is pausing the workflow; it may be resumable.
</span>    <span class='symbol'>:failed</span><span class='comma'>,</span>      <span class='comment'># The system is terminating the workflow.
</span>    <span class='symbol'>:canceled</span><span class='comma'>,</span>    <span class='comment'># The user is choosing to terminate the workflow.
</span>    <span class='symbol'>:completed</span><span class='comma'>,</span>   <span class='comment'># The workflow has been successfully completed.
</span>
    <span class='comment'># === Pseudo states
</span>
    <span class='symbol'>:resuming</span><span class='comma'>,</span>    <span class='comment'># Pseudo-state indicating the previous workflow state. # TODO: new
</span>    <span class='symbol'>:purged</span><span class='comma'>,</span>      <span class='comment'># All data associated with the submission is being eliminated. # TODO: new
</span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># States that will not assigned to @previous_state.
</span>  <span class='comment'>#
</span>  <span class='comment'># @type [Array&lt;Symbol&gt;]
</span>  <span class='comment'>#
</span>  <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span> <span class='op'>=</span> <span class='qsymbols_beg'>%i[</span><span class='words_sep'>
    </span><span class='tstring_content'>starting</span><span class='words_sep'>
    </span><span class='tstring_content'>suspended</span><span class='words_sep'>
    </span><span class='tstring_content'>failed</span><span class='words_sep'>
    </span><span class='tstring_content'>canceled</span><span class='words_sep'>
    </span><span class='tstring_content'>completed</span><span class='words_sep'>
    </span><span class='tstring_content'>resuming</span><span class='words_sep'>
    </span><span class='tstring_content'>purged</span><span class='words_sep'>
  </span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section: Workflow overrides
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_state'>state</span><span class='op'>|</span>

    <span class='comment'># Respond to entering into the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_entry</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

    <span class='comment'># Respond to leaving the specific state.
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [*] _state
</span>    <span class='comment'># @param [Symbol] event
</span>    <span class='comment'># @param [Array]  event_args
</span>    <span class='comment'>#
</span>    <span class='comment'># @return [self]                  For chaining.
</span>    <span class='comment'>#
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'>_exit</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__state'>_state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='op'>|</span>
      <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_event_args'>event_args</span><span class='rparen'>)</span>
      <span class='ivar'>@prev_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#HIDDEN_STATE-constant" title="Workflow::Base::States::HIDDEN_STATE (constant)">HIDDEN_STATE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='comment'># state_object
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Workflow::State]
</span>  <span class='comment'>#
</span>  <span class='comment'>#--
</span>  <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>  <span class='comment'>#++
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>       <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>||</span> <span class='id identifier rubyid_current_state'>current_state</span>
  <span class='kw'>end</span>

  <span class='comment'># state_number
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Integer]             On error, -1 is returned.
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='comment'># noinspection RubyNilAnalysis, RubyYardReturnMatch
</span>    <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="#STATES-constant" title="Workflow::Base::States::STATES (constant)">STATES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># state_label
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Symbol, String, Workflow::State, nil] state
</span>  <span class='comment'># @param [String, Boolean, nil]                 number
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='comment'>#
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_label'>label</span>  <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MISSING</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%02d</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>%</span> <span class='id identifier rubyid_state_number'>state_number</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_label'>label</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number'>number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_label'>label</span>
  <span class='kw'>end</span>

  <span class='comment'># ===========================================================================
</span>  <span class='comment'># :section:
</span>  <span class='comment'># ===========================================================================
</span>
  <span class='id identifier rubyid_protected'>protected</span>

  <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>DEBUG_WORKFLOW</span>

    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span><span class='semicolon'>;</span>  <span class='kw'>end</span>

  <span class='kw'>else</span>

    <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../../Emma.html" title="Emma (module)">Emma</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug.html" title="Emma::Debug (module)">Debug</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Emma/Debug/OutputMethods.html" title="Emma::Debug::OutputMethods (module)">OutputMethods</a></span></span>

    <span class='comment'># __debug_entry
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being entered.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_entry'>__debug_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_object'>state_object</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_trans'>trans</span> <span class='op'>=</span>
          <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
            <span class='comment'># noinspection RubyYardParamTypeMatch
</span>            <span class='id identifier rubyid_event_label'>event_label</span><span class='lparen'>(</span><span class='id identifier rubyid_evt'>evt</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&lt;&lt;</span>
              <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
                <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_transitions_to'>transitions_to</span><span class='comma'>,</span> <span class='label'>number:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WORKFLOW &gt;&gt;&gt;&gt;&gt; ENTER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_state'>state</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trans'>trans</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># __debug_exit
</span>    <span class='comment'>#
</span>    <span class='comment'># @param [Workflow::State] state        State that is being exited.
</span>    <span class='comment'># @param [Symbol]          _event       Triggering event
</span>    <span class='comment'># @param [Array]           _event_args
</span>    <span class='comment'>#
</span>    <span class='kw'>def</span> <span class='id identifier rubyid___debug_exit'>__debug_exit</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid__event'>_event</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__event_args'>_event_args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid___debug_line'>__debug_line</span> <span class='kw'>do</span>
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKFLOW &lt;&lt;&lt;&lt;&lt; LEAVE </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_state_label'>state_label</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Tue Mar 16 14:51:21 2021 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.26 (ruby-2.7.2).
</div>

    </div>
  </body>
</html>